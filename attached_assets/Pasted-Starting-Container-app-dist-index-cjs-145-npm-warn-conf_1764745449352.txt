Starting Container
/app/dist/index.cjs:145
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
		`;await i.execute(x`CREATE SCHEMA IF NOT EXISTS ${x.identifier(a)}`),await i.execute(s);let c=(await i.all(x`select id, hash, created_at from ${x.identifier(a)}.${x.identifier(n)} order by created_at desc limit 1`))[0];await i.transaction(async l=>{for await(let p of e)if(!c||Number(c.created_at)<p.folderMillis){for(let u of p.sql)await l.execute(x.raw(u));await l.execute(x`insert into ${x.identifier(a)}.${x.identifier(n)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let i=[x`with `];for(let[r,n]of e.entries())i.push(x`${x.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&i.push(x`, `);return i.push(x` `),x.join(i)}buildDeleteQuery({table:e,where:i,returning:r,withList:n}){let a=this.buildWithCTE(n),s=r?x` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=i?x` where ${i}`:void 0;return x`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,i){let r=e[N.Symbol.Columns],n=Object.keys(r).filter(s=>i[s]!==void 0||r[s]?.onUpdateFn!==void 0),a=n.length;return x.join(n.flatMap((s,o)=>{let c=r[s],l=i[s]??x.param(c.onUpdateFn(),c),p=x`${x.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<a-1?[p,x.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:i,where:r,returning:n,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),l=e[We.Symbol.Name],p=e[We.Symbol.Schema],u=e[We.Symbol.OriginalName],d=l===u?void 0:l,f=x`${p?x`${x.identifier(p)}.`:void 0}${x.identifier(u)}${d&&x` ${x.identifier(d)}`}`,m=this.buildUpdateSet(e,i),h=s&&x.join([x.raw(" from "),this.buildFromTable(s)]),y=this.buildJoins(o),b=n?x` returning ${this.buildSelection(n,{isSingleTable:!s})}`:void 0,T=r?x` where ${r}`:void 0;return x`${c}update ${f} set ${m}${h}${y}${T}${b}`}buildSelection(e,{isSingleTable:i=!1}={}){let r=e.length,n=e.flatMap(({field:a},s)=>{let o=[];if(w(a,M.Aliased)&&a.isSelectionField)o.push(x.identifier(a.fieldAlias));else if(w(a,M.Aliased)||w(a,M)){let c=w(a,M.Aliased)?a.sql:a;i?o.push(new M(c.queryChunks.map(l=>w(l,P)?x.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),w(a,M.Aliased)&&o.push(x` as ${x.identifier(a.fieldAlias)}`)}else w(a,ae)&&(i?o.push(x.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<r-1&&o.push(x`, `),o});return x.join(n)}buildJoins(e){if(!e||e.length===0)return;let i=[];for(let[r,n]of e.entries()){r===0&&i.push(x` `);let a=n.table,s=n.lateral?x` lateral`:void 0;if(w(a,We)){let o=a[We.Symbol.Name],c=a[We.Symbol.Schema],l=a[We.Symbol.OriginalName],p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else if(w(a,ot)){let o=a[xe].name,c=a[xe].schema,l=a[xe].originalName,p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else i.push(x`${x.raw(n.joinType)} join${s} ${a} on ${n.on}`);r<e.length-1&&i.push(x` `)}return x.join(i)}buildFromTable(e){if(w(e,N)&&e[N.Symbol.OriginalName]!==e[N.Symbol.Name]){let i=x`${x.identifier(e[N.Symbol.OriginalName])}`;return e[N.Symbol.Schema]&&(i=x`${x.identifier(e[N.Symbol.Schema])}.${i}`),x`${i} ${x.identifier(e[N.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:i,fieldsFlat:r,where:n,having:a,table:s,joins:o,orderBy:c,groupBy:l,limit:p,offset:u,lockingClause:d,distinct:f,setOperators:m}){let h=r??Nt(i);for(let te of h)if(w(te.field,ae)&&vt(te.field.table)!==(w(s,Le)?s._.alias:w(s,Fn)?s[xe].name:w(s,M)?void 0:vt(s))&&!(ie=>o?.some(({alias:Y})=>Y===(ie[N.Symbol.IsAlias]?vt(ie):ie[N.Symbol.BaseName])))(te.field.table)){let ie=vt(te.field.table);throw new Error(`Your "${te.path.join("->")}" field references a column "${ie}"."${te.field.name}", but the table "${ie}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,b=this.buildWithCTE(e),T;f&&(T=f===!0?x` distinct`:x` distinct on (${x.join(f.on,x`, `)})`);let _=this.buildSelection(h,{isSingleTable:y}),A=this.buildFromTable(s),O=this.buildJoins(o),E=n?x` where ${n}`:void 0,C=a?x` having ${a}`:void 0,I;c&&c.length>0&&(I=x` order by ${x.join(c,x`, `)}`);let z;l&&l.length>0&&(z=x` group by ${x.join(l,x`, `)}`);let me=typeof p=="object"||typeof p=="number"&&p>=0?x` limit ${p}`:void 0,Ee=u?x` offset ${u}`:void 0,ye=x.empty();if(d){let te=x` for ${x.raw(d.strength)}`;d.config.of&&te.append(x` of ${x.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],x`, `)}`),d.config.noWait?te.append(x` no wait`):d.config.skipLocked&&te.append(x` skip locked`),ye.append(te)}let G=x`${b}select${T} ${_} from ${A}${O}${E}${z}${C}${I}${me}${Ee}${ye}`;return m.length>0?this.buildSetOperations(G,m):G}buildSetOperations(e,i){let[r,...n]=i;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:i,isAll:r,rightSelect:n,limit:a,orderBy:s,offset:o}}){let c=x`(${e.getSQL()}) `,l=x`(${n.getSQL()})`,p;if(s&&s.length>0){let m=[];for(let h of s)if(w(h,P))m.push(x.identifier(h.name));else if(w(h,M)){for(let y=0;y<h.queryChunks.length;y++){let b=h.queryChunks[y];w(b,P)&&(h.queryChunks[y]=x.identifier(b.name))}m.push(x`${h}`)}else m.push(x`${h}`);p=x` order by ${x.join(m,x`, `)} `}let u=typeof a=="object"||typeof a=="number"&&a>=0?x` limit ${a}`:void 0,d=x.raw(`${i} ${r?"all ":""}`),f=o?x` offset ${o}`:void 0;return x`${c}${d}${l}${p}${u}${f}`}buildInsertQuery({table:e,values:i,onConflict:r,returning:n,withList:a,select:s,overridingSystemValue_:o}){let c=[],l=e[N.Symbol.Columns],p=Object.entries(l).filter(([b,T])=>!T.shouldDisableInsert()),u=p.map(([,b])=>x.identifier(this.casing.getColumnCasing(b)));if(s){let b=i;w(b,M)?c.push(b):c.push(b.getSQL())}else{let b=i;c.push(x.raw("values "));for(let[T,_]of b.entries()){let A=[];for(let[O,E]of p){let C=_[O];if(C===void 0||w(C,xt)&&C.value===void 0)if(E.defaultFn!==void 0){let I=E.defaultFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else if(!E.default&&E.onUpdateFn!==void 0){let I=E.onUpdateFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else A.push(x`default`);else A.push(C)}c.push(A),T<b.length-1&&c.push(x`, `)}}let d=this.buildWithCTE(a),f=x.join(c),m=n?x` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,h=r?x` on conflict ${r}`:void 0,y=o===!0?x`overriding system value `:void 0;return x`${d}insert into ${e} ${u} ${y}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:i,withNoData:r}){let n=i?x` concurrently`:void 0,a=r?x` with no data`:void 0;return x`refresh materialized view${n} ${e}${a}`}prepareTyping(e){return w(e,ks)||w(e,Es)?"json":w(e,Ts)?"decimal":w(e,As)?"time":w(e,Cs)||w(e,Ps)?"timestamp":w(e,_s)||w(e,Ss)?"date":w(e,js)?"uuid":"none"}sqlToQuery(e,i){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:i})}buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:n,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let p=[],u,d,f=[],m,h=[];if(s===!0)p=Object.entries(a.columns).map(([T,_])=>({dbKey:_.name,tsKey:T,field:ci(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([C,I])=>[C,ci(I,o)]));if(s.where){let C=typeof s.where=="function"?s.where(b,$S()):s.where;m=C&&xs(C,o)}let T=[],_=[];if(s.columns){let C=!1;for(let[I,z]of Object.entries(s.columns))z!==void 0&&I in a.columns&&(!C&&z===!0&&(C=!0),_.push(I));_.length>0&&(_=C?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let C of _){let I=a.columns[C];T.push({tsKey:C,value:I})}let A=[];s.with&&(A=Object.entries(s.with).filter(C=>!!C[1]).map(([C,I])=>({tsKey:C,queryConfig:I,relation:a.relations[C]})));let O;if(s.extras){O=typeof s.extras=="function"?s.extras(b,{sql:x}):s.extras;for(let[C,I]of Object.entries(O))T.push({tsKey:C,value:Cd(I,o)})}for(let{tsKey:C,value:I}of T)p.push({dbKey:w(I,M.Aliased)?I.fieldAlias:a.columns[C].name,tsKey:C,field:w(I,ae)?ci(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof s.orderBy=="function"?s.orderBy(b,HS()):s.orderBy??[];Array.isArray(E)||(E=[E]),f=E.map(C=>w(C,ae)?ci(C,o):xs(C,o)),u=s.limit,d=s.offset;for(let{tsKey:C,queryConfig:I,relation:z}of A){let me=QS(i,r,z),Ee=kr(z.referencedTable),ye=r[Ee],G=`${o}_${C}`,te=bs(...me.fields.map((H,Pe)=>Se(ci(me.references[Pe],G),ci(H,o)))),ie=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:e[ye],tableConfig:i[ye],queryConfig:w(z,Qi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:G,joinOn:te,nestedQueryRelation:z}),Y=x`${x.identifier(G)}.${x.identifier("data")}`.as(C);h.push({on:x`true`,table:new Le(ie.sql,{},G),alias:G,joinType:"left",lateral:!0}),p.push({dbKey:C,tsKey:C,field:Y,relationTableTsKey:ye,isJson:!0,selection:ie.selection})}}if(p.length===0)throw new ys({message:`No fields selected for table "${a.tsName}" ("${o}")`});let y;if(m=bs(l,m),c){let b=x`json_build_array(${x.join(p.map(({field:A,tsKey:O,isJson:E})=>E?x`${x.identifier(`${o}_${O}`)}.${x.identifier("data")}`:w(A,M.Aliased)?A.sql:A),x`, `)})`;w(c,Ns)&&(b=x`coalesce(json_agg(${b}${f.length>0?x` order by ${x.join(f,x`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:p}];u!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:[{path:[],field:x.raw("*")}],where:m,limit:u,offset:d,orderBy:f,setOperators:[]}),m=void 0,u=void 0,d=void 0,f=[]):y=vs(n,o),y=this.buildSelectQuery({table:w(y,We)?y:new Le(y,{},o),fields:{},fieldsFlat:T.map(({field:A})=>({path:[],field:w(A,ae)?ci(A,o):A})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:p.map(({field:b})=>({path:[],field:w(b,ae)?ci(b,o):b})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:y,selection:p}}};var Bc=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var Ye=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let i=!!this.fields,r=e,n;return this.fields?n=this.fields:w(r,Le)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(a=>[a,r[a]])):w(r,Fn)?n=r[xe].selectedFields:w(r,M)?n={}:n=qc(r),new zc({table:r,fields:n,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Zf=class extends Bc{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:i,isPartialSelect:r,session:n,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...i},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=a,this._={selectedFields:i},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(i,r)=>{let n=this.tableName,a=ki(i);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof a=="string"&&!w(i,M))){let s=w(i,Le)?i._.selectedFields:w(i,ot)?i[xe].selectedFields:i[N.Symbol.Columns];this.config.fields[a]=s}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:i,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,i){return r=>{let n=typeof r=="function"?r(o9()):r;if(!ws(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:i,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(i)?i:[i]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(i)?i:[i];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let i=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,i={}){return this.config.lockingClause={strength:e,config:i},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}as(e){return new Proxy(new Le(this.getSQL(),this.config.fields,e),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Oe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},zc=class extends Zf{static[v]="PgSelect";_prepare(e){let{session:i,config:r,dialect:n,joinsNotNullableMap:a,authToken:s}=this;if(!i)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ve.startActiveSpan("drizzle.prepareQuery",()=>{let o=Nt(r.fields),c=i.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(zc,[Je]);function Un(t,e){return(i,r,...n)=>{let a=[r,...n].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!ws(i.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(a)}}var o9=()=>({union:c9,unionAll:l9,intersect:p9,intersectAll:u9,except:d9,exceptAll:f9}),c9=Un("union",!1),l9=Un("union",!0),p9=Un("intersect",!1),u9=Un("intersect",!0),d9=Un("except",!1),f9=Un("except",!0);var $n=class{static[v]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=w(e,Gi)?e:void 0,this.dialectConfig=w(e,Gi)?void 0:e}$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(r)),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let i=this;function r(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),withList:e})}function n(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),distinct:!0})}function a(s,o){return new Ye({fields:o??void 0,session:void 0,dialect:i.getDialect(),distinct:{on:s}})}return{select:r,selectDistinct:n,selectDistinctOn:a}}select(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Gi(this.dialectConfig)),this.dialect}};var Is=class{constructor(e,i,r,n,a){this.table=e,this.session=i,this.dialect=r,this.withList=n,this.overridingSystemValue_=a}static[v]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let i=e.map(r=>{let n={},a=this.table[N.Symbol.Columns];for(let s of Object.keys(r)){let o=r[s];n[s]=w(o,M)?o:new xt(o,a[s])}return n});return new Fc(this.table,i,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let i=typeof e=="function"?e(new $n):e;if(!w(i,M)&&!ws(this.table[Pc],i._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Fc(this.table,i,this.session,this.dialect,this.withList,!0)}},Fc=class extends Je{constructor(e,i,r,n,a,s,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:i,withList:a,select:s,overridingSystemValue_:o}}static[v]="PgInsert";config;returning(e=this.config.table[N.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Nt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=x`do nothing`;else{let i="";i=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?x` where ${e.where}`:void 0;this.config.onConflict=x`(${x.raw(i)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let i=e.where?x` where ${e.where}`:void 0,r=e.targetWhere?x` where ${e.targetWhere}`:void 0,n=e.setWhere?x` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ic(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=x`(${x.raw(s)})${r} do update set ${a}${i}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Uc=class extends Je{constructor(e,i,r){super(),this.session=i,this.dialect=r,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var qs=class{constructor(e,i,r,n){this.table=e,this.session=i,this.dialect=r,this.withList=n}static[v]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Xf(this.table,Ic(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Xf=class extends Je{constructor(e,i,r,n,a){super(),this.session=r,this.dialect=n,this.config={set:i,table:e,withList:a,joins:[]},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[v]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let i=e,r=ki(i);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=i,this}getTableLikeFields(e){return w(e,We)?e[N.Symbol.Columns]:w(e,Le)?e._.selectedFields:e[xe].selectedFields}createJoin(e){return(i,r)=>{let n=ki(i);if(typeof n=="string"&&this.config.joins.some(a=>a.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let a=this.config.from&&!w(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[N.Symbol.Columns],new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:i,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[N.Symbol.Columns]),this.config.from)){let i=ki(this.config.from);if(typeof i=="string"&&this.config.from&&!w(this.config.from,M)){let r=this.getTableLikeFields(this.config.from);e[i]=r}for(let r of this.config.joins){let n=ki(r.table);if(typeof n=="string"&&!w(r.table,M)){let a=this.getTableLikeFields(r.table);e[n]=a}}}return this.config.returningFields=e,this.config.returning=Nt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){let i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var $c=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[v]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,i){return x`(select count(*) from ${e}${x.raw(" where ").if(i)}${i})`}static buildCount(e,i){return x`select count(*) as count from ${e}${x.raw(" where ").if(i)}${i};`}setToken(e){return this.token=e,this}then(e,i){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,i)}catch(e){return this.then(void 0,e)}finally(e){return this.then(i=>(e?.(),i),i=>{throw e?.(),i})}};var Hc=class{constructor(e,i,r,n,a,s,o){this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vc=class extends Je{constructor(e,i,r,n,a,s,o,c,l){super(),this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[v]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:i,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,a)=>{let s=n.map(o=>Lc(this.schema,this.tableConfig,o,i.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),i=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:i}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Qc=class extends Je{constructor(e,i,r,n){super(),this.execute=e,this.sql=i,this.query=r,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,i){return i?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Hn=class{constructor(e,i,r){if(this.dialect=e,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:i}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:i},this.query={},this._.schema)for(let[n,a]of Object.entries(this._.schema))this.query[n]=new Hc(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],a,e,i)}static[v]="PgDatabase";query;$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(new $n(r.dialect))),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,i){return new $c({source:e,filters:i,session:this.session})}with(...e){let i=this;function r(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e})}function n(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:!0})}function a(l,p){return new Ye({fields:p??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:{on:l}})}function s(l){return new qs(l,i.session,i.dialect,e)}function o(l){return new Is(l,i.session,i.dialect,e)}function c(l){return new Os(l,i.session,i.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new qs(e,this.session,this.dialect)}insert(e){return new Is(e,this.session,this.dialect)}delete(e){return new Os(e,this.session,this.dialect)}refreshMaterializedView(e){return new Uc(e,this.session,this.dialect)}authToken;execute(e){let i=typeof e=="string"?x.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(i),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Qc(()=>n.execute(void 0,this.authToken),i,r,a=>n.mapResult(a,!0))}transaction(e,i){return this.session.transaction(e,i)}};var Gc=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,i){return e}setToken(e){return this.authToken=e,this}static[v]="PgPreparedQuery";joinsNotNullableMap},Wc=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e,i){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(i).execute(void 0,i))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,i){let r=await this.execute(e,i);return Number(r[0].count)}},Kc=class extends Hn{constructor(e,i,r,n=0){super(e,i,r),this.schema=r,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new jc}getTransactionConfigSQL(e){let i=[];return e.isolationLevel&&i.push(`isolation level ${e.isolationLevel}`),e.accessMode&&i.push(e.accessMode),typeof e.deferrable=="boolean"&&i.push(e.deferrable?"deferrable":"not deferrable"),x.raw(i.join(" "))}setTransaction(e){return this.session.execute(x`set transaction ${this.getTransactionConfigSQL(e)}`)}};var ee;(function(t){t.assertEqual=n=>n;function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{let a={};for(let s of n)a[s]=s;return a},t.getValidEnumValues=n=>{let a=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(let o of a)s[o]=n[o];return t.objectValues(s)},t.objectValues=n=>t.objectKeys(n).map(function(a){return n[a]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let a=[];for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&a.push(s);return a},t.find=(n,a)=>{for(let s of n)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,a=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(ee||(ee={}));var Yf;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(Yf||(Yf={}));var q=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pi=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},S=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),kt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){let i=e||function(a){return a.message},r={_errors:[]},n=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(i(s));else{let o=r,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(i(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){let i={},r=[];for(let n of this.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}};kt.create=t=>new kt(t);var Gn=(t,e)=>{let i;switch(t.code){case S.invalid_type:t.received===q.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:i=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case S.invalid_union:i="Invalid input";break;case S.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case S.invalid_enum_value:i=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:i="Invalid function arguments";break;case S.invalid_return_type:i="Invalid function return type";break;case S.invalid_date:i="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case S.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case S.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case S.custom:i="Invalid input";break;case S.invalid_intersection_types:i="Intersection results could not be merged";break;case S.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:i="Number must be finite";break;default:i=e.defaultError,ee.assertNever(t)}return{message:i}},XS=Gn;function h9(t){XS=t}function Zc(){return XS}var Xc=t=>{let{data:e,path:i,errorMaps:r,issueData:n}=t,a=[...i,...n.path||[]],s={...n,path:a};if(n.message!==void 0)return{...n,path:a,message:n.message};let o="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)o=l(s,{data:e,defaultError:o}).message;return{...n,path:a,message:o}},g9=[];function j(t,e){let i=Zc(),r=Xc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Gn?void 0:Gn].filter(n=>!!n)});t.common.issues.push(r)}var et=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){let r=[];for(let n of i){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){let r=[];for(let n of i){let a=await n.key,s=await n.value;r.push({key:a,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,i){let r={};for(let n of i){let{key:a,value:s}=n;if(a.status==="aborted"||s.status==="aborted")return F;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}},F=Object.freeze({status:"aborted"}),Qn=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),em=t=>t.status==="aborted",tm=t=>t.status==="dirty",Cr=t=>t.status==="valid",Ls=t=>typeof Promise<"u"&&t instanceof Promise;function Jc(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function JS(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ms,Rs,qt=class{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WS=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new kt(t.common.issues);return this._error=i,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(s,o)=>{var c,l;let{message:p}=t;return s.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:o.defaultError}},description:n}}var Q=class{get description(){return this._def.description}_getType(e){return Pi(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new et,ctx:{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let i=this._parse(e);if(Ls(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){let i=this._parse(e);return Promise.resolve(i)}parse(e,i){let r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){var r;let n={common:{issues:[],async:(r=i?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},a=this._parseSync({data:e,path:n.path,parent:n});return WS(n,a)}"~validate"(e){var i,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:n});return Cr(a)?{value:a.value}:{issues:n.common.issues}}catch(a){!((r=(i=a?.message)===null||i===void 0?void 0:i.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>Cr(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,i){let r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){let r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(Ls(n)?n:Promise.resolve(n));return WS(r,a)}refine(e,i){let r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,a)=>{let s=e(n),o=()=>a.addIssue({code:S.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new Tt({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return It.create(this,this._def)}nullable(){return ui.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ni.create(this)}promise(){return Zi.create(this,this._def)}or(e){return Mr.create([this,e],this._def)}and(e){return Rr.create(this,e,this._def)}transform(e){return new Tt({...V(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let i=typeof e=="function"?e:()=>e;return new Fr({...V(this._def),innerType:this,defaultValue:i,typeName:B.ZodDefault})}brand(){return new Ds({typeName:B.ZodBranded,type:this,...V(this._def)})}catch(e){let i=typeof e=="function"?e:()=>e;return new Ur({...V(this._def),innerType:this,catchValue:i,typeName:B.ZodCatch})}describe(e){let i=this.constructor;return new i({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},v9=/^c[^\s-]{8,}$/i,x9=/^[0-9a-z]+$/,y9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w9=/^[a-z0-9_-]{21}$/i,_9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,k9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jf,T9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,A9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,YS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",O9=new RegExp(`^${YS}$`);function eE(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function I9(t){return new RegExp(`^${eE(t)}$`)}function tE(t){let e=`${YS}T${eE(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function q9(t,e){return!!((e==="v4"||!e)&&T9.test(t)||(e==="v6"||!e)&&C9.test(t))}function M9(t,e){if(!_9.test(t))return!1;try{let[i]=t.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function R9(t,e){return!!((e==="v4"||!e)&&A9.test(t)||(e==="v6"||!e)&&P9.test(t))}var Wi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.string,received:a.parsedType}),F}let r=new et,n;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Jf||(Jf=new RegExp(k9,"u")),Jf.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")b9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")w9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")v9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")x9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")y9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),j(n,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?tE(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?O9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?I9(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?S9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?q9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M9(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?R9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?N9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):ee.assertNever(a);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:S.invalid_string,...L.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var i,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...L.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...L.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...L.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...L.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...L.errToObj(i)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:B.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};function L9(t,e){let i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,a=parseInt(t.toFixed(n).replace(".","")),s=parseInt(e.toFixed(n).replace(".",""));return a%s/Math.pow(10,n)}var Pr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.number,received:a.parsedType}),F}let r,n=new et;for(let a of this._def.checks)a.kind==="int"?ee.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?L9(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_finite,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,i=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Pr.create=t=>new Pr({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...V(t)});var jr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let r,n=new et;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.bigint,received:i.parsedType}),F}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};jr.create=t=>{var e;return new jr({checks:[],typeName:B.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};var Nr=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.boolean,received:r.parsedType}),F}return ct(e.data)}};Nr.create=t=>new Nr({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var Or=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.date,received:a.parsedType}),F}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_date}),F}let r=new et,n;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ee.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(i)})}get minDate(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Or.create=t=>new Or({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...V(t)});var Wn=class extends Q{_parse(e){if(this._getType(e)!==q.symbol){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.symbol,received:r.parsedType}),F}return ct(e.data)}};Wn.create=t=>new Wn({typeName:B.ZodSymbol,...V(t)});var Ir=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.undefined,received:r.parsedType}),F}return ct(e.data)}};Ir.create=t=>new Ir({typeName:B.ZodUndefined,...V(t)});var qr=class extends Q{_parse(e){if(this._getType(e)!==q.null){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.null,received:r.parsedType}),F}return ct(e.data)}};qr.create=t=>new qr({typeName:B.ZodNull,...V(t)});var Ki=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};Ki.create=t=>new Ki({typeName:B.ZodAny,...V(t)});var ji=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};ji.create=t=>new ji({typeName:B.ZodUnknown,...V(t)});var Wt=class extends Q{_parse(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.never,received:i.parsedType}),F}};Wt.create=t=>new Wt({typeName:B.ZodNever,...V(t)});var Kn=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.void,received:r.parsedType}),F}return ct(e.data)}};Kn.create=t=>new Kn({typeName:B.ZodVoid,...V(t)});var Ni=class t extends Q{_parse(e){let{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==q.array)return j(i,{code:S.invalid_type,expected:q.array,received:i.parsedType}),F;if(n.exactLength!==null){let s=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(s||o)&&(j(i,{code:s?S.too_big:S.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(j(i,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dnpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:145
/app/dist/index.cjs:145
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
		`;await i.execute(x`CREATE SCHEMA IF NOT EXISTS ${x.identifier(a)}`),await i.execute(s);let c=(await i.all(x`select id, hash, created_at from ${x.identifier(a)}.${x.identifier(n)} order by created_at desc limit 1`))[0];await i.transaction(async l=>{for await(let p of e)if(!c||Number(c.created_at)<p.folderMillis){for(let u of p.sql)await l.execute(x.raw(u));await l.execute(x`insert into ${x.identifier(a)}.${x.identifier(n)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let i=[x`with `];for(let[r,n]of e.entries())i.push(x`${x.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&i.push(x`, `);return i.push(x` `),x.join(i)}buildDeleteQuery({table:e,where:i,returning:r,withList:n}){let a=this.buildWithCTE(n),s=r?x` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=i?x` where ${i}`:void 0;return x`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,i){let r=e[N.Symbol.Columns],n=Object.keys(r).filter(s=>i[s]!==void 0||r[s]?.onUpdateFn!==void 0),a=n.length;return x.join(n.flatMap((s,o)=>{let c=r[s],l=i[s]??x.param(c.onUpdateFn(),c),p=x`${x.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<a-1?[p,x.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:i,where:r,returning:n,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),l=e[We.Symbol.Name],p=e[We.Symbol.Schema],u=e[We.Symbol.OriginalName],d=l===u?void 0:l,f=x`${p?x`${x.identifier(p)}.`:void 0}${x.identifier(u)}${d&&x` ${x.identifier(d)}`}`,m=this.buildUpdateSet(e,i),h=s&&x.join([x.raw(" from "),this.buildFromTable(s)]),y=this.buildJoins(o),b=n?x` returning ${this.buildSelection(n,{isSingleTable:!s})}`:void 0,T=r?x` where ${r}`:void 0;return x`${c}update ${f} set ${m}${h}${y}${T}${b}`}buildSelection(e,{isSingleTable:i=!1}={}){let r=e.length,n=e.flatMap(({field:a},s)=>{let o=[];if(w(a,M.Aliased)&&a.isSelectionField)o.push(x.identifier(a.fieldAlias));else if(w(a,M.Aliased)||w(a,M)){let c=w(a,M.Aliased)?a.sql:a;i?o.push(new M(c.queryChunks.map(l=>w(l,P)?x.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),w(a,M.Aliased)&&o.push(x` as ${x.identifier(a.fieldAlias)}`)}else w(a,ae)&&(i?o.push(x.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<r-1&&o.push(x`, `),o});return x.join(n)}buildJoins(e){if(!e||e.length===0)return;let i=[];for(let[r,n]of e.entries()){r===0&&i.push(x` `);let a=n.table,s=n.lateral?x` lateral`:void 0;if(w(a,We)){let o=a[We.Symbol.Name],c=a[We.Symbol.Schema],l=a[We.Symbol.OriginalName],p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else if(w(a,ot)){let o=a[xe].name,c=a[xe].schema,l=a[xe].originalName,p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else i.push(x`${x.raw(n.joinType)} join${s} ${a} on ${n.on}`);r<e.length-1&&i.push(x` `)}return x.join(i)}buildFromTable(e){if(w(e,N)&&e[N.Symbol.OriginalName]!==e[N.Symbol.Name]){let i=x`${x.identifier(e[N.Symbol.OriginalName])}`;return e[N.Symbol.Schema]&&(i=x`${x.identifier(e[N.Symbol.Schema])}.${i}`),x`${i} ${x.identifier(e[N.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:i,fieldsFlat:r,where:n,having:a,table:s,joins:o,orderBy:c,groupBy:l,limit:p,offset:u,lockingClause:d,distinct:f,setOperators:m}){let h=r??Nt(i);for(let te of h)if(w(te.field,ae)&&vt(te.field.table)!==(w(s,Le)?s._.alias:w(s,Fn)?s[xe].name:w(s,M)?void 0:vt(s))&&!(ie=>o?.some(({alias:Y})=>Y===(ie[N.Symbol.IsAlias]?vt(ie):ie[N.Symbol.BaseName])))(te.field.table)){let ie=vt(te.field.table);throw new Error(`Your "${te.path.join("->")}" field references a column "${ie}"."${te.field.name}", but the table "${ie}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,b=this.buildWithCTE(e),T;f&&(T=f===!0?x` distinct`:x` distinct on (${x.join(f.on,x`, `)})`);let _=this.buildSelection(h,{isSingleTable:y}),A=this.buildFromTable(s),O=this.buildJoins(o),E=n?x` where ${n}`:void 0,C=a?x` having ${a}`:void 0,I;c&&c.length>0&&(I=x` order by ${x.join(c,x`, `)}`);let z;l&&l.length>0&&(z=x` group by ${x.join(l,x`, `)}`);let me=typeof p=="object"||typeof p=="number"&&p>=0?x` limit ${p}`:void 0,Ee=u?x` offset ${u}`:void 0,ye=x.empty();if(d){let te=x` for ${x.raw(d.strength)}`;d.config.of&&te.append(x` of ${x.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],x`, `)}`),d.config.noWait?te.append(x` no wait`):d.config.skipLocked&&te.append(x` skip locked`),ye.append(te)}let G=x`${b}select${T} ${_} from ${A}${O}${E}${z}${C}${I}${me}${Ee}${ye}`;return m.length>0?this.buildSetOperations(G,m):G}buildSetOperations(e,i){let[r,...n]=i;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:i,isAll:r,rightSelect:n,limit:a,orderBy:s,offset:o}}){let c=x`(${e.getSQL()}) `,l=x`(${n.getSQL()})`,p;if(s&&s.length>0){let m=[];for(let h of s)if(w(h,P))m.push(x.identifier(h.name));else if(w(h,M)){for(let y=0;y<h.queryChunks.length;y++){let b=h.queryChunks[y];w(b,P)&&(h.queryChunks[y]=x.identifier(b.name))}m.push(x`${h}`)}else m.push(x`${h}`);p=x` order by ${x.join(m,x`, `)} `}let u=typeof a=="object"||typeof a=="number"&&a>=0?x` limit ${a}`:void 0,d=x.raw(`${i} ${r?"all ":""}`),f=o?x` offset ${o}`:void 0;return x`${c}${d}${l}${p}${u}${f}`}buildInsertQuery({table:e,values:i,onConflict:r,returning:n,withList:a,select:s,overridingSystemValue_:o}){let c=[],l=e[N.Symbol.Columns],p=Object.entries(l).filter(([b,T])=>!T.shouldDisableInsert()),u=p.map(([,b])=>x.identifier(this.casing.getColumnCasing(b)));if(s){let b=i;w(b,M)?c.push(b):c.push(b.getSQL())}else{let b=i;c.push(x.raw("values "));for(let[T,_]of b.entries()){let A=[];for(let[O,E]of p){let C=_[O];if(C===void 0||w(C,xt)&&C.value===void 0)if(E.defaultFn!==void 0){let I=E.defaultFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else if(!E.default&&E.onUpdateFn!==void 0){let I=E.onUpdateFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else A.push(x`default`);else A.push(C)}c.push(A),T<b.length-1&&c.push(x`, `)}}let d=this.buildWithCTE(a),f=x.join(c),m=n?x` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,h=r?x` on conflict ${r}`:void 0,y=o===!0?x`overriding system value `:void 0;return x`${d}insert into ${e} ${u} ${y}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:i,withNoData:r}){let n=i?x` concurrently`:void 0,a=r?x` with no data`:void 0;return x`refresh materialized view${n} ${e}${a}`}prepareTyping(e){return w(e,ks)||w(e,Es)?"json":w(e,Ts)?"decimal":w(e,As)?"time":w(e,Cs)||w(e,Ps)?"timestamp":w(e,_s)||w(e,Ss)?"date":w(e,js)?"uuid":"none"}sqlToQuery(e,i){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:i})}buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:n,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let p=[],u,d,f=[],m,h=[];if(s===!0)p=Object.entries(a.columns).map(([T,_])=>({dbKey:_.name,tsKey:T,field:ci(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([C,I])=>[C,ci(I,o)]));if(s.where){let C=typeof s.where=="function"?s.where(b,$S()):s.where;m=C&&xs(C,o)}let T=[],_=[];if(s.columns){let C=!1;for(let[I,z]of Object.entries(s.columns))z!==void 0&&I in a.columns&&(!C&&z===!0&&(C=!0),_.push(I));_.length>0&&(_=C?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let C of _){let I=a.columns[C];T.push({tsKey:C,value:I})}let A=[];s.with&&(A=Object.entries(s.with).filter(C=>!!C[1]).map(([C,I])=>({tsKey:C,queryConfig:I,relation:a.relations[C]})));let O;if(s.extras){O=typeof s.extras=="function"?s.extras(b,{sql:x}):s.extras;for(let[C,I]of Object.entries(O))T.push({tsKey:C,value:Cd(I,o)})}for(let{tsKey:C,value:I}of T)p.push({dbKey:w(I,M.Aliased)?I.fieldAlias:a.columns[C].name,tsKey:C,field:w(I,ae)?ci(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof s.orderBy=="function"?s.orderBy(b,HS()):s.orderBy??[];Array.isArray(E)||(E=[E]),f=E.map(C=>w(C,ae)?ci(C,o):xs(C,o)),u=s.limit,d=s.offset;for(let{tsKey:C,queryConfig:I,relation:z}of A){let me=QS(i,r,z),Ee=kr(z.referencedTable),ye=r[Ee],G=`${o}_${C}`,te=bs(...me.fields.map((H,Pe)=>Se(ci(me.references[Pe],G),ci(H,o)))),ie=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:e[ye],tableConfig:i[ye],queryConfig:w(z,Qi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:G,joinOn:te,nestedQueryRelation:z}),Y=x`${x.identifier(G)}.${x.identifier("data")}`.as(C);h.push({on:x`true`,table:new Le(ie.sql,{},G),alias:G,joinType:"left",lateral:!0}),p.push({dbKey:C,tsKey:C,field:Y,relationTableTsKey:ye,isJson:!0,selection:ie.selection})}}if(p.length===0)throw new ys({message:`No fields selected for table "${a.tsName}" ("${o}")`});let y;if(m=bs(l,m),c){let b=x`json_build_array(${x.join(p.map(({field:A,tsKey:O,isJson:E})=>E?x`${x.identifier(`${o}_${O}`)}.${x.identifier("data")}`:w(A,M.Aliased)?A.sql:A),x`, `)})`;w(c,Ns)&&(b=x`coalesce(json_agg(${b}${f.length>0?x` order by ${x.join(f,x`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:p}];u!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:[{path:[],field:x.raw("*")}],where:m,limit:u,offset:d,orderBy:f,setOperators:[]}),m=void 0,u=void 0,d=void 0,f=[]):y=vs(n,o),y=this.buildSelectQuery({table:w(y,We)?y:new Le(y,{},o),fields:{},fieldsFlat:T.map(({field:A})=>({path:[],field:w(A,ae)?ci(A,o):A})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:p.map(({field:b})=>({path:[],field:w(b,ae)?ci(b,o):b})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:y,selection:p}}};var Bc=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var Ye=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let i=!!this.fields,r=e,n;return this.fields?n=this.fields:w(r,Le)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(a=>[a,r[a]])):w(r,Fn)?n=r[xe].selectedFields:w(r,M)?n={}:n=qc(r),new zc({table:r,fields:n,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Zf=class extends Bc{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:i,isPartialSelect:r,session:n,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...i},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=a,this._={selectedFields:i},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(i,r)=>{let n=this.tableName,a=ki(i);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof a=="string"&&!w(i,M))){let s=w(i,Le)?i._.selectedFields:w(i,ot)?i[xe].selectedFields:i[N.Symbol.Columns];this.config.fields[a]=s}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:i,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,i){return r=>{let n=typeof r=="function"?r(o9()):r;if(!ws(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:i,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(i)?i:[i]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(i)?i:[i];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let i=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,i={}){return this.config.lockingClause={strength:e,config:i},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}as(e){return new Proxy(new Le(this.getSQL(),this.config.fields,e),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Oe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},zc=class extends Zf{static[v]="PgSelect";_prepare(e){let{session:i,config:r,dialect:n,joinsNotNullableMap:a,authToken:s}=this;if(!i)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ve.startActiveSpan("drizzle.prepareQuery",()=>{let o=Nt(r.fields),c=i.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(zc,[Je]);function Un(t,e){return(i,r,...n)=>{let a=[r,...n].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!ws(i.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(a)}}var o9=()=>({union:c9,unionAll:l9,intersect:p9,intersectAll:u9,except:d9,exceptAll:f9}),c9=Un("union",!1),l9=Un("union",!0),p9=Un("intersect",!1),u9=Un("intersect",!0),d9=Un("except",!1),f9=Un("except",!0);var $n=class{static[v]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=w(e,Gi)?e:void 0,this.dialectConfig=w(e,Gi)?void 0:e}$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(r)),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let i=this;function r(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),withList:e})}function n(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),distinct:!0})}function a(s,o){return new Ye({fields:o??void 0,session:void 0,dialect:i.getDialect(),distinct:{on:s}})}return{select:r,selectDistinct:n,selectDistinctOn:a}}select(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Gi(this.dialectConfig)),this.dialect}};var Is=class{constructor(e,i,r,n,a){this.table=e,this.session=i,this.dialect=r,this.withList=n,this.overridingSystemValue_=a}static[v]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let i=e.map(r=>{let n={},a=this.table[N.Symbol.Columns];for(let s of Object.keys(r)){let o=r[s];n[s]=w(o,M)?o:new xt(o,a[s])}return n});return new Fc(this.table,i,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let i=typeof e=="function"?e(new $n):e;if(!w(i,M)&&!ws(this.table[Pc],i._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Fc(this.table,i,this.session,this.dialect,this.withList,!0)}},Fc=class extends Je{constructor(e,i,r,n,a,s,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:i,withList:a,select:s,overridingSystemValue_:o}}static[v]="PgInsert";config;returning(e=this.config.table[N.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Nt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=x`do nothing`;else{let i="";i=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?x` where ${e.where}`:void 0;this.config.onConflict=x`(${x.raw(i)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let i=e.where?x` where ${e.where}`:void 0,r=e.targetWhere?x` where ${e.targetWhere}`:void 0,n=e.setWhere?x` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ic(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=x`(${x.raw(s)})${r} do update set ${a}${i}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Uc=class extends Je{constructor(e,i,r){super(),this.session=i,this.dialect=r,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var qs=class{constructor(e,i,r,n){this.table=e,this.session=i,this.dialect=r,this.withList=n}static[v]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Xf(this.table,Ic(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Xf=class extends Je{constructor(e,i,r,n,a){super(),this.session=r,this.dialect=n,this.config={set:i,table:e,withList:a,joins:[]},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[v]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let i=e,r=ki(i);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=i,this}getTableLikeFields(e){return w(e,We)?e[N.Symbol.Columns]:w(e,Le)?e._.selectedFields:e[xe].selectedFields}createJoin(e){return(i,r)=>{let n=ki(i);if(typeof n=="string"&&this.config.joins.some(a=>a.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let a=this.config.from&&!w(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[N.Symbol.Columns],new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:i,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[N.Symbol.Columns]),this.config.from)){let i=ki(this.config.from);if(typeof i=="string"&&this.config.from&&!w(this.config.from,M)){let r=this.getTableLikeFields(this.config.from);e[i]=r}for(let r of this.config.joins){let n=ki(r.table);if(typeof n=="string"&&!w(r.table,M)){let a=this.getTableLikeFields(r.table);e[n]=a}}}return this.config.returningFields=e,this.config.returning=Nt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){let i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var $c=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[v]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,i){return x`(select count(*) from ${e}${x.raw(" where ").if(i)}${i})`}static buildCount(e,i){return x`select count(*) as count from ${e}${x.raw(" where ").if(i)}${i};`}setToken(e){return this.token=e,this}then(e,i){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,i)}catch(e){return this.then(void 0,e)}finally(e){return this.then(i=>(e?.(),i),i=>{throw e?.(),i})}};var Hc=class{constructor(e,i,r,n,a,s,o){this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vc=class extends Je{constructor(e,i,r,n,a,s,o,c,l){super(),this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[v]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:i,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,a)=>{let s=n.map(o=>Lc(this.schema,this.tableConfig,o,i.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),i=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:i}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Qc=class extends Je{constructor(e,i,r,n){super(),this.execute=e,this.sql=i,this.query=r,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,i){return i?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Hn=class{constructor(e,i,r){if(this.dialect=e,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:i}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:i},this.query={},this._.schema)for(let[n,a]of Object.entries(this._.schema))this.query[n]=new Hc(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],a,e,i)}static[v]="PgDatabase";query;$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(new $n(r.dialect))),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,i){return new $c({source:e,filters:i,session:this.session})}with(...e){let i=this;function r(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e})}function n(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:!0})}function a(l,p){return new Ye({fields:p??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:{on:l}})}function s(l){return new qs(l,i.session,i.dialect,e)}function o(l){return new Is(l,i.session,i.dialect,e)}function c(l){return new Os(l,i.session,i.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new qs(e,this.session,this.dialect)}insert(e){return new Is(e,this.session,this.dialect)}delete(e){return new Os(e,this.session,this.dialect)}refreshMaterializedView(e){return new Uc(e,this.session,this.dialect)}authToken;execute(e){let i=typeof e=="string"?x.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(i),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Qc(()=>n.execute(void 0,this.authToken),i,r,a=>n.mapResult(a,!0))}transaction(e,i){return this.session.transaction(e,i)}};var Gc=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,i){return e}setToken(e){return this.authToken=e,this}static[v]="PgPreparedQuery";joinsNotNullableMap},Wc=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e,i){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(i).execute(void 0,i))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,i){let r=await this.execute(e,i);return Number(r[0].count)}},Kc=class extends Hn{constructor(e,i,r,n=0){super(e,i,r),this.schema=r,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new jc}getTransactionConfigSQL(e){let i=[];return e.isolationLevel&&i.push(`isolation level ${e.isolationLevel}`),e.accessMode&&i.push(e.accessMode),typeof e.deferrable=="boolean"&&i.push(e.deferrable?"deferrable":"not deferrable"),x.raw(i.join(" "))}setTransaction(e){return this.session.execute(x`set transaction ${this.getTransactionConfigSQL(e)}`)}};var ee;(function(t){t.assertEqual=n=>n;function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{let a={};for(let s of n)a[s]=s;return a},t.getValidEnumValues=n=>{let a=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(let o of a)s[o]=n[o];return t.objectValues(s)},t.objectValues=n=>t.objectKeys(n).map(function(a){return n[a]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let a=[];for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&a.push(s);return a},t.find=(n,a)=>{for(let s of n)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,a=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(ee||(ee={}));var Yf;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(Yf||(Yf={}));var q=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pi=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},S=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),kt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){let i=e||function(a){return a.message},r={_errors:[]},n=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(i(s));else{let o=r,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(i(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){let i={},r=[];for(let n of this.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}};kt.create=t=>new kt(t);var Gn=(t,e)=>{let i;switch(t.code){case S.invalid_type:t.received===q.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:i=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case S.invalid_union:i="Invalid input";break;case S.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case S.invalid_enum_value:i=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:i="Invalid function arguments";break;case S.invalid_return_type:i="Invalid function return type";break;case S.invalid_date:i="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case S.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case S.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case S.custom:i="Invalid input";break;case S.invalid_intersection_types:i="Intersection results could not be merged";break;case S.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:i="Number must be finite";break;default:i=e.defaultError,ee.assertNever(t)}return{message:i}},XS=Gn;function h9(t){XS=t}function Zc(){return XS}var Xc=t=>{let{data:e,path:i,errorMaps:r,issueData:n}=t,a=[...i,...n.path||[]],s={...n,path:a};if(n.message!==void 0)return{...n,path:a,message:n.message};let o="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)o=l(s,{data:e,defaultError:o}).message;return{...n,path:a,message:o}},g9=[];function j(t,e){let i=Zc(),r=Xc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Gn?void 0:Gn].filter(n=>!!n)});t.common.issues.push(r)}var et=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){let r=[];for(let n of i){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){let r=[];for(let n of i){let a=await n.key,s=await n.value;r.push({key:a,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,i){let r={};for(let n of i){let{key:a,value:s}=n;if(a.status==="aborted"||s.status==="aborted")return F;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}},F=Object.freeze({status:"aborted"}),Qn=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),em=t=>t.status==="aborted",tm=t=>t.status==="dirty",Cr=t=>t.status==="valid",Ls=t=>typeof Promise<"u"&&t instanceof Promise;function Jc(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function JS(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ms,Rs,qt=class{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WS=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new kt(t.common.issues);return this._error=i,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(s,o)=>{var c,l;let{message:p}=t;return s.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:o.defaultError}},description:n}}var Q=class{get description(){return this._def.description}_getType(e){return Pi(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new et,ctx:{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let i=this._parse(e);if(Ls(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){let i=this._parse(e);return Promise.resolve(i)}parse(e,i){let r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){var r;let n={common:{issues:[],async:(r=i?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},a=this._parseSync({data:e,path:n.path,parent:n});return WS(n,a)}"~validate"(e){var i,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:n});return Cr(a)?{value:a.value}:{issues:n.common.issues}}catch(a){!((r=(i=a?.message)===null||i===void 0?void 0:i.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>Cr(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,i){let r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){let r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(Ls(n)?n:Promise.resolve(n));return WS(r,a)}refine(e,i){let r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,a)=>{let s=e(n),o=()=>a.addIssue({code:S.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new Tt({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return It.create(this,this._def)}nullable(){return ui.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ni.create(this)}promise(){return Zi.create(this,this._def)}or(e){return Mr.create([this,e],this._def)}and(e){return Rr.create(this,e,this._def)}transform(e){return new Tt({...V(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let i=typeof e=="function"?e:()=>e;return new Fr({...V(this._def),innerType:this,defaultValue:i,typeName:B.ZodDefault})}brand(){return new Ds({typeName:B.ZodBranded,type:this,...V(this._def)})}catch(e){let i=typeof e=="function"?e:()=>e;return new Ur({...V(this._def),innerType:this,catchValue:i,typeName:B.ZodCatch})}describe(e){let i=this.constructor;return new i({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},v9=/^c[^\s-]{8,}$/i,x9=/^[0-9a-z]+$/,y9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w9=/^[a-z0-9_-]{21}$/i,_9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,k9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jf,T9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,A9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,YS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",O9=new RegExp(`^${YS}$`);function eE(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function I9(t){return new RegExp(`^${eE(t)}$`)}function tE(t){let e=`${YS}T${eE(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function q9(t,e){return!!((e==="v4"||!e)&&T9.test(t)||(e==="v6"||!e)&&C9.test(t))}function M9(t,e){if(!_9.test(t))return!1;try{let[i]=t.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function R9(t,e){return!!((e==="v4"||!e)&&A9.test(t)||(e==="v6"||!e)&&P9.test(t))}var Wi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.string,received:a.parsedType}),F}let r=new et,n;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Jf||(Jf=new RegExp(k9,"u")),Jf.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")b9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")w9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")v9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")x9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")y9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),j(n,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?tE(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?O9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?I9(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?S9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?q9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M9(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?R9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?N9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):ee.assertNever(a);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:S.invalid_string,...L.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var i,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...L.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...L.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...L.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...L.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...L.errToObj(i)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:B.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};function L9(t,e){let i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,a=parseInt(t.toFixed(n).replace(".","")),s=parseInt(e.toFixed(n).replace(".",""));return a%s/Math.pow(10,n)}var Pr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.number,received:a.parsedType}),F}let r,n=new et;for(let a of this._def.checks)a.kind==="int"?ee.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?L9(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_finite,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,i=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Pr.create=t=>new Pr({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...V(t)});var jr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let r,n=new et;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.bigint,received:i.parsedType}),F}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};jr.create=t=>{var e;return new jr({checks:[],typeName:B.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};var Nr=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.boolean,received:r.parsedType}),F}return ct(e.data)}};Nr.create=t=>new Nr({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var Or=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.date,received:a.parsedType}),F}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_date}),F}let r=new et,n;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ee.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(i)})}get minDate(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Or.create=t=>new Or({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...V(t)});var Wn=class extends Q{_parse(e){if(this._getType(e)!==q.symbol){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.symbol,received:r.parsedType}),F}return ct(e.data)}};Wn.create=t=>new Wn({typeName:B.ZodSymbol,...V(t)});var Ir=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.undefined,received:r.parsedType}),F}return ct(e.data)}};Ir.create=t=>new Ir({typeName:B.ZodUndefined,...V(t)});var qr=class extends Q{_parse(e){if(this._getType(e)!==q.null){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.null,received:r.parsedType}),F}return ct(e.data)}};qr.create=t=>new qr({typeName:B.ZodNull,...V(t)});var Ki=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};Ki.create=t=>new Ki({typeName:B.ZodAny,...V(t)});var ji=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};ji.create=t=>new ji({typeName:B.ZodUnknown,...V(t)});var Wt=class extends Q{_parse(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.never,received:i.parsedType}),F}};Wt.create=t=>new Wt({typeName:B.ZodNever,...V(t)});var Kn=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.void,received:r.parsedType}),F}return ct(e.data)}};Kn.create=t=>new Kn({typeName:B.ZodVoid,...V(t)});var Ni=class t extends Q{_parse(e){let{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==q.array)return j(i,{code:S.invalid_type,expected:q.array,received:i.parsedType}),F;if(n.exactLength!==null){let s=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(s||o)&&(j(i,{code:s?S.too_big:S.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(j(i,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dnpm warn config production Use `--omit=dev` instead.
		`;await i.execute(x`CREATE SCHEMA IF NOT EXISTS ${x.identifier(a)}`),await i.execute(s);let c=(await i.all(x`select id, hash, created_at from ${x.identifier(a)}.${x.identifier(n)} order by created_at desc limit 1`))[0];await i.transaction(async l=>{for await(let p of e)if(!c||Number(c.created_at)<p.folderMillis){for(let u of p.sql)await l.execute(x.raw(u));await l.execute(x`insert into ${x.identifier(a)}.${x.identifier(n)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let i=[x`with `];for(let[r,n]of e.entries())i.push(x`${x.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&i.push(x`, `);return i.push(x` `),x.join(i)}buildDeleteQuery({table:e,where:i,returning:r,withList:n}){let a=this.buildWithCTE(n),s=r?x` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=i?x` where ${i}`:void 0;return x`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,i){let r=e[N.Symbol.Columns],n=Object.keys(r).filter(s=>i[s]!==void 0||r[s]?.onUpdateFn!==void 0),a=n.length;return x.join(n.flatMap((s,o)=>{let c=r[s],l=i[s]??x.param(c.onUpdateFn(),c),p=x`${x.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<a-1?[p,x.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:i,where:r,returning:n,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),l=e[We.Symbol.Name],p=e[We.Symbol.Schema],u=e[We.Symbol.OriginalName],d=l===u?void 0:l,f=x`${p?x`${x.identifier(p)}.`:void 0}${x.identifier(u)}${d&&x` ${x.identifier(d)}`}`,m=this.buildUpdateSet(e,i),h=s&&x.join([x.raw(" from "),this.buildFromTable(s)]),y=this.buildJoins(o),b=n?x` returning ${this.buildSelection(n,{isSingleTable:!s})}`:void 0,T=r?x` where ${r}`:void 0;return x`${c}update ${f} set ${m}${h}${y}${T}${b}`}buildSelection(e,{isSingleTable:i=!1}={}){let r=e.length,n=e.flatMap(({field:a},s)=>{let o=[];if(w(a,M.Aliased)&&a.isSelectionField)o.push(x.identifier(a.fieldAlias));else if(w(a,M.Aliased)||w(a,M)){let c=w(a,M.Aliased)?a.sql:a;i?o.push(new M(c.queryChunks.map(l=>w(l,P)?x.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),w(a,M.Aliased)&&o.push(x` as ${x.identifier(a.fieldAlias)}`)}else w(a,ae)&&(i?o.push(x.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<r-1&&o.push(x`, `),o});return x.join(n)}buildJoins(e){if(!e||e.length===0)return;let i=[];for(let[r,n]of e.entries()){r===0&&i.push(x` `);let a=n.table,s=n.lateral?x` lateral`:void 0;if(w(a,We)){let o=a[We.Symbol.Name],c=a[We.Symbol.Schema],l=a[We.Symbol.OriginalName],p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else if(w(a,ot)){let o=a[xe].name,c=a[xe].schema,l=a[xe].originalName,p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else i.push(x`${x.raw(n.joinType)} join${s} ${a} on ${n.on}`);r<e.length-1&&i.push(x` `)}return x.join(i)}buildFromTable(e){if(w(e,N)&&e[N.Symbol.OriginalName]!==e[N.Symbol.Name]){let i=x`${x.identifier(e[N.Symbol.OriginalName])}`;return e[N.Symbol.Schema]&&(i=x`${x.identifier(e[N.Symbol.Schema])}.${i}`),x`${i} ${x.identifier(e[N.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:i,fieldsFlat:r,where:n,having:a,table:s,joins:o,orderBy:c,groupBy:l,limit:p,offset:u,lockingClause:d,distinct:f,setOperators:m}){let h=r??Nt(i);for(let te of h)if(w(te.field,ae)&&vt(te.field.table)!==(w(s,Le)?s._.alias:w(s,Fn)?s[xe].name:w(s,M)?void 0:vt(s))&&!(ie=>o?.some(({alias:Y})=>Y===(ie[N.Symbol.IsAlias]?vt(ie):ie[N.Symbol.BaseName])))(te.field.table)){let ie=vt(te.field.table);throw new Error(`Your "${te.path.join("->")}" field references a column "${ie}"."${te.field.name}", but the table "${ie}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,b=this.buildWithCTE(e),T;f&&(T=f===!0?x` distinct`:x` distinct on (${x.join(f.on,x`, `)})`);let _=this.buildSelection(h,{isSingleTable:y}),A=this.buildFromTable(s),O=this.buildJoins(o),E=n?x` where ${n}`:void 0,C=a?x` having ${a}`:void 0,I;c&&c.length>0&&(I=x` order by ${x.join(c,x`, `)}`);let z;l&&l.length>0&&(z=x` group by ${x.join(l,x`, `)}`);let me=typeof p=="object"||typeof p=="number"&&p>=0?x` limit ${p}`:void 0,Ee=u?x` offset ${u}`:void 0,ye=x.empty();if(d){let te=x` for ${x.raw(d.strength)}`;d.config.of&&te.append(x` of ${x.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],x`, `)}`),d.config.noWait?te.append(x` no wait`):d.config.skipLocked&&te.append(x` skip locked`),ye.append(te)}let G=x`${b}select${T} ${_} from ${A}${O}${E}${z}${C}${I}${me}${Ee}${ye}`;return m.length>0?this.buildSetOperations(G,m):G}buildSetOperations(e,i){let[r,...n]=i;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:i,isAll:r,rightSelect:n,limit:a,orderBy:s,offset:o}}){let c=x`(${e.getSQL()}) `,l=x`(${n.getSQL()})`,p;if(s&&s.length>0){let m=[];for(let h of s)if(w(h,P))m.push(x.identifier(h.name));else if(w(h,M)){for(let y=0;y<h.queryChunks.length;y++){let b=h.queryChunks[y];w(b,P)&&(h.queryChunks[y]=x.identifier(b.name))}m.push(x`${h}`)}else m.push(x`${h}`);p=x` order by ${x.join(m,x`, `)} `}let u=typeof a=="object"||typeof a=="number"&&a>=0?x` limit ${a}`:void 0,d=x.raw(`${i} ${r?"all ":""}`),f=o?x` offset ${o}`:void 0;return x`${c}${d}${l}${p}${u}${f}`}buildInsertQuery({table:e,values:i,onConflict:r,returning:n,withList:a,select:s,overridingSystemValue_:o}){let c=[],l=e[N.Symbol.Columns],p=Object.entries(l).filter(([b,T])=>!T.shouldDisableInsert()),u=p.map(([,b])=>x.identifier(this.casing.getColumnCasing(b)));if(s){let b=i;w(b,M)?c.push(b):c.push(b.getSQL())}else{let b=i;c.push(x.raw("values "));for(let[T,_]of b.entries()){let A=[];for(let[O,E]of p){let C=_[O];if(C===void 0||w(C,xt)&&C.value===void 0)if(E.defaultFn!==void 0){let I=E.defaultFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else if(!E.default&&E.onUpdateFn!==void 0){let I=E.onUpdateFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else A.push(x`default`);else A.push(C)}c.push(A),T<b.length-1&&c.push(x`, `)}}let d=this.buildWithCTE(a),f=x.join(c),m=n?x` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,h=r?x` on conflict ${r}`:void 0,y=o===!0?x`overriding system value `:void 0;return x`${d}insert into ${e} ${u} ${y}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:i,withNoData:r}){let n=i?x` concurrently`:void 0,a=r?x` with no data`:void 0;return x`refresh materialized view${n} ${e}${a}`}prepareTyping(e){return w(e,ks)||w(e,Es)?"json":w(e,Ts)?"decimal":w(e,As)?"time":w(e,Cs)||w(e,Ps)?"timestamp":w(e,_s)||w(e,Ss)?"date":w(e,js)?"uuid":"none"}sqlToQuery(e,i){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:i})}buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:n,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let p=[],u,d,f=[],m,h=[];if(s===!0)p=Object.entries(a.columns).map(([T,_])=>({dbKey:_.name,tsKey:T,field:ci(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([C,I])=>[C,ci(I,o)]));if(s.where){let C=typeof s.where=="function"?s.where(b,$S()):s.where;m=C&&xs(C,o)}let T=[],_=[];if(s.columns){let C=!1;for(let[I,z]of Object.entries(s.columns))z!==void 0&&I in a.columns&&(!C&&z===!0&&(C=!0),_.push(I));_.length>0&&(_=C?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let C of _){let I=a.columns[C];T.push({tsKey:C,value:I})}let A=[];s.with&&(A=Object.entries(s.with).filter(C=>!!C[1]).map(([C,I])=>({tsKey:C,queryConfig:I,relation:a.relations[C]})));let O;if(s.extras){O=typeof s.extras=="function"?s.extras(b,{sql:x}):s.extras;for(let[C,I]of Object.entries(O))T.push({tsKey:C,value:Cd(I,o)})}for(let{tsKey:C,value:I}of T)p.push({dbKey:w(I,M.Aliased)?I.fieldAlias:a.columns[C].name,tsKey:C,field:w(I,ae)?ci(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof s.orderBy=="function"?s.orderBy(b,HS()):s.orderBy??[];Array.isArray(E)||(E=[E]),f=E.map(C=>w(C,ae)?ci(C,o):xs(C,o)),u=s.limit,d=s.offset;for(let{tsKey:C,queryConfig:I,relation:z}of A){let me=QS(i,r,z),Ee=kr(z.referencedTable),ye=r[Ee],G=`${o}_${C}`,te=bs(...me.fields.map((H,Pe)=>Se(ci(me.references[Pe],G),ci(H,o)))),ie=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:e[ye],tableConfig:i[ye],queryConfig:w(z,Qi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:G,joinOn:te,nestedQueryRelation:z}),Y=x`${x.identifier(G)}.${x.identifier("data")}`.as(C);h.push({on:x`true`,table:new Le(ie.sql,{},G),alias:G,joinType:"left",lateral:!0}),p.push({dbKey:C,tsKey:C,field:Y,relationTableTsKey:ye,isJson:!0,selection:ie.selection})}}if(p.length===0)throw new ys({message:`No fields selected for table "${a.tsName}" ("${o}")`});let y;if(m=bs(l,m),c){let b=x`json_build_array(${x.join(p.map(({field:A,tsKey:O,isJson:E})=>E?x`${x.identifier(`${o}_${O}`)}.${x.identifier("data")}`:w(A,M.Aliased)?A.sql:A),x`, `)})`;w(c,Ns)&&(b=x`coalesce(json_agg(${b}${f.length>0?x` order by ${x.join(f,x`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:p}];u!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:[{path:[],field:x.raw("*")}],where:m,limit:u,offset:d,orderBy:f,setOperators:[]}),m=void 0,u=void 0,d=void 0,f=[]):y=vs(n,o),y=this.buildSelectQuery({table:w(y,We)?y:new Le(y,{},o),fields:{},fieldsFlat:T.map(({field:A})=>({path:[],field:w(A,ae)?ci(A,o):A})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:p.map(({field:b})=>({path:[],field:w(b,ae)?ci(b,o):b})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:y,selection:p}}};var Bc=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var Ye=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let i=!!this.fields,r=e,n;return this.fields?n=this.fields:w(r,Le)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(a=>[a,r[a]])):w(r,Fn)?n=r[xe].selectedFields:w(r,M)?n={}:n=qc(r),new zc({table:r,fields:n,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Zf=class extends Bc{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:i,isPartialSelect:r,session:n,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...i},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=a,this._={selectedFields:i},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(i,r)=>{let n=this.tableName,a=ki(i);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof a=="string"&&!w(i,M))){let s=w(i,Le)?i._.selectedFields:w(i,ot)?i[xe].selectedFields:i[N.Symbol.Columns];this.config.fields[a]=s}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:i,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,i){return r=>{let n=typeof r=="function"?r(o9()):r;if(!ws(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:i,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(i)?i:[i]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(i)?i:[i];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let i=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,i={}){return this.config.lockingClause={strength:e,config:i},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}as(e){return new Proxy(new Le(this.getSQL(),this.config.fields,e),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Oe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},zc=class extends Zf{static[v]="PgSelect";_prepare(e){let{session:i,config:r,dialect:n,joinsNotNullableMap:a,authToken:s}=this;if(!i)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ve.startActiveSpan("drizzle.prepareQuery",()=>{let o=Nt(r.fields),c=i.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(zc,[Je]);function Un(t,e){return(i,r,...n)=>{let a=[r,...n].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!ws(i.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(a)}}var o9=()=>({union:c9,unionAll:l9,intersect:p9,intersectAll:u9,except:d9,exceptAll:f9}),c9=Un("union",!1),l9=Un("union",!0),p9=Un("intersect",!1),u9=Un("intersect",!0),d9=Un("except",!1),f9=Un("except",!0);var $n=class{static[v]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=w(e,Gi)?e:void 0,this.dialectConfig=w(e,Gi)?void 0:e}$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(r)),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let i=this;function r(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),withList:e})}function n(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),distinct:!0})}function a(s,o){return new Ye({fields:o??void 0,session:void 0,dialect:i.getDialect(),distinct:{on:s}})}return{select:r,selectDistinct:n,selectDistinctOn:a}}select(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Gi(this.dialectConfig)),this.dialect}};var Is=class{constructor(e,i,r,n,a){this.table=e,this.session=i,this.dialect=r,this.withList=n,this.overridingSystemValue_=a}static[v]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let i=e.map(r=>{let n={},a=this.table[N.Symbol.Columns];for(let s of Object.keys(r)){let o=r[s];n[s]=w(o,M)?o:new xt(o,a[s])}return n});return new Fc(this.table,i,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let i=typeof e=="function"?e(new $n):e;if(!w(i,M)&&!ws(this.table[Pc],i._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Fc(this.table,i,this.session,this.dialect,this.withList,!0)}},Fc=class extends Je{constructor(e,i,r,n,a,s,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:i,withList:a,select:s,overridingSystemValue_:o}}static[v]="PgInsert";config;returning(e=this.config.table[N.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Nt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=x`do nothing`;else{let i="";i=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?x` where ${e.where}`:void 0;this.config.onConflict=x`(${x.raw(i)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let i=e.where?x` where ${e.where}`:void 0,r=e.targetWhere?x` where ${e.targetWhere}`:void 0,n=e.setWhere?x` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ic(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=x`(${x.raw(s)})${r} do update set ${a}${i}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Uc=class extends Je{constructor(e,i,r){super(),this.session=i,this.dialect=r,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var qs=class{constructor(e,i,r,n){this.table=e,this.session=i,this.dialect=r,this.withList=n}static[v]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Xf(this.table,Ic(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Xf=class extends Je{constructor(e,i,r,n,a){super(),this.session=r,this.dialect=n,this.config={set:i,table:e,withList:a,joins:[]},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[v]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let i=e,r=ki(i);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=i,this}getTableLikeFields(e){return w(e,We)?e[N.Symbol.Columns]:w(e,Le)?e._.selectedFields:e[xe].selectedFields}createJoin(e){return(i,r)=>{let n=ki(i);if(typeof n=="string"&&this.config.joins.some(a=>a.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let a=this.config.from&&!w(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[N.Symbol.Columns],new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:i,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[N.Symbol.Columns]),this.config.from)){let i=ki(this.config.from);if(typeof i=="string"&&this.config.from&&!w(this.config.from,M)){let r=this.getTableLikeFields(this.config.from);e[i]=r}for(let r of this.config.joins){let n=ki(r.table);if(typeof n=="string"&&!w(r.table,M)){let a=this.getTableLikeFields(r.table);e[n]=a}}}return this.config.returningFields=e,this.config.returning=Nt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){let i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var $c=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[v]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,i){return x`(select count(*) from ${e}${x.raw(" where ").if(i)}${i})`}static buildCount(e,i){return x`select count(*) as count from ${e}${x.raw(" where ").if(i)}${i};`}setToken(e){return this.token=e,this}then(e,i){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,i)}catch(e){return this.then(void 0,e)}finally(e){return this.then(i=>(e?.(),i),i=>{throw e?.(),i})}};var Hc=class{constructor(e,i,r,n,a,s,o){this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vc=class extends Je{constructor(e,i,r,n,a,s,o,c,l){super(),this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[v]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:i,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,a)=>{let s=n.map(o=>Lc(this.schema,this.tableConfig,o,i.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),i=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:i}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Qc=class extends Je{constructor(e,i,r,n){super(),this.execute=e,this.sql=i,this.query=r,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,i){return i?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Hn=class{constructor(e,i,r){if(this.dialect=e,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:i}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:i},this.query={},this._.schema)for(let[n,a]of Object.entries(this._.schema))this.query[n]=new Hc(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],a,e,i)}static[v]="PgDatabase";query;$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(new $n(r.dialect))),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,i){return new $c({source:e,filters:i,session:this.session})}with(...e){let i=this;function r(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e})}function n(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:!0})}function a(l,p){return new Ye({fields:p??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:{on:l}})}function s(l){return new qs(l,i.session,i.dialect,e)}function o(l){return new Is(l,i.session,i.dialect,e)}function c(l){return new Os(l,i.session,i.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new qs(e,this.session,this.dialect)}insert(e){return new Is(e,this.session,this.dialect)}delete(e){return new Os(e,this.session,this.dialect)}refreshMaterializedView(e){return new Uc(e,this.session,this.dialect)}authToken;execute(e){let i=typeof e=="string"?x.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(i),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Qc(()=>n.execute(void 0,this.authToken),i,r,a=>n.mapResult(a,!0))}transaction(e,i){return this.session.transaction(e,i)}};var Gc=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,i){return e}setToken(e){return this.authToken=e,this}static[v]="PgPreparedQuery";joinsNotNullableMap},Wc=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e,i){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(i).execute(void 0,i))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,i){let r=await this.execute(e,i);return Number(r[0].count)}},Kc=class extends Hn{constructor(e,i,r,n=0){super(e,i,r),this.schema=r,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new jc}getTransactionConfigSQL(e){let i=[];return e.isolationLevel&&i.push(`isolation level ${e.isolationLevel}`),e.accessMode&&i.push(e.accessMode),typeof e.deferrable=="boolean"&&i.push(e.deferrable?"deferrable":"not deferrable"),x.raw(i.join(" "))}setTransaction(e){return this.session.execute(x`set transaction ${this.getTransactionConfigSQL(e)}`)}};var ee;(function(t){t.assertEqual=n=>n;function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{let a={};for(let s of n)a[s]=s;return a},t.getValidEnumValues=n=>{let a=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(let o of a)s[o]=n[o];return t.objectValues(s)},t.objectValues=n=>t.objectKeys(n).map(function(a){return n[a]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let a=[];for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&a.push(s);return a},t.find=(n,a)=>{for(let s of n)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,a=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(ee||(ee={}));var Yf;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(Yf||(Yf={}));var q=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pi=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},S=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),kt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){let i=e||function(a){return a.message},r={_errors:[]},n=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(i(s));else{let o=r,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(i(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){let i={},r=[];for(let n of this.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}};kt.create=t=>new kt(t);var Gn=(t,e)=>{let i;switch(t.code){case S.invalid_type:t.received===q.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:i=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case S.invalid_union:i="Invalid input";break;case S.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case S.invalid_enum_value:i=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:i="Invalid function arguments";break;case S.invalid_return_type:i="Invalid function return type";break;case S.invalid_date:i="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case S.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case S.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case S.custom:i="Invalid input";break;case S.invalid_intersection_types:i="Intersection results could not be merged";break;case S.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:i="Number must be finite";break;default:i=e.defaultError,ee.assertNever(t)}return{message:i}},XS=Gn;function h9(t){XS=t}function Zc(){return XS}var Xc=t=>{let{data:e,path:i,errorMaps:r,issueData:n}=t,a=[...i,...n.path||[]],s={...n,path:a};if(n.message!==void 0)return{...n,path:a,message:n.message};let o="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)o=l(s,{data:e,defaultError:o}).message;return{...n,path:a,message:o}},g9=[];function j(t,e){let i=Zc(),r=Xc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Gn?void 0:Gn].filter(n=>!!n)});t.common.issues.push(r)}var et=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){let r=[];for(let n of i){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){let r=[];for(let n of i){let a=await n.key,s=await n.value;r.push({key:a,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,i){let r={};for(let n of i){let{key:a,value:s}=n;if(a.status==="aborted"||s.status==="aborted")return F;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}},F=Object.freeze({status:"aborted"}),Qn=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),em=t=>t.status==="aborted",tm=t=>t.status==="dirty",Cr=t=>t.status==="valid",Ls=t=>typeof Promise<"u"&&t instanceof Promise;function Jc(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function JS(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ms,Rs,qt=class{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WS=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new kt(t.common.issues);return this._error=i,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(s,o)=>{var c,l;let{message:p}=t;return s.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:o.defaultError}},description:n}}var Q=class{get description(){return this._def.description}_getType(e){return Pi(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new et,ctx:{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let i=this._parse(e);if(Ls(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){let i=this._parse(e);return Promise.resolve(i)}parse(e,i){let r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){var r;let n={common:{issues:[],async:(r=i?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},a=this._parseSync({data:e,path:n.path,parent:n});return WS(n,a)}"~validate"(e){var i,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:n});return Cr(a)?{value:a.value}:{issues:n.common.issues}}catch(a){!((r=(i=a?.message)===null||i===void 0?void 0:i.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>Cr(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,i){let r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){let r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(Ls(n)?n:Promise.resolve(n));return WS(r,a)}refine(e,i){let r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,a)=>{let s=e(n),o=()=>a.addIssue({code:S.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new Tt({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return It.create(this,this._def)}nullable(){return ui.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ni.create(this)}promise(){return Zi.create(this,this._def)}or(e){return Mr.create([this,e],this._def)}and(e){return Rr.create(this,e,this._def)}transform(e){return new Tt({...V(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let i=typeof e=="function"?e:()=>e;return new Fr({...V(this._def),innerType:this,defaultValue:i,typeName:B.ZodDefault})}brand(){return new Ds({typeName:B.ZodBranded,type:this,...V(this._def)})}catch(e){let i=typeof e=="function"?e:()=>e;return new Ur({...V(this._def),innerType:this,catchValue:i,typeName:B.ZodCatch})}describe(e){let i=this.constructor;return new i({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},v9=/^c[^\s-]{8,}$/i,x9=/^[0-9a-z]+$/,y9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w9=/^[a-z0-9_-]{21}$/i,_9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,k9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jf,T9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,A9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,YS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",O9=new RegExp(`^${YS}$`);function eE(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function I9(t){return new RegExp(`^${eE(t)}$`)}function tE(t){let e=`${YS}T${eE(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function q9(t,e){return!!((e==="v4"||!e)&&T9.test(t)||(e==="v6"||!e)&&C9.test(t))}function M9(t,e){if(!_9.test(t))return!1;try{let[i]=t.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function R9(t,e){return!!((e==="v4"||!e)&&A9.test(t)||(e==="v6"||!e)&&P9.test(t))}var Wi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.string,received:a.parsedType}),F}let r=new et,n;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Jf||(Jf=new RegExp(k9,"u")),Jf.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")b9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")w9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")v9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")x9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")y9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),j(n,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?tE(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?O9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?I9(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?S9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?q9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M9(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?R9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?N9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):ee.assertNever(a);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:S.invalid_string,...L.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var i,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...L.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...L.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...L.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...L.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...L.errToObj(i)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:B.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};function L9(t,e){let i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,a=parseInt(t.toFixed(n).replace(".","")),s=parseInt(e.toFixed(n).replace(".",""));return a%s/Math.pow(10,n)}var Pr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.number,received:a.parsedType}),F}let r,n=new et;for(let a of this._def.checks)a.kind==="int"?ee.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?L9(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_finite,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,i=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Pr.create=t=>new Pr({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...V(t)});var jr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let r,n=new et;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.bigint,received:i.parsedType}),F}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};jr.create=t=>{var e;return new jr({checks:[],typeName:B.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};var Nr=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.boolean,received:r.parsedType}),F}return ct(e.data)}};Nr.create=t=>new Nr({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var Or=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.date,received:a.parsedType}),F}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_date}),F}let r=new et,n;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ee.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(i)})}get minDate(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Or.create=t=>new Or({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...V(t)});var Wn=class extends Q{_parse(e){if(this._getType(e)!==q.symbol){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.symbol,received:r.parsedType}),F}return ct(e.data)}};Wn.create=t=>new Wn({typeName:B.ZodSymbol,...V(t)});var Ir=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.undefined,received:r.parsedType}),F}return ct(e.data)}};Ir.create=t=>new Ir({typeName:B.ZodUndefined,...V(t)});var qr=class extends Q{_parse(e){if(this._getType(e)!==q.null){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.null,received:r.parsedType}),F}return ct(e.data)}};qr.create=t=>new qr({typeName:B.ZodNull,...V(t)});var Ki=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};Ki.create=t=>new Ki({typeName:B.ZodAny,...V(t)});var ji=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};ji.create=t=>new ji({typeName:B.ZodUnknown,...V(t)});var Wt=class extends Q{_parse(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.never,received:i.parsedType}),F}};Wt.create=t=>new Wt({typeName:B.ZodNever,...V(t)});var Kn=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.void,received:r.parsedType}),F}return ct(e.data)}};Kn.create=t=>new Kn({typeName:B.ZodVoid,...V(t)});var Ni=class t extends Q{_parse(e){let{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==q.array)return j(i,{code:S.invalid_type,expected:q.array,received:i.parsedType}),F;if(n.exactLength!==null){let s=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(s||o)&&(j(i,{code:s?S.too_big:S.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(j(i,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dnpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:145
/app/dist/index.cjs:145
		`;await i.execute(x`CREATE SCHEMA IF NOT EXISTS ${x.identifier(a)}`),await i.execute(s);let c=(await i.all(x`select id, hash, created_at from ${x.identifier(a)}.${x.identifier(n)} order by created_at desc limit 1`))[0];await i.transaction(async l=>{for await(let p of e)if(!c||Number(c.created_at)<p.folderMillis){for(let u of p.sql)await l.execute(x.raw(u));await l.execute(x`insert into ${x.identifier(a)}.${x.identifier(n)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let i=[x`with `];for(let[r,n]of e.entries())i.push(x`${x.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&i.push(x`, `);return i.push(x` `),x.join(i)}buildDeleteQuery({table:e,where:i,returning:r,withList:n}){let a=this.buildWithCTE(n),s=r?x` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=i?x` where ${i}`:void 0;return x`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,i){let r=e[N.Symbol.Columns],n=Object.keys(r).filter(s=>i[s]!==void 0||r[s]?.onUpdateFn!==void 0),a=n.length;return x.join(n.flatMap((s,o)=>{let c=r[s],l=i[s]??x.param(c.onUpdateFn(),c),p=x`${x.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<a-1?[p,x.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:i,where:r,returning:n,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),l=e[We.Symbol.Name],p=e[We.Symbol.Schema],u=e[We.Symbol.OriginalName],d=l===u?void 0:l,f=x`${p?x`${x.identifier(p)}.`:void 0}${x.identifier(u)}${d&&x` ${x.identifier(d)}`}`,m=this.buildUpdateSet(e,i),h=s&&x.join([x.raw(" from "),this.buildFromTable(s)]),y=this.buildJoins(o),b=n?x` returning ${this.buildSelection(n,{isSingleTable:!s})}`:void 0,T=r?x` where ${r}`:void 0;return x`${c}update ${f} set ${m}${h}${y}${T}${b}`}buildSelection(e,{isSingleTable:i=!1}={}){let r=e.length,n=e.flatMap(({field:a},s)=>{let o=[];if(w(a,M.Aliased)&&a.isSelectionField)o.push(x.identifier(a.fieldAlias));else if(w(a,M.Aliased)||w(a,M)){let c=w(a,M.Aliased)?a.sql:a;i?o.push(new M(c.queryChunks.map(l=>w(l,P)?x.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),w(a,M.Aliased)&&o.push(x` as ${x.identifier(a.fieldAlias)}`)}else w(a,ae)&&(i?o.push(x.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<r-1&&o.push(x`, `),o});return x.join(n)}buildJoins(e){if(!e||e.length===0)return;let i=[];for(let[r,n]of e.entries()){r===0&&i.push(x` `);let a=n.table,s=n.lateral?x` lateral`:void 0;if(w(a,We)){let o=a[We.Symbol.Name],c=a[We.Symbol.Schema],l=a[We.Symbol.OriginalName],p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else if(w(a,ot)){let o=a[xe].name,c=a[xe].schema,l=a[xe].originalName,p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else i.push(x`${x.raw(n.joinType)} join${s} ${a} on ${n.on}`);r<e.length-1&&i.push(x` `)}return x.join(i)}buildFromTable(e){if(w(e,N)&&e[N.Symbol.OriginalName]!==e[N.Symbol.Name]){let i=x`${x.identifier(e[N.Symbol.OriginalName])}`;return e[N.Symbol.Schema]&&(i=x`${x.identifier(e[N.Symbol.Schema])}.${i}`),x`${i} ${x.identifier(e[N.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:i,fieldsFlat:r,where:n,having:a,table:s,joins:o,orderBy:c,groupBy:l,limit:p,offset:u,lockingClause:d,distinct:f,setOperators:m}){let h=r??Nt(i);for(let te of h)if(w(te.field,ae)&&vt(te.field.table)!==(w(s,Le)?s._.alias:w(s,Fn)?s[xe].name:w(s,M)?void 0:vt(s))&&!(ie=>o?.some(({alias:Y})=>Y===(ie[N.Symbol.IsAlias]?vt(ie):ie[N.Symbol.BaseName])))(te.field.table)){let ie=vt(te.field.table);throw new Error(`Your "${te.path.join("->")}" field references a column "${ie}"."${te.field.name}", but the table "${ie}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,b=this.buildWithCTE(e),T;f&&(T=f===!0?x` distinct`:x` distinct on (${x.join(f.on,x`, `)})`);let _=this.buildSelection(h,{isSingleTable:y}),A=this.buildFromTable(s),O=this.buildJoins(o),E=n?x` where ${n}`:void 0,C=a?x` having ${a}`:void 0,I;c&&c.length>0&&(I=x` order by ${x.join(c,x`, `)}`);let z;l&&l.length>0&&(z=x` group by ${x.join(l,x`, `)}`);let me=typeof p=="object"||typeof p=="number"&&p>=0?x` limit ${p}`:void 0,Ee=u?x` offset ${u}`:void 0,ye=x.empty();if(d){let te=x` for ${x.raw(d.strength)}`;d.config.of&&te.append(x` of ${x.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],x`, `)}`),d.config.noWait?te.append(x` no wait`):d.config.skipLocked&&te.append(x` skip locked`),ye.append(te)}let G=x`${b}select${T} ${_} from ${A}${O}${E}${z}${C}${I}${me}${Ee}${ye}`;return m.length>0?this.buildSetOperations(G,m):G}buildSetOperations(e,i){let[r,...n]=i;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:i,isAll:r,rightSelect:n,limit:a,orderBy:s,offset:o}}){let c=x`(${e.getSQL()}) `,l=x`(${n.getSQL()})`,p;if(s&&s.length>0){let m=[];for(let h of s)if(w(h,P))m.push(x.identifier(h.name));else if(w(h,M)){for(let y=0;y<h.queryChunks.length;y++){let b=h.queryChunks[y];w(b,P)&&(h.queryChunks[y]=x.identifier(b.name))}m.push(x`${h}`)}else m.push(x`${h}`);p=x` order by ${x.join(m,x`, `)} `}let u=typeof a=="object"||typeof a=="number"&&a>=0?x` limit ${a}`:void 0,d=x.raw(`${i} ${r?"all ":""}`),f=o?x` offset ${o}`:void 0;return x`${c}${d}${l}${p}${u}${f}`}buildInsertQuery({table:e,values:i,onConflict:r,returning:n,withList:a,select:s,overridingSystemValue_:o}){let c=[],l=e[N.Symbol.Columns],p=Object.entries(l).filter(([b,T])=>!T.shouldDisableInsert()),u=p.map(([,b])=>x.identifier(this.casing.getColumnCasing(b)));if(s){let b=i;w(b,M)?c.push(b):c.push(b.getSQL())}else{let b=i;c.push(x.raw("values "));for(let[T,_]of b.entries()){let A=[];for(let[O,E]of p){let C=_[O];if(C===void 0||w(C,xt)&&C.value===void 0)if(E.defaultFn!==void 0){let I=E.defaultFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else if(!E.default&&E.onUpdateFn!==void 0){let I=E.onUpdateFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else A.push(x`default`);else A.push(C)}c.push(A),T<b.length-1&&c.push(x`, `)}}let d=this.buildWithCTE(a),f=x.join(c),m=n?x` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,h=r?x` on conflict ${r}`:void 0,y=o===!0?x`overriding system value `:void 0;return x`${d}insert into ${e} ${u} ${y}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:i,withNoData:r}){let n=i?x` concurrently`:void 0,a=r?x` with no data`:void 0;return x`refresh materialized view${n} ${e}${a}`}prepareTyping(e){return w(e,ks)||w(e,Es)?"json":w(e,Ts)?"decimal":w(e,As)?"time":w(e,Cs)||w(e,Ps)?"timestamp":w(e,_s)||w(e,Ss)?"date":w(e,js)?"uuid":"none"}sqlToQuery(e,i){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:i})}buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:n,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let p=[],u,d,f=[],m,h=[];if(s===!0)p=Object.entries(a.columns).map(([T,_])=>({dbKey:_.name,tsKey:T,field:ci(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([C,I])=>[C,ci(I,o)]));if(s.where){let C=typeof s.where=="function"?s.where(b,$S()):s.where;m=C&&xs(C,o)}let T=[],_=[];if(s.columns){let C=!1;for(let[I,z]of Object.entries(s.columns))z!==void 0&&I in a.columns&&(!C&&z===!0&&(C=!0),_.push(I));_.length>0&&(_=C?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let C of _){let I=a.columns[C];T.push({tsKey:C,value:I})}let A=[];s.with&&(A=Object.entries(s.with).filter(C=>!!C[1]).map(([C,I])=>({tsKey:C,queryConfig:I,relation:a.relations[C]})));let O;if(s.extras){O=typeof s.extras=="function"?s.extras(b,{sql:x}):s.extras;for(let[C,I]of Object.entries(O))T.push({tsKey:C,value:Cd(I,o)})}for(let{tsKey:C,value:I}of T)p.push({dbKey:w(I,M.Aliased)?I.fieldAlias:a.columns[C].name,tsKey:C,field:w(I,ae)?ci(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof s.orderBy=="function"?s.orderBy(b,HS()):s.orderBy??[];Array.isArray(E)||(E=[E]),f=E.map(C=>w(C,ae)?ci(C,o):xs(C,o)),u=s.limit,d=s.offset;for(let{tsKey:C,queryConfig:I,relation:z}of A){let me=QS(i,r,z),Ee=kr(z.referencedTable),ye=r[Ee],G=`${o}_${C}`,te=bs(...me.fields.map((H,Pe)=>Se(ci(me.references[Pe],G),ci(H,o)))),ie=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:e[ye],tableConfig:i[ye],queryConfig:w(z,Qi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:G,joinOn:te,nestedQueryRelation:z}),Y=x`${x.identifier(G)}.${x.identifier("data")}`.as(C);h.push({on:x`true`,table:new Le(ie.sql,{},G),alias:G,joinType:"left",lateral:!0}),p.push({dbKey:C,tsKey:C,field:Y,relationTableTsKey:ye,isJson:!0,selection:ie.selection})}}if(p.length===0)throw new ys({message:`No fields selected for table "${a.tsName}" ("${o}")`});let y;if(m=bs(l,m),c){let b=x`json_build_array(${x.join(p.map(({field:A,tsKey:O,isJson:E})=>E?x`${x.identifier(`${o}_${O}`)}.${x.identifier("data")}`:w(A,M.Aliased)?A.sql:A),x`, `)})`;w(c,Ns)&&(b=x`coalesce(json_agg(${b}${f.length>0?x` order by ${x.join(f,x`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:p}];u!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:[{path:[],field:x.raw("*")}],where:m,limit:u,offset:d,orderBy:f,setOperators:[]}),m=void 0,u=void 0,d=void 0,f=[]):y=vs(n,o),y=this.buildSelectQuery({table:w(y,We)?y:new Le(y,{},o),fields:{},fieldsFlat:T.map(({field:A})=>({path:[],field:w(A,ae)?ci(A,o):A})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:p.map(({field:b})=>({path:[],field:w(b,ae)?ci(b,o):b})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:y,selection:p}}};var Bc=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var Ye=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let i=!!this.fields,r=e,n;return this.fields?n=this.fields:w(r,Le)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(a=>[a,r[a]])):w(r,Fn)?n=r[xe].selectedFields:w(r,M)?n={}:n=qc(r),new zc({table:r,fields:n,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Zf=class extends Bc{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:i,isPartialSelect:r,session:n,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...i},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=a,this._={selectedFields:i},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(i,r)=>{let n=this.tableName,a=ki(i);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof a=="string"&&!w(i,M))){let s=w(i,Le)?i._.selectedFields:w(i,ot)?i[xe].selectedFields:i[N.Symbol.Columns];this.config.fields[a]=s}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:i,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,i){return r=>{let n=typeof r=="function"?r(o9()):r;if(!ws(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:i,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(i)?i:[i]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(i)?i:[i];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let i=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,i={}){return this.config.lockingClause={strength:e,config:i},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}as(e){return new Proxy(new Le(this.getSQL(),this.config.fields,e),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Oe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},zc=class extends Zf{static[v]="PgSelect";_prepare(e){let{session:i,config:r,dialect:n,joinsNotNullableMap:a,authToken:s}=this;if(!i)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ve.startActiveSpan("drizzle.prepareQuery",()=>{let o=Nt(r.fields),c=i.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(zc,[Je]);function Un(t,e){return(i,r,...n)=>{let a=[r,...n].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!ws(i.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(a)}}var o9=()=>({union:c9,unionAll:l9,intersect:p9,intersectAll:u9,except:d9,exceptAll:f9}),c9=Un("union",!1),l9=Un("union",!0),p9=Un("intersect",!1),u9=Un("intersect",!0),d9=Un("except",!1),f9=Un("except",!0);var $n=class{static[v]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=w(e,Gi)?e:void 0,this.dialectConfig=w(e,Gi)?void 0:e}$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(r)),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let i=this;function r(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),withList:e})}function n(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),distinct:!0})}function a(s,o){return new Ye({fields:o??void 0,session:void 0,dialect:i.getDialect(),distinct:{on:s}})}return{select:r,selectDistinct:n,selectDistinctOn:a}}select(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Gi(this.dialectConfig)),this.dialect}};var Is=class{constructor(e,i,r,n,a){this.table=e,this.session=i,this.dialect=r,this.withList=n,this.overridingSystemValue_=a}static[v]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let i=e.map(r=>{let n={},a=this.table[N.Symbol.Columns];for(let s of Object.keys(r)){let o=r[s];n[s]=w(o,M)?o:new xt(o,a[s])}return n});return new Fc(this.table,i,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let i=typeof e=="function"?e(new $n):e;if(!w(i,M)&&!ws(this.table[Pc],i._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Fc(this.table,i,this.session,this.dialect,this.withList,!0)}},Fc=class extends Je{constructor(e,i,r,n,a,s,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:i,withList:a,select:s,overridingSystemValue_:o}}static[v]="PgInsert";config;returning(e=this.config.table[N.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Nt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=x`do nothing`;else{let i="";i=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?x` where ${e.where}`:void 0;this.config.onConflict=x`(${x.raw(i)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let i=e.where?x` where ${e.where}`:void 0,r=e.targetWhere?x` where ${e.targetWhere}`:void 0,n=e.setWhere?x` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ic(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=x`(${x.raw(s)})${r} do update set ${a}${i}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Uc=class extends Je{constructor(e,i,r){super(),this.session=i,this.dialect=r,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var qs=class{constructor(e,i,r,n){this.table=e,this.session=i,this.dialect=r,this.withList=n}static[v]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Xf(this.table,Ic(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Xf=class extends Je{constructor(e,i,r,n,a){super(),this.session=r,this.dialect=n,this.config={set:i,table:e,withList:a,joins:[]},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[v]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let i=e,r=ki(i);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=i,this}getTableLikeFields(e){return w(e,We)?e[N.Symbol.Columns]:w(e,Le)?e._.selectedFields:e[xe].selectedFields}createJoin(e){return(i,r)=>{let n=ki(i);if(typeof n=="string"&&this.config.joins.some(a=>a.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let a=this.config.from&&!w(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[N.Symbol.Columns],new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:i,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[N.Symbol.Columns]),this.config.from)){let i=ki(this.config.from);if(typeof i=="string"&&this.config.from&&!w(this.config.from,M)){let r=this.getTableLikeFields(this.config.from);e[i]=r}for(let r of this.config.joins){let n=ki(r.table);if(typeof n=="string"&&!w(r.table,M)){let a=this.getTableLikeFields(r.table);e[n]=a}}}return this.config.returningFields=e,this.config.returning=Nt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){let i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var $c=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[v]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,i){return x`(select count(*) from ${e}${x.raw(" where ").if(i)}${i})`}static buildCount(e,i){return x`select count(*) as count from ${e}${x.raw(" where ").if(i)}${i};`}setToken(e){return this.token=e,this}then(e,i){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,i)}catch(e){return this.then(void 0,e)}finally(e){return this.then(i=>(e?.(),i),i=>{throw e?.(),i})}};var Hc=class{constructor(e,i,r,n,a,s,o){this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vc=class extends Je{constructor(e,i,r,n,a,s,o,c,l){super(),this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[v]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:i,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,a)=>{let s=n.map(o=>Lc(this.schema,this.tableConfig,o,i.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),i=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:i}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Qc=class extends Je{constructor(e,i,r,n){super(),this.execute=e,this.sql=i,this.query=r,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,i){return i?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Hn=class{constructor(e,i,r){if(this.dialect=e,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:i}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:i},this.query={},this._.schema)for(let[n,a]of Object.entries(this._.schema))this.query[n]=new Hc(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],a,e,i)}static[v]="PgDatabase";query;$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(new $n(r.dialect))),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,i){return new $c({source:e,filters:i,session:this.session})}with(...e){let i=this;function r(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e})}function n(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:!0})}function a(l,p){return new Ye({fields:p??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:{on:l}})}function s(l){return new qs(l,i.session,i.dialect,e)}function o(l){return new Is(l,i.session,i.dialect,e)}function c(l){return new Os(l,i.session,i.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new qs(e,this.session,this.dialect)}insert(e){return new Is(e,this.session,this.dialect)}delete(e){return new Os(e,this.session,this.dialect)}refreshMaterializedView(e){return new Uc(e,this.session,this.dialect)}authToken;execute(e){let i=typeof e=="string"?x.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(i),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Qc(()=>n.execute(void 0,this.authToken),i,r,a=>n.mapResult(a,!0))}transaction(e,i){return this.session.transaction(e,i)}};var Gc=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,i){return e}setToken(e){return this.authToken=e,this}static[v]="PgPreparedQuery";joinsNotNullableMap},Wc=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e,i){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(i).execute(void 0,i))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,i){let r=await this.execute(e,i);return Number(r[0].count)}},Kc=class extends Hn{constructor(e,i,r,n=0){super(e,i,r),this.schema=r,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new jc}getTransactionConfigSQL(e){let i=[];return e.isolationLevel&&i.push(`isolation level ${e.isolationLevel}`),e.accessMode&&i.push(e.accessMode),typeof e.deferrable=="boolean"&&i.push(e.deferrable?"deferrable":"not deferrable"),x.raw(i.join(" "))}setTransaction(e){return this.session.execute(x`set transaction ${this.getTransactionConfigSQL(e)}`)}};var ee;(function(t){t.assertEqual=n=>n;function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{let a={};for(let s of n)a[s]=s;return a},t.getValidEnumValues=n=>{let a=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(let o of a)s[o]=n[o];return t.objectValues(s)},t.objectValues=n=>t.objectKeys(n).map(function(a){return n[a]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let a=[];for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&a.push(s);return a},t.find=(n,a)=>{for(let s of n)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,a=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(ee||(ee={}));var Yf;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(Yf||(Yf={}));var q=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pi=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},S=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),kt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){let i=e||function(a){return a.message},r={_errors:[]},n=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(i(s));else{let o=r,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(i(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){let i={},r=[];for(let n of this.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}};kt.create=t=>new kt(t);var Gn=(t,e)=>{let i;switch(t.code){case S.invalid_type:t.received===q.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:i=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case S.invalid_union:i="Invalid input";break;case S.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case S.invalid_enum_value:i=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:i="Invalid function arguments";break;case S.invalid_return_type:i="Invalid function return type";break;case S.invalid_date:i="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case S.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case S.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case S.custom:i="Invalid input";break;case S.invalid_intersection_types:i="Intersection results could not be merged";break;case S.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:i="Number must be finite";break;default:i=e.defaultError,ee.assertNever(t)}return{message:i}},XS=Gn;function h9(t){XS=t}function Zc(){return XS}var Xc=t=>{let{data:e,path:i,errorMaps:r,issueData:n}=t,a=[...i,...n.path||[]],s={...n,path:a};if(n.message!==void 0)return{...n,path:a,message:n.message};let o="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)o=l(s,{data:e,defaultError:o}).message;return{...n,path:a,message:o}},g9=[];function j(t,e){let i=Zc(),r=Xc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Gn?void 0:Gn].filter(n=>!!n)});t.common.issues.push(r)}var et=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){let r=[];for(let n of i){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){let r=[];for(let n of i){let a=await n.key,s=await n.value;r.push({key:a,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,i){let r={};for(let n of i){let{key:a,value:s}=n;if(a.status==="aborted"||s.status==="aborted")return F;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}},F=Object.freeze({status:"aborted"}),Qn=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),em=t=>t.status==="aborted",tm=t=>t.status==="dirty",Cr=t=>t.status==="valid",Ls=t=>typeof Promise<"u"&&t instanceof Promise;function Jc(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function JS(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ms,Rs,qt=class{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WS=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new kt(t.common.issues);return this._error=i,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(s,o)=>{var c,l;let{message:p}=t;return s.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:o.defaultError}},description:n}}var Q=class{get description(){return this._def.description}_getType(e){return Pi(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new et,ctx:{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let i=this._parse(e);if(Ls(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){let i=this._parse(e);return Promise.resolve(i)}parse(e,i){let r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){var r;let n={common:{issues:[],async:(r=i?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},a=this._parseSync({data:e,path:n.path,parent:n});return WS(n,a)}"~validate"(e){var i,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:n});return Cr(a)?{value:a.value}:{issues:n.common.issues}}catch(a){!((r=(i=a?.message)===null||i===void 0?void 0:i.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>Cr(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,i){let r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){let r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(Ls(n)?n:Promise.resolve(n));return WS(r,a)}refine(e,i){let r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,a)=>{let s=e(n),o=()=>a.addIssue({code:S.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new Tt({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return It.create(this,this._def)}nullable(){return ui.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ni.create(this)}promise(){return Zi.create(this,this._def)}or(e){return Mr.create([this,e],this._def)}and(e){return Rr.create(this,e,this._def)}transform(e){return new Tt({...V(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let i=typeof e=="function"?e:()=>e;return new Fr({...V(this._def),innerType:this,defaultValue:i,typeName:B.ZodDefault})}brand(){return new Ds({typeName:B.ZodBranded,type:this,...V(this._def)})}catch(e){let i=typeof e=="function"?e:()=>e;return new Ur({...V(this._def),innerType:this,catchValue:i,typeName:B.ZodCatch})}describe(e){let i=this.constructor;return new i({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},v9=/^c[^\s-]{8,}$/i,x9=/^[0-9a-z]+$/,y9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w9=/^[a-z0-9_-]{21}$/i,_9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,k9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jf,T9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,A9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,YS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",O9=new RegExp(`^${YS}$`);function eE(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function I9(t){return new RegExp(`^${eE(t)}$`)}function tE(t){let e=`${YS}T${eE(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function q9(t,e){return!!((e==="v4"||!e)&&T9.test(t)||(e==="v6"||!e)&&C9.test(t))}function M9(t,e){if(!_9.test(t))return!1;try{let[i]=t.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function R9(t,e){return!!((e==="v4"||!e)&&A9.test(t)||(e==="v6"||!e)&&P9.test(t))}var Wi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.string,received:a.parsedType}),F}let r=new et,n;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Jf||(Jf=new RegExp(k9,"u")),Jf.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")b9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")w9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")v9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")x9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")y9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),j(n,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?tE(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?O9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?I9(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?S9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?q9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M9(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?R9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?N9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):ee.assertNever(a);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:S.invalid_string,...L.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var i,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...L.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...L.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...L.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...L.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...L.errToObj(i)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:B.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};function L9(t,e){let i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,a=parseInt(t.toFixed(n).replace(".","")),s=parseInt(e.toFixed(n).replace(".",""));return a%s/Math.pow(10,n)}var Pr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.number,received:a.parsedType}),F}let r,n=new et;for(let a of this._def.checks)a.kind==="int"?ee.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?L9(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_finite,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,i=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Pr.create=t=>new Pr({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...V(t)});var jr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let r,n=new et;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.bigint,received:i.parsedType}),F}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};jr.create=t=>{var e;return new jr({checks:[],typeName:B.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};var Nr=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.boolean,received:r.parsedType}),F}return ct(e.data)}};Nr.create=t=>new Nr({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var Or=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.date,received:a.parsedType}),F}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_date}),F}let r=new et,n;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ee.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(i)})}get minDate(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Or.create=t=>new Or({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...V(t)});var Wn=class extends Q{_parse(e){if(this._getType(e)!==q.symbol){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.symbol,received:r.parsedType}),F}return ct(e.data)}};Wn.create=t=>new Wn({typeName:B.ZodSymbol,...V(t)});var Ir=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.undefined,received:r.parsedType}),F}return ct(e.data)}};Ir.create=t=>new Ir({typeName:B.ZodUndefined,...V(t)});var qr=class extends Q{_parse(e){if(this._getType(e)!==q.null){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.null,received:r.parsedType}),F}return ct(e.data)}};qr.create=t=>new qr({typeName:B.ZodNull,...V(t)});var Ki=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};Ki.create=t=>new Ki({typeName:B.ZodAny,...V(t)});var ji=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};ji.create=t=>new ji({typeName:B.ZodUnknown,...V(t)});var Wt=class extends Q{_parse(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.never,received:i.parsedType}),F}};Wt.create=t=>new Wt({typeName:B.ZodNever,...V(t)});var Kn=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.void,received:r.parsedType}),F}return ct(e.data)}};Kn.create=t=>new Kn({typeName:B.ZodVoid,...V(t)});var Ni=class t extends Q{_parse(e){let{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==q.array)return j(i,{code:S.invalid_type,expected:q.array,received:i.parsedType}),F;if(n.exactLength!==null){let s=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(s||o)&&(j(i,{code:s?S.too_big:S.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(j(i,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dnpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
		`;await i.execute(x`CREATE SCHEMA IF NOT EXISTS ${x.identifier(a)}`),await i.execute(s);let c=(await i.all(x`select id, hash, created_at from ${x.identifier(a)}.${x.identifier(n)} order by created_at desc limit 1`))[0];await i.transaction(async l=>{for await(let p of e)if(!c||Number(c.created_at)<p.folderMillis){for(let u of p.sql)await l.execute(x.raw(u));await l.execute(x`insert into ${x.identifier(a)}.${x.identifier(n)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let i=[x`with `];for(let[r,n]of e.entries())i.push(x`${x.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&i.push(x`, `);return i.push(x` `),x.join(i)}buildDeleteQuery({table:e,where:i,returning:r,withList:n}){let a=this.buildWithCTE(n),s=r?x` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=i?x` where ${i}`:void 0;return x`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,i){let r=e[N.Symbol.Columns],n=Object.keys(r).filter(s=>i[s]!==void 0||r[s]?.onUpdateFn!==void 0),a=n.length;return x.join(n.flatMap((s,o)=>{let c=r[s],l=i[s]??x.param(c.onUpdateFn(),c),p=x`${x.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<a-1?[p,x.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:i,where:r,returning:n,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),l=e[We.Symbol.Name],p=e[We.Symbol.Schema],u=e[We.Symbol.OriginalName],d=l===u?void 0:l,f=x`${p?x`${x.identifier(p)}.`:void 0}${x.identifier(u)}${d&&x` ${x.identifier(d)}`}`,m=this.buildUpdateSet(e,i),h=s&&x.join([x.raw(" from "),this.buildFromTable(s)]),y=this.buildJoins(o),b=n?x` returning ${this.buildSelection(n,{isSingleTable:!s})}`:void 0,T=r?x` where ${r}`:void 0;return x`${c}update ${f} set ${m}${h}${y}${T}${b}`}buildSelection(e,{isSingleTable:i=!1}={}){let r=e.length,n=e.flatMap(({field:a},s)=>{let o=[];if(w(a,M.Aliased)&&a.isSelectionField)o.push(x.identifier(a.fieldAlias));else if(w(a,M.Aliased)||w(a,M)){let c=w(a,M.Aliased)?a.sql:a;i?o.push(new M(c.queryChunks.map(l=>w(l,P)?x.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),w(a,M.Aliased)&&o.push(x` as ${x.identifier(a.fieldAlias)}`)}else w(a,ae)&&(i?o.push(x.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<r-1&&o.push(x`, `),o});return x.join(n)}buildJoins(e){if(!e||e.length===0)return;let i=[];for(let[r,n]of e.entries()){r===0&&i.push(x` `);let a=n.table,s=n.lateral?x` lateral`:void 0;if(w(a,We)){let o=a[We.Symbol.Name],c=a[We.Symbol.Schema],l=a[We.Symbol.OriginalName],p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else if(w(a,ot)){let o=a[xe].name,c=a[xe].schema,l=a[xe].originalName,p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else i.push(x`${x.raw(n.joinType)} join${s} ${a} on ${n.on}`);r<e.length-1&&i.push(x` `)}return x.join(i)}buildFromTable(e){if(w(e,N)&&e[N.Symbol.OriginalName]!==e[N.Symbol.Name]){let i=x`${x.identifier(e[N.Symbol.OriginalName])}`;return e[N.Symbol.Schema]&&(i=x`${x.identifier(e[N.Symbol.Schema])}.${i}`),x`${i} ${x.identifier(e[N.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:i,fieldsFlat:r,where:n,having:a,table:s,joins:o,orderBy:c,groupBy:l,limit:p,offset:u,lockingClause:d,distinct:f,setOperators:m}){let h=r??Nt(i);for(let te of h)if(w(te.field,ae)&&vt(te.field.table)!==(w(s,Le)?s._.alias:w(s,Fn)?s[xe].name:w(s,M)?void 0:vt(s))&&!(ie=>o?.some(({alias:Y})=>Y===(ie[N.Symbol.IsAlias]?vt(ie):ie[N.Symbol.BaseName])))(te.field.table)){let ie=vt(te.field.table);throw new Error(`Your "${te.path.join("->")}" field references a column "${ie}"."${te.field.name}", but the table "${ie}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,b=this.buildWithCTE(e),T;f&&(T=f===!0?x` distinct`:x` distinct on (${x.join(f.on,x`, `)})`);let _=this.buildSelection(h,{isSingleTable:y}),A=this.buildFromTable(s),O=this.buildJoins(o),E=n?x` where ${n}`:void 0,C=a?x` having ${a}`:void 0,I;c&&c.length>0&&(I=x` order by ${x.join(c,x`, `)}`);let z;l&&l.length>0&&(z=x` group by ${x.join(l,x`, `)}`);let me=typeof p=="object"||typeof p=="number"&&p>=0?x` limit ${p}`:void 0,Ee=u?x` offset ${u}`:void 0,ye=x.empty();if(d){let te=x` for ${x.raw(d.strength)}`;d.config.of&&te.append(x` of ${x.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],x`, `)}`),d.config.noWait?te.append(x` no wait`):d.config.skipLocked&&te.append(x` skip locked`),ye.append(te)}let G=x`${b}select${T} ${_} from ${A}${O}${E}${z}${C}${I}${me}${Ee}${ye}`;return m.length>0?this.buildSetOperations(G,m):G}buildSetOperations(e,i){let[r,...n]=i;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:i,isAll:r,rightSelect:n,limit:a,orderBy:s,offset:o}}){let c=x`(${e.getSQL()}) `,l=x`(${n.getSQL()})`,p;if(s&&s.length>0){let m=[];for(let h of s)if(w(h,P))m.push(x.identifier(h.name));else if(w(h,M)){for(let y=0;y<h.queryChunks.length;y++){let b=h.queryChunks[y];w(b,P)&&(h.queryChunks[y]=x.identifier(b.name))}m.push(x`${h}`)}else m.push(x`${h}`);p=x` order by ${x.join(m,x`, `)} `}let u=typeof a=="object"||typeof a=="number"&&a>=0?x` limit ${a}`:void 0,d=x.raw(`${i} ${r?"all ":""}`),f=o?x` offset ${o}`:void 0;return x`${c}${d}${l}${p}${u}${f}`}buildInsertQuery({table:e,values:i,onConflict:r,returning:n,withList:a,select:s,overridingSystemValue_:o}){let c=[],l=e[N.Symbol.Columns],p=Object.entries(l).filter(([b,T])=>!T.shouldDisableInsert()),u=p.map(([,b])=>x.identifier(this.casing.getColumnCasing(b)));if(s){let b=i;w(b,M)?c.push(b):c.push(b.getSQL())}else{let b=i;c.push(x.raw("values "));for(let[T,_]of b.entries()){let A=[];for(let[O,E]of p){let C=_[O];if(C===void 0||w(C,xt)&&C.value===void 0)if(E.defaultFn!==void 0){let I=E.defaultFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else if(!E.default&&E.onUpdateFn!==void 0){let I=E.onUpdateFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else A.push(x`default`);else A.push(C)}c.push(A),T<b.length-1&&c.push(x`, `)}}let d=this.buildWithCTE(a),f=x.join(c),m=n?x` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,h=r?x` on conflict ${r}`:void 0,y=o===!0?x`overriding system value `:void 0;return x`${d}insert into ${e} ${u} ${y}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:i,withNoData:r}){let n=i?x` concurrently`:void 0,a=r?x` with no data`:void 0;return x`refresh materialized view${n} ${e}${a}`}prepareTyping(e){return w(e,ks)||w(e,Es)?"json":w(e,Ts)?"decimal":w(e,As)?"time":w(e,Cs)||w(e,Ps)?"timestamp":w(e,_s)||w(e,Ss)?"date":w(e,js)?"uuid":"none"}sqlToQuery(e,i){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:i})}buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:n,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let p=[],u,d,f=[],m,h=[];if(s===!0)p=Object.entries(a.columns).map(([T,_])=>({dbKey:_.name,tsKey:T,field:ci(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([C,I])=>[C,ci(I,o)]));if(s.where){let C=typeof s.where=="function"?s.where(b,$S()):s.where;m=C&&xs(C,o)}let T=[],_=[];if(s.columns){let C=!1;for(let[I,z]of Object.entries(s.columns))z!==void 0&&I in a.columns&&(!C&&z===!0&&(C=!0),_.push(I));_.length>0&&(_=C?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let C of _){let I=a.columns[C];T.push({tsKey:C,value:I})}let A=[];s.with&&(A=Object.entries(s.with).filter(C=>!!C[1]).map(([C,I])=>({tsKey:C,queryConfig:I,relation:a.relations[C]})));let O;if(s.extras){O=typeof s.extras=="function"?s.extras(b,{sql:x}):s.extras;for(let[C,I]of Object.entries(O))T.push({tsKey:C,value:Cd(I,o)})}for(let{tsKey:C,value:I}of T)p.push({dbKey:w(I,M.Aliased)?I.fieldAlias:a.columns[C].name,tsKey:C,field:w(I,ae)?ci(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof s.orderBy=="function"?s.orderBy(b,HS()):s.orderBy??[];Array.isArray(E)||(E=[E]),f=E.map(C=>w(C,ae)?ci(C,o):xs(C,o)),u=s.limit,d=s.offset;for(let{tsKey:C,queryConfig:I,relation:z}of A){let me=QS(i,r,z),Ee=kr(z.referencedTable),ye=r[Ee],G=`${o}_${C}`,te=bs(...me.fields.map((H,Pe)=>Se(ci(me.references[Pe],G),ci(H,o)))),ie=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:e[ye],tableConfig:i[ye],queryConfig:w(z,Qi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:G,joinOn:te,nestedQueryRelation:z}),Y=x`${x.identifier(G)}.${x.identifier("data")}`.as(C);h.push({on:x`true`,table:new Le(ie.sql,{},G),alias:G,joinType:"left",lateral:!0}),p.push({dbKey:C,tsKey:C,field:Y,relationTableTsKey:ye,isJson:!0,selection:ie.selection})}}if(p.length===0)throw new ys({message:`No fields selected for table "${a.tsName}" ("${o}")`});let y;if(m=bs(l,m),c){let b=x`json_build_array(${x.join(p.map(({field:A,tsKey:O,isJson:E})=>E?x`${x.identifier(`${o}_${O}`)}.${x.identifier("data")}`:w(A,M.Aliased)?A.sql:A),x`, `)})`;w(c,Ns)&&(b=x`coalesce(json_agg(${b}${f.length>0?x` order by ${x.join(f,x`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:p}];u!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:[{path:[],field:x.raw("*")}],where:m,limit:u,offset:d,orderBy:f,setOperators:[]}),m=void 0,u=void 0,d=void 0,f=[]):y=vs(n,o),y=this.buildSelectQuery({table:w(y,We)?y:new Le(y,{},o),fields:{},fieldsFlat:T.map(({field:A})=>({path:[],field:w(A,ae)?ci(A,o):A})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:p.map(({field:b})=>({path:[],field:w(b,ae)?ci(b,o):b})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:y,selection:p}}};var Bc=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var Ye=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let i=!!this.fields,r=e,n;return this.fields?n=this.fields:w(r,Le)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(a=>[a,r[a]])):w(r,Fn)?n=r[xe].selectedFields:w(r,M)?n={}:n=qc(r),new zc({table:r,fields:n,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Zf=class extends Bc{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:i,isPartialSelect:r,session:n,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...i},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=a,this._={selectedFields:i},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(i,r)=>{let n=this.tableName,a=ki(i);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof a=="string"&&!w(i,M))){let s=w(i,Le)?i._.selectedFields:w(i,ot)?i[xe].selectedFields:i[N.Symbol.Columns];this.config.fields[a]=s}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:i,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,i){return r=>{let n=typeof r=="function"?r(o9()):r;if(!ws(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:i,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(i)?i:[i]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(i)?i:[i];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let i=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,i={}){return this.config.lockingClause={strength:e,config:i},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}as(e){return new Proxy(new Le(this.getSQL(),this.config.fields,e),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Oe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},zc=class extends Zf{static[v]="PgSelect";_prepare(e){let{session:i,config:r,dialect:n,joinsNotNullableMap:a,authToken:s}=this;if(!i)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ve.startActiveSpan("drizzle.prepareQuery",()=>{let o=Nt(r.fields),c=i.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(zc,[Je]);function Un(t,e){return(i,r,...n)=>{let a=[r,...n].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!ws(i.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(a)}}var o9=()=>({union:c9,unionAll:l9,intersect:p9,intersectAll:u9,except:d9,exceptAll:f9}),c9=Un("union",!1),l9=Un("union",!0),p9=Un("intersect",!1),u9=Un("intersect",!0),d9=Un("except",!1),f9=Un("except",!0);var $n=class{static[v]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=w(e,Gi)?e:void 0,this.dialectConfig=w(e,Gi)?void 0:e}$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(r)),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let i=this;function r(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),withList:e})}function n(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),distinct:!0})}function a(s,o){return new Ye({fields:o??void 0,session:void 0,dialect:i.getDialect(),distinct:{on:s}})}return{select:r,selectDistinct:n,selectDistinctOn:a}}select(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Gi(this.dialectConfig)),this.dialect}};var Is=class{constructor(e,i,r,n,a){this.table=e,this.session=i,this.dialect=r,this.withList=n,this.overridingSystemValue_=a}static[v]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let i=e.map(r=>{let n={},a=this.table[N.Symbol.Columns];for(let s of Object.keys(r)){let o=r[s];n[s]=w(o,M)?o:new xt(o,a[s])}return n});return new Fc(this.table,i,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let i=typeof e=="function"?e(new $n):e;if(!w(i,M)&&!ws(this.table[Pc],i._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Fc(this.table,i,this.session,this.dialect,this.withList,!0)}},Fc=class extends Je{constructor(e,i,r,n,a,s,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:i,withList:a,select:s,overridingSystemValue_:o}}static[v]="PgInsert";config;returning(e=this.config.table[N.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Nt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=x`do nothing`;else{let i="";i=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?x` where ${e.where}`:void 0;this.config.onConflict=x`(${x.raw(i)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let i=e.where?x` where ${e.where}`:void 0,r=e.targetWhere?x` where ${e.targetWhere}`:void 0,n=e.setWhere?x` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ic(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=x`(${x.raw(s)})${r} do update set ${a}${i}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Uc=class extends Je{constructor(e,i,r){super(),this.session=i,this.dialect=r,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var qs=class{constructor(e,i,r,n){this.table=e,this.session=i,this.dialect=r,this.withList=n}static[v]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Xf(this.table,Ic(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Xf=class extends Je{constructor(e,i,r,n,a){super(),this.session=r,this.dialect=n,this.config={set:i,table:e,withList:a,joins:[]},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[v]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let i=e,r=ki(i);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=i,this}getTableLikeFields(e){return w(e,We)?e[N.Symbol.Columns]:w(e,Le)?e._.selectedFields:e[xe].selectedFields}createJoin(e){return(i,r)=>{let n=ki(i);if(typeof n=="string"&&this.config.joins.some(a=>a.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let a=this.config.from&&!w(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[N.Symbol.Columns],new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:i,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[N.Symbol.Columns]),this.config.from)){let i=ki(this.config.from);if(typeof i=="string"&&this.config.from&&!w(this.config.from,M)){let r=this.getTableLikeFields(this.config.from);e[i]=r}for(let r of this.config.joins){let n=ki(r.table);if(typeof n=="string"&&!w(r.table,M)){let a=this.getTableLikeFields(r.table);e[n]=a}}}return this.config.returningFields=e,this.config.returning=Nt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){let i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var $c=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[v]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,i){return x`(select count(*) from ${e}${x.raw(" where ").if(i)}${i})`}static buildCount(e,i){return x`select count(*) as count from ${e}${x.raw(" where ").if(i)}${i};`}setToken(e){return this.token=e,this}then(e,i){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,i)}catch(e){return this.then(void 0,e)}finally(e){return this.then(i=>(e?.(),i),i=>{throw e?.(),i})}};var Hc=class{constructor(e,i,r,n,a,s,o){this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vc=class extends Je{constructor(e,i,r,n,a,s,o,c,l){super(),this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[v]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:i,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,a)=>{let s=n.map(o=>Lc(this.schema,this.tableConfig,o,i.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),i=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:i}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Qc=class extends Je{constructor(e,i,r,n){super(),this.execute=e,this.sql=i,this.query=r,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,i){return i?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Hn=class{constructor(e,i,r){if(this.dialect=e,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:i}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:i},this.query={},this._.schema)for(let[n,a]of Object.entries(this._.schema))this.query[n]=new Hc(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],a,e,i)}static[v]="PgDatabase";query;$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(new $n(r.dialect))),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,i){return new $c({source:e,filters:i,session:this.session})}with(...e){let i=this;function r(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e})}function n(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:!0})}function a(l,p){return new Ye({fields:p??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:{on:l}})}function s(l){return new qs(l,i.session,i.dialect,e)}function o(l){return new Is(l,i.session,i.dialect,e)}function c(l){return new Os(l,i.session,i.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new qs(e,this.session,this.dialect)}insert(e){return new Is(e,this.session,this.dialect)}delete(e){return new Os(e,this.session,this.dialect)}refreshMaterializedView(e){return new Uc(e,this.session,this.dialect)}authToken;execute(e){let i=typeof e=="string"?x.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(i),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Qc(()=>n.execute(void 0,this.authToken),i,r,a=>n.mapResult(a,!0))}transaction(e,i){return this.session.transaction(e,i)}};var Gc=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,i){return e}setToken(e){return this.authToken=e,this}static[v]="PgPreparedQuery";joinsNotNullableMap},Wc=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e,i){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(i).execute(void 0,i))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,i){let r=await this.execute(e,i);return Number(r[0].count)}},Kc=class extends Hn{constructor(e,i,r,n=0){super(e,i,r),this.schema=r,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new jc}getTransactionConfigSQL(e){let i=[];return e.isolationLevel&&i.push(`isolation level ${e.isolationLevel}`),e.accessMode&&i.push(e.accessMode),typeof e.deferrable=="boolean"&&i.push(e.deferrable?"deferrable":"not deferrable"),x.raw(i.join(" "))}setTransaction(e){return this.session.execute(x`set transaction ${this.getTransactionConfigSQL(e)}`)}};var ee;(function(t){t.assertEqual=n=>n;function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{let a={};for(let s of n)a[s]=s;return a},t.getValidEnumValues=n=>{let a=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(let o of a)s[o]=n[o];return t.objectValues(s)},t.objectValues=n=>t.objectKeys(n).map(function(a){return n[a]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let a=[];for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&a.push(s);return a},t.find=(n,a)=>{for(let s of n)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,a=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(ee||(ee={}));var Yf;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(Yf||(Yf={}));var q=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pi=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},S=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),kt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){let i=e||function(a){return a.message},r={_errors:[]},n=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(i(s));else{let o=r,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(i(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){let i={},r=[];for(let n of this.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}};kt.create=t=>new kt(t);var Gn=(t,e)=>{let i;switch(t.code){case S.invalid_type:t.received===q.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:i=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case S.invalid_union:i="Invalid input";break;case S.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case S.invalid_enum_value:i=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:i="Invalid function arguments";break;case S.invalid_return_type:i="Invalid function return type";break;case S.invalid_date:i="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case S.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case S.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case S.custom:i="Invalid input";break;case S.invalid_intersection_types:i="Intersection results could not be merged";break;case S.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:i="Number must be finite";break;default:i=e.defaultError,ee.assertNever(t)}return{message:i}},XS=Gn;function h9(t){XS=t}function Zc(){return XS}var Xc=t=>{let{data:e,path:i,errorMaps:r,issueData:n}=t,a=[...i,...n.path||[]],s={...n,path:a};if(n.message!==void 0)return{...n,path:a,message:n.message};let o="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)o=l(s,{data:e,defaultError:o}).message;return{...n,path:a,message:o}},g9=[];function j(t,e){let i=Zc(),r=Xc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Gn?void 0:Gn].filter(n=>!!n)});t.common.issues.push(r)}var et=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){let r=[];for(let n of i){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){let r=[];for(let n of i){let a=await n.key,s=await n.value;r.push({key:a,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,i){let r={};for(let n of i){let{key:a,value:s}=n;if(a.status==="aborted"||s.status==="aborted")return F;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}},F=Object.freeze({status:"aborted"}),Qn=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),em=t=>t.status==="aborted",tm=t=>t.status==="dirty",Cr=t=>t.status==="valid",Ls=t=>typeof Promise<"u"&&t instanceof Promise;function Jc(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function JS(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ms,Rs,qt=class{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WS=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new kt(t.common.issues);return this._error=i,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(s,o)=>{var c,l;let{message:p}=t;return s.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:o.defaultError}},description:n}}var Q=class{get description(){return this._def.description}_getType(e){return Pi(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new et,ctx:{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let i=this._parse(e);if(Ls(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){let i=this._parse(e);return Promise.resolve(i)}parse(e,i){let r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){var r;let n={common:{issues:[],async:(r=i?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},a=this._parseSync({data:e,path:n.path,parent:n});return WS(n,a)}"~validate"(e){var i,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:n});return Cr(a)?{value:a.value}:{issues:n.common.issues}}catch(a){!((r=(i=a?.message)===null||i===void 0?void 0:i.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>Cr(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,i){let r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){let r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(Ls(n)?n:Promise.resolve(n));return WS(r,a)}refine(e,i){let r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,a)=>{let s=e(n),o=()=>a.addIssue({code:S.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new Tt({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return It.create(this,this._def)}nullable(){return ui.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ni.create(this)}promise(){return Zi.create(this,this._def)}or(e){return Mr.create([this,e],this._def)}and(e){return Rr.create(this,e,this._def)}transform(e){return new Tt({...V(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let i=typeof e=="function"?e:()=>e;return new Fr({...V(this._def),innerType:this,defaultValue:i,typeName:B.ZodDefault})}brand(){return new Ds({typeName:B.ZodBranded,type:this,...V(this._def)})}catch(e){let i=typeof e=="function"?e:()=>e;return new Ur({...V(this._def),innerType:this,catchValue:i,typeName:B.ZodCatch})}describe(e){let i=this.constructor;return new i({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},v9=/^c[^\s-]{8,}$/i,x9=/^[0-9a-z]+$/,y9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w9=/^[a-z0-9_-]{21}$/i,_9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,k9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jf,T9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,A9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,YS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",O9=new RegExp(`^${YS}$`);function eE(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function I9(t){return new RegExp(`^${eE(t)}$`)}function tE(t){let e=`${YS}T${eE(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function q9(t,e){return!!((e==="v4"||!e)&&T9.test(t)||(e==="v6"||!e)&&C9.test(t))}function M9(t,e){if(!_9.test(t))return!1;try{let[i]=t.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function R9(t,e){return!!((e==="v4"||!e)&&A9.test(t)||(e==="v6"||!e)&&P9.test(t))}var Wi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.string,received:a.parsedType}),F}let r=new et,n;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Jf||(Jf=new RegExp(k9,"u")),Jf.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")b9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")w9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")v9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")x9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")y9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),j(n,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?tE(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?O9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?I9(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?S9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?q9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M9(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?R9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?N9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):ee.assertNever(a);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:S.invalid_string,...L.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var i,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...L.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...L.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...L.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...L.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...L.errToObj(i)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:B.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};function L9(t,e){let i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,a=parseInt(t.toFixed(n).replace(".","")),s=parseInt(e.toFixed(n).replace(".",""));return a%s/Math.pow(10,n)}var Pr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.number,received:a.parsedType}),F}let r,n=new et;for(let a of this._def.checks)a.kind==="int"?ee.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?L9(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_finite,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,i=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Pr.create=t=>new Pr({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...V(t)});var jr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let r,n=new et;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.bigint,received:i.parsedType}),F}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};jr.create=t=>{var e;return new jr({checks:[],typeName:B.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};var Nr=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.boolean,received:r.parsedType}),F}return ct(e.data)}};Nr.create=t=>new Nr({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var Or=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.date,received:a.parsedType}),F}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_date}),F}let r=new et,n;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ee.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(i)})}get minDate(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Or.create=t=>new Or({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...V(t)});var Wn=class extends Q{_parse(e){if(this._getType(e)!==q.symbol){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.symbol,received:r.parsedType}),F}return ct(e.data)}};Wn.create=t=>new Wn({typeName:B.ZodSymbol,...V(t)});var Ir=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.undefined,received:r.parsedType}),F}return ct(e.data)}};Ir.create=t=>new Ir({typeName:B.ZodUndefined,...V(t)});var qr=class extends Q{_parse(e){if(this._getType(e)!==q.null){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.null,received:r.parsedType}),F}return ct(e.data)}};qr.create=t=>new qr({typeName:B.ZodNull,...V(t)});var Ki=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};Ki.create=t=>new Ki({typeName:B.ZodAny,...V(t)});var ji=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};ji.create=t=>new ji({typeName:B.ZodUnknown,...V(t)});var Wt=class extends Q{_parse(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.never,received:i.parsedType}),F}};Wt.create=t=>new Wt({typeName:B.ZodNever,...V(t)});var Kn=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.void,received:r.parsedType}),F}return ct(e.data)}};Kn.create=t=>new Kn({typeName:B.ZodVoid,...V(t)});var Ni=class t extends Q{_parse(e){let{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==q.array)return j(i,{code:S.invalid_type,expected:q.array,received:i.parsedType}),F;if(n.exactLength!==null){let s=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(s||o)&&(j(i,{code:s?S.too_big:S.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(j(i,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dnpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:145
		`;await i.execute(x`CREATE SCHEMA IF NOT EXISTS ${x.identifier(a)}`),await i.execute(s);let c=(await i.all(x`select id, hash, created_at from ${x.identifier(a)}.${x.identifier(n)} order by created_at desc limit 1`))[0];await i.transaction(async l=>{for await(let p of e)if(!c||Number(c.created_at)<p.folderMillis){for(let u of p.sql)await l.execute(x.raw(u));await l.execute(x`insert into ${x.identifier(a)}.${x.identifier(n)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let i=[x`with `];for(let[r,n]of e.entries())i.push(x`${x.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&i.push(x`, `);return i.push(x` `),x.join(i)}buildDeleteQuery({table:e,where:i,returning:r,withList:n}){let a=this.buildWithCTE(n),s=r?x` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=i?x` where ${i}`:void 0;return x`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,i){let r=e[N.Symbol.Columns],n=Object.keys(r).filter(s=>i[s]!==void 0||r[s]?.onUpdateFn!==void 0),a=n.length;return x.join(n.flatMap((s,o)=>{let c=r[s],l=i[s]??x.param(c.onUpdateFn(),c),p=x`${x.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<a-1?[p,x.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:i,where:r,returning:n,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),l=e[We.Symbol.Name],p=e[We.Symbol.Schema],u=e[We.Symbol.OriginalName],d=l===u?void 0:l,f=x`${p?x`${x.identifier(p)}.`:void 0}${x.identifier(u)}${d&&x` ${x.identifier(d)}`}`,m=this.buildUpdateSet(e,i),h=s&&x.join([x.raw(" from "),this.buildFromTable(s)]),y=this.buildJoins(o),b=n?x` returning ${this.buildSelection(n,{isSingleTable:!s})}`:void 0,T=r?x` where ${r}`:void 0;return x`${c}update ${f} set ${m}${h}${y}${T}${b}`}buildSelection(e,{isSingleTable:i=!1}={}){let r=e.length,n=e.flatMap(({field:a},s)=>{let o=[];if(w(a,M.Aliased)&&a.isSelectionField)o.push(x.identifier(a.fieldAlias));else if(w(a,M.Aliased)||w(a,M)){let c=w(a,M.Aliased)?a.sql:a;i?o.push(new M(c.queryChunks.map(l=>w(l,P)?x.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),w(a,M.Aliased)&&o.push(x` as ${x.identifier(a.fieldAlias)}`)}else w(a,ae)&&(i?o.push(x.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<r-1&&o.push(x`, `),o});return x.join(n)}buildJoins(e){if(!e||e.length===0)return;let i=[];for(let[r,n]of e.entries()){r===0&&i.push(x` `);let a=n.table,s=n.lateral?x` lateral`:void 0;if(w(a,We)){let o=a[We.Symbol.Name],c=a[We.Symbol.Schema],l=a[We.Symbol.OriginalName],p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else if(w(a,ot)){let o=a[xe].name,c=a[xe].schema,l=a[xe].originalName,p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else i.push(x`${x.raw(n.joinType)} join${s} ${a} on ${n.on}`);r<e.length-1&&i.push(x` `)}return x.join(i)}buildFromTable(e){if(w(e,N)&&e[N.Symbol.OriginalName]!==e[N.Symbol.Name]){let i=x`${x.identifier(e[N.Symbol.OriginalName])}`;return e[N.Symbol.Schema]&&(i=x`${x.identifier(e[N.Symbol.Schema])}.${i}`),x`${i} ${x.identifier(e[N.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:i,fieldsFlat:r,where:n,having:a,table:s,joins:o,orderBy:c,groupBy:l,limit:p,offset:u,lockingClause:d,distinct:f,setOperators:m}){let h=r??Nt(i);for(let te of h)if(w(te.field,ae)&&vt(te.field.table)!==(w(s,Le)?s._.alias:w(s,Fn)?s[xe].name:w(s,M)?void 0:vt(s))&&!(ie=>o?.some(({alias:Y})=>Y===(ie[N.Symbol.IsAlias]?vt(ie):ie[N.Symbol.BaseName])))(te.field.table)){let ie=vt(te.field.table);throw new Error(`Your "${te.path.join("->")}" field references a column "${ie}"."${te.field.name}", but the table "${ie}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,b=this.buildWithCTE(e),T;f&&(T=f===!0?x` distinct`:x` distinct on (${x.join(f.on,x`, `)})`);let _=this.buildSelection(h,{isSingleTable:y}),A=this.buildFromTable(s),O=this.buildJoins(o),E=n?x` where ${n}`:void 0,C=a?x` having ${a}`:void 0,I;c&&c.length>0&&(I=x` order by ${x.join(c,x`, `)}`);let z;l&&l.length>0&&(z=x` group by ${x.join(l,x`, `)}`);let me=typeof p=="object"||typeof p=="number"&&p>=0?x` limit ${p}`:void 0,Ee=u?x` offset ${u}`:void 0,ye=x.empty();if(d){let te=x` for ${x.raw(d.strength)}`;d.config.of&&te.append(x` of ${x.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],x`, `)}`),d.config.noWait?te.append(x` no wait`):d.config.skipLocked&&te.append(x` skip locked`),ye.append(te)}let G=x`${b}select${T} ${_} from ${A}${O}${E}${z}${C}${I}${me}${Ee}${ye}`;return m.length>0?this.buildSetOperations(G,m):G}buildSetOperations(e,i){let[r,...n]=i;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:i,isAll:r,rightSelect:n,limit:a,orderBy:s,offset:o}}){let c=x`(${e.getSQL()}) `,l=x`(${n.getSQL()})`,p;if(s&&s.length>0){let m=[];for(let h of s)if(w(h,P))m.push(x.identifier(h.name));else if(w(h,M)){for(let y=0;y<h.queryChunks.length;y++){let b=h.queryChunks[y];w(b,P)&&(h.queryChunks[y]=x.identifier(b.name))}m.push(x`${h}`)}else m.push(x`${h}`);p=x` order by ${x.join(m,x`, `)} `}let u=typeof a=="object"||typeof a=="number"&&a>=0?x` limit ${a}`:void 0,d=x.raw(`${i} ${r?"all ":""}`),f=o?x` offset ${o}`:void 0;return x`${c}${d}${l}${p}${u}${f}`}buildInsertQuery({table:e,values:i,onConflict:r,returning:n,withList:a,select:s,overridingSystemValue_:o}){let c=[],l=e[N.Symbol.Columns],p=Object.entries(l).filter(([b,T])=>!T.shouldDisableInsert()),u=p.map(([,b])=>x.identifier(this.casing.getColumnCasing(b)));if(s){let b=i;w(b,M)?c.push(b):c.push(b.getSQL())}else{let b=i;c.push(x.raw("values "));for(let[T,_]of b.entries()){let A=[];for(let[O,E]of p){let C=_[O];if(C===void 0||w(C,xt)&&C.value===void 0)if(E.defaultFn!==void 0){let I=E.defaultFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else if(!E.default&&E.onUpdateFn!==void 0){let I=E.onUpdateFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else A.push(x`default`);else A.push(C)}c.push(A),T<b.length-1&&c.push(x`, `)}}let d=this.buildWithCTE(a),f=x.join(c),m=n?x` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,h=r?x` on conflict ${r}`:void 0,y=o===!0?x`overriding system value `:void 0;return x`${d}insert into ${e} ${u} ${y}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:i,withNoData:r}){let n=i?x` concurrently`:void 0,a=r?x` with no data`:void 0;return x`refresh materialized view${n} ${e}${a}`}prepareTyping(e){return w(e,ks)||w(e,Es)?"json":w(e,Ts)?"decimal":w(e,As)?"time":w(e,Cs)||w(e,Ps)?"timestamp":w(e,_s)||w(e,Ss)?"date":w(e,js)?"uuid":"none"}sqlToQuery(e,i){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:i})}buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:n,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let p=[],u,d,f=[],m,h=[];if(s===!0)p=Object.entries(a.columns).map(([T,_])=>({dbKey:_.name,tsKey:T,field:ci(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([C,I])=>[C,ci(I,o)]));if(s.where){let C=typeof s.where=="function"?s.where(b,$S()):s.where;m=C&&xs(C,o)}let T=[],_=[];if(s.columns){let C=!1;for(let[I,z]of Object.entries(s.columns))z!==void 0&&I in a.columns&&(!C&&z===!0&&(C=!0),_.push(I));_.length>0&&(_=C?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let C of _){let I=a.columns[C];T.push({tsKey:C,value:I})}let A=[];s.with&&(A=Object.entries(s.with).filter(C=>!!C[1]).map(([C,I])=>({tsKey:C,queryConfig:I,relation:a.relations[C]})));let O;if(s.extras){O=typeof s.extras=="function"?s.extras(b,{sql:x}):s.extras;for(let[C,I]of Object.entries(O))T.push({tsKey:C,value:Cd(I,o)})}for(let{tsKey:C,value:I}of T)p.push({dbKey:w(I,M.Aliased)?I.fieldAlias:a.columns[C].name,tsKey:C,field:w(I,ae)?ci(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof s.orderBy=="function"?s.orderBy(b,HS()):s.orderBy??[];Array.isArray(E)||(E=[E]),f=E.map(C=>w(C,ae)?ci(C,o):xs(C,o)),u=s.limit,d=s.offset;for(let{tsKey:C,queryConfig:I,relation:z}of A){let me=QS(i,r,z),Ee=kr(z.referencedTable),ye=r[Ee],G=`${o}_${C}`,te=bs(...me.fields.map((H,Pe)=>Se(ci(me.references[Pe],G),ci(H,o)))),ie=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:e[ye],tableConfig:i[ye],queryConfig:w(z,Qi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:G,joinOn:te,nestedQueryRelation:z}),Y=x`${x.identifier(G)}.${x.identifier("data")}`.as(C);h.push({on:x`true`,table:new Le(ie.sql,{},G),alias:G,joinType:"left",lateral:!0}),p.push({dbKey:C,tsKey:C,field:Y,relationTableTsKey:ye,isJson:!0,selection:ie.selection})}}if(p.length===0)throw new ys({message:`No fields selected for table "${a.tsName}" ("${o}")`});let y;if(m=bs(l,m),c){let b=x`json_build_array(${x.join(p.map(({field:A,tsKey:O,isJson:E})=>E?x`${x.identifier(`${o}_${O}`)}.${x.identifier("data")}`:w(A,M.Aliased)?A.sql:A),x`, `)})`;w(c,Ns)&&(b=x`coalesce(json_agg(${b}${f.length>0?x` order by ${x.join(f,x`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:p}];u!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:[{path:[],field:x.raw("*")}],where:m,limit:u,offset:d,orderBy:f,setOperators:[]}),m=void 0,u=void 0,d=void 0,f=[]):y=vs(n,o),y=this.buildSelectQuery({table:w(y,We)?y:new Le(y,{},o),fields:{},fieldsFlat:T.map(({field:A})=>({path:[],field:w(A,ae)?ci(A,o):A})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:p.map(({field:b})=>({path:[],field:w(b,ae)?ci(b,o):b})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:y,selection:p}}};var Bc=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var Ye=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let i=!!this.fields,r=e,n;return this.fields?n=this.fields:w(r,Le)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(a=>[a,r[a]])):w(r,Fn)?n=r[xe].selectedFields:w(r,M)?n={}:n=qc(r),new zc({table:r,fields:n,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Zf=class extends Bc{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:i,isPartialSelect:r,session:n,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...i},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=a,this._={selectedFields:i},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(i,r)=>{let n=this.tableName,a=ki(i);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof a=="string"&&!w(i,M))){let s=w(i,Le)?i._.selectedFields:w(i,ot)?i[xe].selectedFields:i[N.Symbol.Columns];this.config.fields[a]=s}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:i,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,i){return r=>{let n=typeof r=="function"?r(o9()):r;if(!ws(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:i,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(i)?i:[i]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(i)?i:[i];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let i=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,i={}){return this.config.lockingClause={strength:e,config:i},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}as(e){return new Proxy(new Le(this.getSQL(),this.config.fields,e),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Oe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},zc=class extends Zf{static[v]="PgSelect";_prepare(e){let{session:i,config:r,dialect:n,joinsNotNullableMap:a,authToken:s}=this;if(!i)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ve.startActiveSpan("drizzle.prepareQuery",()=>{let o=Nt(r.fields),c=i.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(zc,[Je]);function Un(t,e){return(i,r,...n)=>{let a=[r,...n].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!ws(i.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(a)}}var o9=()=>({union:c9,unionAll:l9,intersect:p9,intersectAll:u9,except:d9,exceptAll:f9}),c9=Un("union",!1),l9=Un("union",!0),p9=Un("intersect",!1),u9=Un("intersect",!0),d9=Un("except",!1),f9=Un("except",!0);var $n=class{static[v]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=w(e,Gi)?e:void 0,this.dialectConfig=w(e,Gi)?void 0:e}$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(r)),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let i=this;function r(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),withList:e})}function n(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),distinct:!0})}function a(s,o){return new Ye({fields:o??void 0,session:void 0,dialect:i.getDialect(),distinct:{on:s}})}return{select:r,selectDistinct:n,selectDistinctOn:a}}select(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Gi(this.dialectConfig)),this.dialect}};var Is=class{constructor(e,i,r,n,a){this.table=e,this.session=i,this.dialect=r,this.withList=n,this.overridingSystemValue_=a}static[v]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let i=e.map(r=>{let n={},a=this.table[N.Symbol.Columns];for(let s of Object.keys(r)){let o=r[s];n[s]=w(o,M)?o:new xt(o,a[s])}return n});return new Fc(this.table,i,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let i=typeof e=="function"?e(new $n):e;if(!w(i,M)&&!ws(this.table[Pc],i._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Fc(this.table,i,this.session,this.dialect,this.withList,!0)}},Fc=class extends Je{constructor(e,i,r,n,a,s,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:i,withList:a,select:s,overridingSystemValue_:o}}static[v]="PgInsert";config;returning(e=this.config.table[N.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Nt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=x`do nothing`;else{let i="";i=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?x` where ${e.where}`:void 0;this.config.onConflict=x`(${x.raw(i)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let i=e.where?x` where ${e.where}`:void 0,r=e.targetWhere?x` where ${e.targetWhere}`:void 0,n=e.setWhere?x` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ic(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=x`(${x.raw(s)})${r} do update set ${a}${i}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Uc=class extends Je{constructor(e,i,r){super(),this.session=i,this.dialect=r,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var qs=class{constructor(e,i,r,n){this.table=e,this.session=i,this.dialect=r,this.withList=n}static[v]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Xf(this.table,Ic(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Xf=class extends Je{constructor(e,i,r,n,a){super(),this.session=r,this.dialect=n,this.config={set:i,table:e,withList:a,joins:[]},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[v]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let i=e,r=ki(i);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=i,this}getTableLikeFields(e){return w(e,We)?e[N.Symbol.Columns]:w(e,Le)?e._.selectedFields:e[xe].selectedFields}createJoin(e){return(i,r)=>{let n=ki(i);if(typeof n=="string"&&this.config.joins.some(a=>a.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let a=this.config.from&&!w(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[N.Symbol.Columns],new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:i,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[N.Symbol.Columns]),this.config.from)){let i=ki(this.config.from);if(typeof i=="string"&&this.config.from&&!w(this.config.from,M)){let r=this.getTableLikeFields(this.config.from);e[i]=r}for(let r of this.config.joins){let n=ki(r.table);if(typeof n=="string"&&!w(r.table,M)){let a=this.getTableLikeFields(r.table);e[n]=a}}}return this.config.returningFields=e,this.config.returning=Nt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){let i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var $c=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[v]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,i){return x`(select count(*) from ${e}${x.raw(" where ").if(i)}${i})`}static buildCount(e,i){return x`select count(*) as count from ${e}${x.raw(" where ").if(i)}${i};`}setToken(e){return this.token=e,this}then(e,i){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,i)}catch(e){return this.then(void 0,e)}finally(e){return this.then(i=>(e?.(),i),i=>{throw e?.(),i})}};var Hc=class{constructor(e,i,r,n,a,s,o){this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vc=class extends Je{constructor(e,i,r,n,a,s,o,c,l){super(),this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[v]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:i,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,a)=>{let s=n.map(o=>Lc(this.schema,this.tableConfig,o,i.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),i=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:i}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Qc=class extends Je{constructor(e,i,r,n){super(),this.execute=e,this.sql=i,this.query=r,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,i){return i?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Hn=class{constructor(e,i,r){if(this.dialect=e,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:i}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:i},this.query={},this._.schema)for(let[n,a]of Object.entries(this._.schema))this.query[n]=new Hc(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],a,e,i)}static[v]="PgDatabase";query;$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(new $n(r.dialect))),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,i){return new $c({source:e,filters:i,session:this.session})}with(...e){let i=this;function r(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e})}function n(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:!0})}function a(l,p){return new Ye({fields:p??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:{on:l}})}function s(l){return new qs(l,i.session,i.dialect,e)}function o(l){return new Is(l,i.session,i.dialect,e)}function c(l){return new Os(l,i.session,i.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new qs(e,this.session,this.dialect)}insert(e){return new Is(e,this.session,this.dialect)}delete(e){return new Os(e,this.session,this.dialect)}refreshMaterializedView(e){return new Uc(e,this.session,this.dialect)}authToken;execute(e){let i=typeof e=="string"?x.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(i),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Qc(()=>n.execute(void 0,this.authToken),i,r,a=>n.mapResult(a,!0))}transaction(e,i){return this.session.transaction(e,i)}};var Gc=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,i){return e}setToken(e){return this.authToken=e,this}static[v]="PgPreparedQuery";joinsNotNullableMap},Wc=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e,i){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(i).execute(void 0,i))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,i){let r=await this.execute(e,i);return Number(r[0].count)}},Kc=class extends Hn{constructor(e,i,r,n=0){super(e,i,r),this.schema=r,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new jc}getTransactionConfigSQL(e){let i=[];return e.isolationLevel&&i.push(`isolation level ${e.isolationLevel}`),e.accessMode&&i.push(e.accessMode),typeof e.deferrable=="boolean"&&i.push(e.deferrable?"deferrable":"not deferrable"),x.raw(i.join(" "))}setTransaction(e){return this.session.execute(x`set transaction ${this.getTransactionConfigSQL(e)}`)}};var ee;(function(t){t.assertEqual=n=>n;function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{let a={};for(let s of n)a[s]=s;return a},t.getValidEnumValues=n=>{let a=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(let o of a)s[o]=n[o];return t.objectValues(s)},t.objectValues=n=>t.objectKeys(n).map(function(a){return n[a]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let a=[];for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&a.push(s);return a},t.find=(n,a)=>{for(let s of n)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,a=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(ee||(ee={}));var Yf;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(Yf||(Yf={}));var q=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pi=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},S=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),kt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){let i=e||function(a){return a.message},r={_errors:[]},n=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(i(s));else{let o=r,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(i(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){let i={},r=[];for(let n of this.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}};kt.create=t=>new kt(t);var Gn=(t,e)=>{let i;switch(t.code){case S.invalid_type:t.received===q.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:i=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case S.invalid_union:i="Invalid input";break;case S.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case S.invalid_enum_value:i=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:i="Invalid function arguments";break;case S.invalid_return_type:i="Invalid function return type";break;case S.invalid_date:i="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case S.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case S.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case S.custom:i="Invalid input";break;case S.invalid_intersection_types:i="Intersection results could not be merged";break;case S.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:i="Number must be finite";break;default:i=e.defaultError,ee.assertNever(t)}return{message:i}},XS=Gn;function h9(t){XS=t}function Zc(){return XS}var Xc=t=>{let{data:e,path:i,errorMaps:r,issueData:n}=t,a=[...i,...n.path||[]],s={...n,path:a};if(n.message!==void 0)return{...n,path:a,message:n.message};let o="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)o=l(s,{data:e,defaultError:o}).message;return{...n,path:a,message:o}},g9=[];function j(t,e){let i=Zc(),r=Xc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Gn?void 0:Gn].filter(n=>!!n)});t.common.issues.push(r)}var et=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){let r=[];for(let n of i){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){let r=[];for(let n of i){let a=await n.key,s=await n.value;r.push({key:a,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,i){let r={};for(let n of i){let{key:a,value:s}=n;if(a.status==="aborted"||s.status==="aborted")return F;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}},F=Object.freeze({status:"aborted"}),Qn=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),em=t=>t.status==="aborted",tm=t=>t.status==="dirty",Cr=t=>t.status==="valid",Ls=t=>typeof Promise<"u"&&t instanceof Promise;function Jc(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function JS(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ms,Rs,qt=class{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WS=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new kt(t.common.issues);return this._error=i,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(s,o)=>{var c,l;let{message:p}=t;return s.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:o.defaultError}},description:n}}var Q=class{get description(){return this._def.description}_getType(e){return Pi(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new et,ctx:{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let i=this._parse(e);if(Ls(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){let i=this._parse(e);return Promise.resolve(i)}parse(e,i){let r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){var r;let n={common:{issues:[],async:(r=i?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},a=this._parseSync({data:e,path:n.path,parent:n});return WS(n,a)}"~validate"(e){var i,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:n});return Cr(a)?{value:a.value}:{issues:n.common.issues}}catch(a){!((r=(i=a?.message)===null||i===void 0?void 0:i.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>Cr(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,i){let r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){let r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(Ls(n)?n:Promise.resolve(n));return WS(r,a)}refine(e,i){let r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,a)=>{let s=e(n),o=()=>a.addIssue({code:S.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new Tt({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return It.create(this,this._def)}nullable(){return ui.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ni.create(this)}promise(){return Zi.create(this,this._def)}or(e){return Mr.create([this,e],this._def)}and(e){return Rr.create(this,e,this._def)}transform(e){return new Tt({...V(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let i=typeof e=="function"?e:()=>e;return new Fr({...V(this._def),innerType:this,defaultValue:i,typeName:B.ZodDefault})}brand(){return new Ds({typeName:B.ZodBranded,type:this,...V(this._def)})}catch(e){let i=typeof e=="function"?e:()=>e;return new Ur({...V(this._def),innerType:this,catchValue:i,typeName:B.ZodCatch})}describe(e){let i=this.constructor;return new i({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},v9=/^c[^\s-]{8,}$/i,x9=/^[0-9a-z]+$/,y9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w9=/^[a-z0-9_-]{21}$/i,_9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,k9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jf,T9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,A9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,YS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",O9=new RegExp(`^${YS}$`);function eE(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function I9(t){return new RegExp(`^${eE(t)}$`)}function tE(t){let e=`${YS}T${eE(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function q9(t,e){return!!((e==="v4"||!e)&&T9.test(t)||(e==="v6"||!e)&&C9.test(t))}function M9(t,e){if(!_9.test(t))return!1;try{let[i]=t.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function R9(t,e){return!!((e==="v4"||!e)&&A9.test(t)||(e==="v6"||!e)&&P9.test(t))}var Wi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.string,received:a.parsedType}),F}let r=new et,n;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Jf||(Jf=new RegExp(k9,"u")),Jf.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")b9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")w9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")v9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")x9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")y9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),j(n,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?tE(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?O9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?I9(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?S9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?q9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M9(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?R9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?N9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):ee.assertNever(a);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:S.invalid_string,...L.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var i,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...L.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...L.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...L.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...L.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...L.errToObj(i)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:B.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};function L9(t,e){let i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,a=parseInt(t.toFixed(n).replace(".","")),s=parseInt(e.toFixed(n).replace(".",""));return a%s/Math.pow(10,n)}var Pr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.number,received:a.parsedType}),F}let r,n=new et;for(let a of this._def.checks)a.kind==="int"?ee.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?L9(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_finite,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,i=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Pr.create=t=>new Pr({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...V(t)});var jr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let r,n=new et;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.bigint,received:i.parsedType}),F}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};jr.create=t=>{var e;return new jr({checks:[],typeName:B.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};var Nr=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.boolean,received:r.parsedType}),F}return ct(e.data)}};Nr.create=t=>new Nr({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var Or=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.date,received:a.parsedType}),F}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_date}),F}let r=new et,n;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ee.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(i)})}get minDate(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Or.create=t=>new Or({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...V(t)});var Wn=class extends Q{_parse(e){if(this._getType(e)!==q.symbol){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.symbol,received:r.parsedType}),F}return ct(e.data)}};Wn.create=t=>new Wn({typeName:B.ZodSymbol,...V(t)});var Ir=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.undefined,received:r.parsedType}),F}return ct(e.data)}};Ir.create=t=>new Ir({typeName:B.ZodUndefined,...V(t)});var qr=class extends Q{_parse(e){if(this._getType(e)!==q.null){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.null,received:r.parsedType}),F}return ct(e.data)}};qr.create=t=>new qr({typeName:B.ZodNull,...V(t)});var Ki=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};Ki.create=t=>new Ki({typeName:B.ZodAny,...V(t)});var ji=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};ji.create=t=>new ji({typeName:B.ZodUnknown,...V(t)});var Wt=class extends Q{_parse(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.never,received:i.parsedType}),F}};Wt.create=t=>new Wt({typeName:B.ZodNever,...V(t)});var Kn=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.void,received:r.parsedType}),F}return ct(e.data)}};Kn.create=t=>new Kn({typeName:B.ZodVoid,...V(t)});var Ni=class t extends Q{_parse(e){let{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==q.array)return j(i,{code:S.invalid_type,expected:q.array,received:i.parsedType}),F;if(n.exactLength!==null){let s=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(s||o)&&(j(i,{code:s?S.too_big:S.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(j(i,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dnpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:145
		`;await i.execute(x`CREATE SCHEMA IF NOT EXISTS ${x.identifier(a)}`),await i.execute(s);let c=(await i.all(x`select id, hash, created_at from ${x.identifier(a)}.${x.identifier(n)} order by created_at desc limit 1`))[0];await i.transaction(async l=>{for await(let p of e)if(!c||Number(c.created_at)<p.folderMillis){for(let u of p.sql)await l.execute(x.raw(u));await l.execute(x`insert into ${x.identifier(a)}.${x.identifier(n)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let i=[x`with `];for(let[r,n]of e.entries())i.push(x`${x.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&i.push(x`, `);return i.push(x` `),x.join(i)}buildDeleteQuery({table:e,where:i,returning:r,withList:n}){let a=this.buildWithCTE(n),s=r?x` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=i?x` where ${i}`:void 0;return x`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,i){let r=e[N.Symbol.Columns],n=Object.keys(r).filter(s=>i[s]!==void 0||r[s]?.onUpdateFn!==void 0),a=n.length;return x.join(n.flatMap((s,o)=>{let c=r[s],l=i[s]??x.param(c.onUpdateFn(),c),p=x`${x.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<a-1?[p,x.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:i,where:r,returning:n,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),l=e[We.Symbol.Name],p=e[We.Symbol.Schema],u=e[We.Symbol.OriginalName],d=l===u?void 0:l,f=x`${p?x`${x.identifier(p)}.`:void 0}${x.identifier(u)}${d&&x` ${x.identifier(d)}`}`,m=this.buildUpdateSet(e,i),h=s&&x.join([x.raw(" from "),this.buildFromTable(s)]),y=this.buildJoins(o),b=n?x` returning ${this.buildSelection(n,{isSingleTable:!s})}`:void 0,T=r?x` where ${r}`:void 0;return x`${c}update ${f} set ${m}${h}${y}${T}${b}`}buildSelection(e,{isSingleTable:i=!1}={}){let r=e.length,n=e.flatMap(({field:a},s)=>{let o=[];if(w(a,M.Aliased)&&a.isSelectionField)o.push(x.identifier(a.fieldAlias));else if(w(a,M.Aliased)||w(a,M)){let c=w(a,M.Aliased)?a.sql:a;i?o.push(new M(c.queryChunks.map(l=>w(l,P)?x.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),w(a,M.Aliased)&&o.push(x` as ${x.identifier(a.fieldAlias)}`)}else w(a,ae)&&(i?o.push(x.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<r-1&&o.push(x`, `),o});return x.join(n)}buildJoins(e){if(!e||e.length===0)return;let i=[];for(let[r,n]of e.entries()){r===0&&i.push(x` `);let a=n.table,s=n.lateral?x` lateral`:void 0;if(w(a,We)){let o=a[We.Symbol.Name],c=a[We.Symbol.Schema],l=a[We.Symbol.OriginalName],p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else if(w(a,ot)){let o=a[xe].name,c=a[xe].schema,l=a[xe].originalName,p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else i.push(x`${x.raw(n.joinType)} join${s} ${a} on ${n.on}`);r<e.length-1&&i.push(x` `)}return x.join(i)}buildFromTable(e){if(w(e,N)&&e[N.Symbol.OriginalName]!==e[N.Symbol.Name]){let i=x`${x.identifier(e[N.Symbol.OriginalName])}`;return e[N.Symbol.Schema]&&(i=x`${x.identifier(e[N.Symbol.Schema])}.${i}`),x`${i} ${x.identifier(e[N.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:i,fieldsFlat:r,where:n,having:a,table:s,joins:o,orderBy:c,groupBy:l,limit:p,offset:u,lockingClause:d,distinct:f,setOperators:m}){let h=r??Nt(i);for(let te of h)if(w(te.field,ae)&&vt(te.field.table)!==(w(s,Le)?s._.alias:w(s,Fn)?s[xe].name:w(s,M)?void 0:vt(s))&&!(ie=>o?.some(({alias:Y})=>Y===(ie[N.Symbol.IsAlias]?vt(ie):ie[N.Symbol.BaseName])))(te.field.table)){let ie=vt(te.field.table);throw new Error(`Your "${te.path.join("->")}" field references a column "${ie}"."${te.field.name}", but the table "${ie}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,b=this.buildWithCTE(e),T;f&&(T=f===!0?x` distinct`:x` distinct on (${x.join(f.on,x`, `)})`);let _=this.buildSelection(h,{isSingleTable:y}),A=this.buildFromTable(s),O=this.buildJoins(o),E=n?x` where ${n}`:void 0,C=a?x` having ${a}`:void 0,I;c&&c.length>0&&(I=x` order by ${x.join(c,x`, `)}`);let z;l&&l.length>0&&(z=x` group by ${x.join(l,x`, `)}`);let me=typeof p=="object"||typeof p=="number"&&p>=0?x` limit ${p}`:void 0,Ee=u?x` offset ${u}`:void 0,ye=x.empty();if(d){let te=x` for ${x.raw(d.strength)}`;d.config.of&&te.append(x` of ${x.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],x`, `)}`),d.config.noWait?te.append(x` no wait`):d.config.skipLocked&&te.append(x` skip locked`),ye.append(te)}let G=x`${b}select${T} ${_} from ${A}${O}${E}${z}${C}${I}${me}${Ee}${ye}`;return m.length>0?this.buildSetOperations(G,m):G}buildSetOperations(e,i){let[r,...n]=i;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:i,isAll:r,rightSelect:n,limit:a,orderBy:s,offset:o}}){let c=x`(${e.getSQL()}) `,l=x`(${n.getSQL()})`,p;if(s&&s.length>0){let m=[];for(let h of s)if(w(h,P))m.push(x.identifier(h.name));else if(w(h,M)){for(let y=0;y<h.queryChunks.length;y++){let b=h.queryChunks[y];w(b,P)&&(h.queryChunks[y]=x.identifier(b.name))}m.push(x`${h}`)}else m.push(x`${h}`);p=x` order by ${x.join(m,x`, `)} `}let u=typeof a=="object"||typeof a=="number"&&a>=0?x` limit ${a}`:void 0,d=x.raw(`${i} ${r?"all ":""}`),f=o?x` offset ${o}`:void 0;return x`${c}${d}${l}${p}${u}${f}`}buildInsertQuery({table:e,values:i,onConflict:r,returning:n,withList:a,select:s,overridingSystemValue_:o}){let c=[],l=e[N.Symbol.Columns],p=Object.entries(l).filter(([b,T])=>!T.shouldDisableInsert()),u=p.map(([,b])=>x.identifier(this.casing.getColumnCasing(b)));if(s){let b=i;w(b,M)?c.push(b):c.push(b.getSQL())}else{let b=i;c.push(x.raw("values "));for(let[T,_]of b.entries()){let A=[];for(let[O,E]of p){let C=_[O];if(C===void 0||w(C,xt)&&C.value===void 0)if(E.defaultFn!==void 0){let I=E.defaultFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else if(!E.default&&E.onUpdateFn!==void 0){let I=E.onUpdateFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else A.push(x`default`);else A.push(C)}c.push(A),T<b.length-1&&c.push(x`, `)}}let d=this.buildWithCTE(a),f=x.join(c),m=n?x` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,h=r?x` on conflict ${r}`:void 0,y=o===!0?x`overriding system value `:void 0;return x`${d}insert into ${e} ${u} ${y}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:i,withNoData:r}){let n=i?x` concurrently`:void 0,a=r?x` with no data`:void 0;return x`refresh materialized view${n} ${e}${a}`}prepareTyping(e){return w(e,ks)||w(e,Es)?"json":w(e,Ts)?"decimal":w(e,As)?"time":w(e,Cs)||w(e,Ps)?"timestamp":w(e,_s)||w(e,Ss)?"date":w(e,js)?"uuid":"none"}sqlToQuery(e,i){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:i})}buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:n,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let p=[],u,d,f=[],m,h=[];if(s===!0)p=Object.entries(a.columns).map(([T,_])=>({dbKey:_.name,tsKey:T,field:ci(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([C,I])=>[C,ci(I,o)]));if(s.where){let C=typeof s.where=="function"?s.where(b,$S()):s.where;m=C&&xs(C,o)}let T=[],_=[];if(s.columns){let C=!1;for(let[I,z]of Object.entries(s.columns))z!==void 0&&I in a.columns&&(!C&&z===!0&&(C=!0),_.push(I));_.length>0&&(_=C?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let C of _){let I=a.columns[C];T.push({tsKey:C,value:I})}let A=[];s.with&&(A=Object.entries(s.with).filter(C=>!!C[1]).map(([C,I])=>({tsKey:C,queryConfig:I,relation:a.relations[C]})));let O;if(s.extras){O=typeof s.extras=="function"?s.extras(b,{sql:x}):s.extras;for(let[C,I]of Object.entries(O))T.push({tsKey:C,value:Cd(I,o)})}for(let{tsKey:C,value:I}of T)p.push({dbKey:w(I,M.Aliased)?I.fieldAlias:a.columns[C].name,tsKey:C,field:w(I,ae)?ci(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof s.orderBy=="function"?s.orderBy(b,HS()):s.orderBy??[];Array.isArray(E)||(E=[E]),f=E.map(C=>w(C,ae)?ci(C,o):xs(C,o)),u=s.limit,d=s.offset;for(let{tsKey:C,queryConfig:I,relation:z}of A){let me=QS(i,r,z),Ee=kr(z.referencedTable),ye=r[Ee],G=`${o}_${C}`,te=bs(...me.fields.map((H,Pe)=>Se(ci(me.references[Pe],G),ci(H,o)))),ie=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:e[ye],tableConfig:i[ye],queryConfig:w(z,Qi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:G,joinOn:te,nestedQueryRelation:z}),Y=x`${x.identifier(G)}.${x.identifier("data")}`.as(C);h.push({on:x`true`,table:new Le(ie.sql,{},G),alias:G,joinType:"left",lateral:!0}),p.push({dbKey:C,tsKey:C,field:Y,relationTableTsKey:ye,isJson:!0,selection:ie.selection})}}if(p.length===0)throw new ys({message:`No fields selected for table "${a.tsName}" ("${o}")`});let y;if(m=bs(l,m),c){let b=x`json_build_array(${x.join(p.map(({field:A,tsKey:O,isJson:E})=>E?x`${x.identifier(`${o}_${O}`)}.${x.identifier("data")}`:w(A,M.Aliased)?A.sql:A),x`, `)})`;w(c,Ns)&&(b=x`coalesce(json_agg(${b}${f.length>0?x` order by ${x.join(f,x`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:p}];u!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:[{path:[],field:x.raw("*")}],where:m,limit:u,offset:d,orderBy:f,setOperators:[]}),m=void 0,u=void 0,d=void 0,f=[]):y=vs(n,o),y=this.buildSelectQuery({table:w(y,We)?y:new Le(y,{},o),fields:{},fieldsFlat:T.map(({field:A})=>({path:[],field:w(A,ae)?ci(A,o):A})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:p.map(({field:b})=>({path:[],field:w(b,ae)?ci(b,o):b})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:y,selection:p}}};var Bc=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var Ye=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let i=!!this.fields,r=e,n;return this.fields?n=this.fields:w(r,Le)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(a=>[a,r[a]])):w(r,Fn)?n=r[xe].selectedFields:w(r,M)?n={}:n=qc(r),new zc({table:r,fields:n,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Zf=class extends Bc{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:i,isPartialSelect:r,session:n,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...i},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=a,this._={selectedFields:i},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(i,r)=>{let n=this.tableName,a=ki(i);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof a=="string"&&!w(i,M))){let s=w(i,Le)?i._.selectedFields:w(i,ot)?i[xe].selectedFields:i[N.Symbol.Columns];this.config.fields[a]=s}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:i,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,i){return r=>{let n=typeof r=="function"?r(o9()):r;if(!ws(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:i,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(i)?i:[i]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(i)?i:[i];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let i=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,i={}){return this.config.lockingClause={strength:e,config:i},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}as(e){return new Proxy(new Le(this.getSQL(),this.config.fields,e),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Oe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},zc=class extends Zf{static[v]="PgSelect";_prepare(e){let{session:i,config:r,dialect:n,joinsNotNullableMap:a,authToken:s}=this;if(!i)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ve.startActiveSpan("drizzle.prepareQuery",()=>{let o=Nt(r.fields),c=i.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(zc,[Je]);function Un(t,e){return(i,r,...n)=>{let a=[r,...n].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!ws(i.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(a)}}var o9=()=>({union:c9,unionAll:l9,intersect:p9,intersectAll:u9,except:d9,exceptAll:f9}),c9=Un("union",!1),l9=Un("union",!0),p9=Un("intersect",!1),u9=Un("intersect",!0),d9=Un("except",!1),f9=Un("except",!0);var $n=class{static[v]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=w(e,Gi)?e:void 0,this.dialectConfig=w(e,Gi)?void 0:e}$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(r)),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let i=this;function r(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),withList:e})}function n(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),distinct:!0})}function a(s,o){return new Ye({fields:o??void 0,session:void 0,dialect:i.getDialect(),distinct:{on:s}})}return{select:r,selectDistinct:n,selectDistinctOn:a}}select(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Gi(this.dialectConfig)),this.dialect}};var Is=class{constructor(e,i,r,n,a){this.table=e,this.session=i,this.dialect=r,this.withList=n,this.overridingSystemValue_=a}static[v]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let i=e.map(r=>{let n={},a=this.table[N.Symbol.Columns];for(let s of Object.keys(r)){let o=r[s];n[s]=w(o,M)?o:new xt(o,a[s])}return n});return new Fc(this.table,i,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let i=typeof e=="function"?e(new $n):e;if(!w(i,M)&&!ws(this.table[Pc],i._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Fc(this.table,i,this.session,this.dialect,this.withList,!0)}},Fc=class extends Je{constructor(e,i,r,n,a,s,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:i,withList:a,select:s,overridingSystemValue_:o}}static[v]="PgInsert";config;returning(e=this.config.table[N.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Nt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=x`do nothing`;else{let i="";i=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?x` where ${e.where}`:void 0;this.config.onConflict=x`(${x.raw(i)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let i=e.where?x` where ${e.where}`:void 0,r=e.targetWhere?x` where ${e.targetWhere}`:void 0,n=e.setWhere?x` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ic(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=x`(${x.raw(s)})${r} do update set ${a}${i}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Uc=class extends Je{constructor(e,i,r){super(),this.session=i,this.dialect=r,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var qs=class{constructor(e,i,r,n){this.table=e,this.session=i,this.dialect=r,this.withList=n}static[v]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Xf(this.table,Ic(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Xf=class extends Je{constructor(e,i,r,n,a){super(),this.session=r,this.dialect=n,this.config={set:i,table:e,withList:a,joins:[]},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[v]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let i=e,r=ki(i);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=i,this}getTableLikeFields(e){return w(e,We)?e[N.Symbol.Columns]:w(e,Le)?e._.selectedFields:e[xe].selectedFields}createJoin(e){return(i,r)=>{let n=ki(i);if(typeof n=="string"&&this.config.joins.some(a=>a.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let a=this.config.from&&!w(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[N.Symbol.Columns],new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:i,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[N.Symbol.Columns]),this.config.from)){let i=ki(this.config.from);if(typeof i=="string"&&this.config.from&&!w(this.config.from,M)){let r=this.getTableLikeFields(this.config.from);e[i]=r}for(let r of this.config.joins){let n=ki(r.table);if(typeof n=="string"&&!w(r.table,M)){let a=this.getTableLikeFields(r.table);e[n]=a}}}return this.config.returningFields=e,this.config.returning=Nt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){let i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var $c=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[v]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,i){return x`(select count(*) from ${e}${x.raw(" where ").if(i)}${i})`}static buildCount(e,i){return x`select count(*) as count from ${e}${x.raw(" where ").if(i)}${i};`}setToken(e){return this.token=e,this}then(e,i){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,i)}catch(e){return this.then(void 0,e)}finally(e){return this.then(i=>(e?.(),i),i=>{throw e?.(),i})}};var Hc=class{constructor(e,i,r,n,a,s,o){this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vc=class extends Je{constructor(e,i,r,n,a,s,o,c,l){super(),this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[v]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:i,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,a)=>{let s=n.map(o=>Lc(this.schema,this.tableConfig,o,i.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),i=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:i}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Qc=class extends Je{constructor(e,i,r,n){super(),this.execute=e,this.sql=i,this.query=r,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,i){return i?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Hn=class{constructor(e,i,r){if(this.dialect=e,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:i}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:i},this.query={},this._.schema)for(let[n,a]of Object.entries(this._.schema))this.query[n]=new Hc(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],a,e,i)}static[v]="PgDatabase";query;$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(new $n(r.dialect))),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,i){return new $c({source:e,filters:i,session:this.session})}with(...e){let i=this;function r(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e})}function n(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:!0})}function a(l,p){return new Ye({fields:p??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:{on:l}})}function s(l){return new qs(l,i.session,i.dialect,e)}function o(l){return new Is(l,i.session,i.dialect,e)}function c(l){return new Os(l,i.session,i.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new qs(e,this.session,this.dialect)}insert(e){return new Is(e,this.session,this.dialect)}delete(e){return new Os(e,this.session,this.dialect)}refreshMaterializedView(e){return new Uc(e,this.session,this.dialect)}authToken;execute(e){let i=typeof e=="string"?x.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(i),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Qc(()=>n.execute(void 0,this.authToken),i,r,a=>n.mapResult(a,!0))}transaction(e,i){return this.session.transaction(e,i)}};var Gc=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,i){return e}setToken(e){return this.authToken=e,this}static[v]="PgPreparedQuery";joinsNotNullableMap},Wc=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e,i){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(i).execute(void 0,i))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,i){let r=await this.execute(e,i);return Number(r[0].count)}},Kc=class extends Hn{constructor(e,i,r,n=0){super(e,i,r),this.schema=r,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new jc}getTransactionConfigSQL(e){let i=[];return e.isolationLevel&&i.push(`isolation level ${e.isolationLevel}`),e.accessMode&&i.push(e.accessMode),typeof e.deferrable=="boolean"&&i.push(e.deferrable?"deferrable":"not deferrable"),x.raw(i.join(" "))}setTransaction(e){return this.session.execute(x`set transaction ${this.getTransactionConfigSQL(e)}`)}};var ee;(function(t){t.assertEqual=n=>n;function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{let a={};for(let s of n)a[s]=s;return a},t.getValidEnumValues=n=>{let a=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(let o of a)s[o]=n[o];return t.objectValues(s)},t.objectValues=n=>t.objectKeys(n).map(function(a){return n[a]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let a=[];for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&a.push(s);return a},t.find=(n,a)=>{for(let s of n)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,a=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(ee||(ee={}));var Yf;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(Yf||(Yf={}));var q=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pi=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},S=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),kt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){let i=e||function(a){return a.message},r={_errors:[]},n=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(i(s));else{let o=r,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(i(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){let i={},r=[];for(let n of this.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}};kt.create=t=>new kt(t);var Gn=(t,e)=>{let i;switch(t.code){case S.invalid_type:t.received===q.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:i=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case S.invalid_union:i="Invalid input";break;case S.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case S.invalid_enum_value:i=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:i="Invalid function arguments";break;case S.invalid_return_type:i="Invalid function return type";break;case S.invalid_date:i="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case S.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case S.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case S.custom:i="Invalid input";break;case S.invalid_intersection_types:i="Intersection results could not be merged";break;case S.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:i="Number must be finite";break;default:i=e.defaultError,ee.assertNever(t)}return{message:i}},XS=Gn;function h9(t){XS=t}function Zc(){return XS}var Xc=t=>{let{data:e,path:i,errorMaps:r,issueData:n}=t,a=[...i,...n.path||[]],s={...n,path:a};if(n.message!==void 0)return{...n,path:a,message:n.message};let o="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)o=l(s,{data:e,defaultError:o}).message;return{...n,path:a,message:o}},g9=[];function j(t,e){let i=Zc(),r=Xc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Gn?void 0:Gn].filter(n=>!!n)});t.common.issues.push(r)}var et=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){let r=[];for(let n of i){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){let r=[];for(let n of i){let a=await n.key,s=await n.value;r.push({key:a,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,i){let r={};for(let n of i){let{key:a,value:s}=n;if(a.status==="aborted"||s.status==="aborted")return F;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}},F=Object.freeze({status:"aborted"}),Qn=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),em=t=>t.status==="aborted",tm=t=>t.status==="dirty",Cr=t=>t.status==="valid",Ls=t=>typeof Promise<"u"&&t instanceof Promise;function Jc(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function JS(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ms,Rs,qt=class{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WS=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new kt(t.common.issues);return this._error=i,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(s,o)=>{var c,l;let{message:p}=t;return s.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:o.defaultError}},description:n}}var Q=class{get description(){return this._def.description}_getType(e){return Pi(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new et,ctx:{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let i=this._parse(e);if(Ls(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){let i=this._parse(e);return Promise.resolve(i)}parse(e,i){let r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){var r;let n={common:{issues:[],async:(r=i?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},a=this._parseSync({data:e,path:n.path,parent:n});return WS(n,a)}"~validate"(e){var i,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:n});return Cr(a)?{value:a.value}:{issues:n.common.issues}}catch(a){!((r=(i=a?.message)===null||i===void 0?void 0:i.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>Cr(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,i){let r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){let r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(Ls(n)?n:Promise.resolve(n));return WS(r,a)}refine(e,i){let r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,a)=>{let s=e(n),o=()=>a.addIssue({code:S.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new Tt({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return It.create(this,this._def)}nullable(){return ui.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ni.create(this)}promise(){return Zi.create(this,this._def)}or(e){return Mr.create([this,e],this._def)}and(e){return Rr.create(this,e,this._def)}transform(e){return new Tt({...V(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let i=typeof e=="function"?e:()=>e;return new Fr({...V(this._def),innerType:this,defaultValue:i,typeName:B.ZodDefault})}brand(){return new Ds({typeName:B.ZodBranded,type:this,...V(this._def)})}catch(e){let i=typeof e=="function"?e:()=>e;return new Ur({...V(this._def),innerType:this,catchValue:i,typeName:B.ZodCatch})}describe(e){let i=this.constructor;return new i({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},v9=/^c[^\s-]{8,}$/i,x9=/^[0-9a-z]+$/,y9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w9=/^[a-z0-9_-]{21}$/i,_9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,k9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jf,T9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,A9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,YS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",O9=new RegExp(`^${YS}$`);function eE(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function I9(t){return new RegExp(`^${eE(t)}$`)}function tE(t){let e=`${YS}T${eE(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function q9(t,e){return!!((e==="v4"||!e)&&T9.test(t)||(e==="v6"||!e)&&C9.test(t))}function M9(t,e){if(!_9.test(t))return!1;try{let[i]=t.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function R9(t,e){return!!((e==="v4"||!e)&&A9.test(t)||(e==="v6"||!e)&&P9.test(t))}var Wi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.string,received:a.parsedType}),F}let r=new et,n;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Jf||(Jf=new RegExp(k9,"u")),Jf.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")b9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")w9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")v9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")x9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")y9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),j(n,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?tE(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?O9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?I9(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?S9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?q9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M9(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?R9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?N9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):ee.assertNever(a);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:S.invalid_string,...L.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var i,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...L.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...L.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...L.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...L.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...L.errToObj(i)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:B.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};function L9(t,e){let i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,a=parseInt(t.toFixed(n).replace(".","")),s=parseInt(e.toFixed(n).replace(".",""));return a%s/Math.pow(10,n)}var Pr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.number,received:a.parsedType}),F}let r,n=new et;for(let a of this._def.checks)a.kind==="int"?ee.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?L9(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_finite,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,i=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Pr.create=t=>new Pr({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...V(t)});var jr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let r,n=new et;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.bigint,received:i.parsedType}),F}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};jr.create=t=>{var e;return new jr({checks:[],typeName:B.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};var Nr=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.boolean,received:r.parsedType}),F}return ct(e.data)}};Nr.create=t=>new Nr({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var Or=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.date,received:a.parsedType}),F}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_date}),F}let r=new et,n;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ee.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(i)})}get minDate(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Or.create=t=>new Or({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...V(t)});var Wn=class extends Q{_parse(e){if(this._getType(e)!==q.symbol){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.symbol,received:r.parsedType}),F}return ct(e.data)}};Wn.create=t=>new Wn({typeName:B.ZodSymbol,...V(t)});var Ir=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.undefined,received:r.parsedType}),F}return ct(e.data)}};Ir.create=t=>new Ir({typeName:B.ZodUndefined,...V(t)});var qr=class extends Q{_parse(e){if(this._getType(e)!==q.null){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.null,received:r.parsedType}),F}return ct(e.data)}};qr.create=t=>new qr({typeName:B.ZodNull,...V(t)});var Ki=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};Ki.create=t=>new Ki({typeName:B.ZodAny,...V(t)});var ji=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};ji.create=t=>new ji({typeName:B.ZodUnknown,...V(t)});var Wt=class extends Q{_parse(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.never,received:i.parsedType}),F}};Wt.create=t=>new Wt({typeName:B.ZodNever,...V(t)});var Kn=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.void,received:r.parsedType}),F}return ct(e.data)}};Kn.create=t=>new Kn({typeName:B.ZodVoid,...V(t)});var Ni=class t extends Q{_parse(e){let{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==q.array)return j(i,{code:S.invalid_type,expected:q.array,received:i.parsedType}),F;if(n.exactLength!==null){let s=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(s||o)&&(j(i,{code:s?S.too_big:S.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(j(i,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dnpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:145
		`;await i.execute(x`CREATE SCHEMA IF NOT EXISTS ${x.identifier(a)}`),await i.execute(s);let c=(await i.all(x`select id, hash, created_at from ${x.identifier(a)}.${x.identifier(n)} order by created_at desc limit 1`))[0];await i.transaction(async l=>{for await(let p of e)if(!c||Number(c.created_at)<p.folderMillis){for(let u of p.sql)await l.execute(x.raw(u));await l.execute(x`insert into ${x.identifier(a)}.${x.identifier(n)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let i=[x`with `];for(let[r,n]of e.entries())i.push(x`${x.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&i.push(x`, `);return i.push(x` `),x.join(i)}buildDeleteQuery({table:e,where:i,returning:r,withList:n}){let a=this.buildWithCTE(n),s=r?x` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=i?x` where ${i}`:void 0;return x`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,i){let r=e[N.Symbol.Columns],n=Object.keys(r).filter(s=>i[s]!==void 0||r[s]?.onUpdateFn!==void 0),a=n.length;return x.join(n.flatMap((s,o)=>{let c=r[s],l=i[s]??x.param(c.onUpdateFn(),c),p=x`${x.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<a-1?[p,x.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:i,where:r,returning:n,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),l=e[We.Symbol.Name],p=e[We.Symbol.Schema],u=e[We.Symbol.OriginalName],d=l===u?void 0:l,f=x`${p?x`${x.identifier(p)}.`:void 0}${x.identifier(u)}${d&&x` ${x.identifier(d)}`}`,m=this.buildUpdateSet(e,i),h=s&&x.join([x.raw(" from "),this.buildFromTable(s)]),y=this.buildJoins(o),b=n?x` returning ${this.buildSelection(n,{isSingleTable:!s})}`:void 0,T=r?x` where ${r}`:void 0;return x`${c}update ${f} set ${m}${h}${y}${T}${b}`}buildSelection(e,{isSingleTable:i=!1}={}){let r=e.length,n=e.flatMap(({field:a},s)=>{let o=[];if(w(a,M.Aliased)&&a.isSelectionField)o.push(x.identifier(a.fieldAlias));else if(w(a,M.Aliased)||w(a,M)){let c=w(a,M.Aliased)?a.sql:a;i?o.push(new M(c.queryChunks.map(l=>w(l,P)?x.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),w(a,M.Aliased)&&o.push(x` as ${x.identifier(a.fieldAlias)}`)}else w(a,ae)&&(i?o.push(x.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<r-1&&o.push(x`, `),o});return x.join(n)}buildJoins(e){if(!e||e.length===0)return;let i=[];for(let[r,n]of e.entries()){r===0&&i.push(x` `);let a=n.table,s=n.lateral?x` lateral`:void 0;if(w(a,We)){let o=a[We.Symbol.Name],c=a[We.Symbol.Schema],l=a[We.Symbol.OriginalName],p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else if(w(a,ot)){let o=a[xe].name,c=a[xe].schema,l=a[xe].originalName,p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else i.push(x`${x.raw(n.joinType)} join${s} ${a} on ${n.on}`);r<e.length-1&&i.push(x` `)}return x.join(i)}buildFromTable(e){if(w(e,N)&&e[N.Symbol.OriginalName]!==e[N.Symbol.Name]){let i=x`${x.identifier(e[N.Symbol.OriginalName])}`;return e[N.Symbol.Schema]&&(i=x`${x.identifier(e[N.Symbol.Schema])}.${i}`),x`${i} ${x.identifier(e[N.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:i,fieldsFlat:r,where:n,having:a,table:s,joins:o,orderBy:c,groupBy:l,limit:p,offset:u,lockingClause:d,distinct:f,setOperators:m}){let h=r??Nt(i);for(let te of h)if(w(te.field,ae)&&vt(te.field.table)!==(w(s,Le)?s._.alias:w(s,Fn)?s[xe].name:w(s,M)?void 0:vt(s))&&!(ie=>o?.some(({alias:Y})=>Y===(ie[N.Symbol.IsAlias]?vt(ie):ie[N.Symbol.BaseName])))(te.field.table)){let ie=vt(te.field.table);throw new Error(`Your "${te.path.join("->")}" field references a column "${ie}"."${te.field.name}", but the table "${ie}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,b=this.buildWithCTE(e),T;f&&(T=f===!0?x` distinct`:x` distinct on (${x.join(f.on,x`, `)})`);let _=this.buildSelection(h,{isSingleTable:y}),A=this.buildFromTable(s),O=this.buildJoins(o),E=n?x` where ${n}`:void 0,C=a?x` having ${a}`:void 0,I;c&&c.length>0&&(I=x` order by ${x.join(c,x`, `)}`);let z;l&&l.length>0&&(z=x` group by ${x.join(l,x`, `)}`);let me=typeof p=="object"||typeof p=="number"&&p>=0?x` limit ${p}`:void 0,Ee=u?x` offset ${u}`:void 0,ye=x.empty();if(d){let te=x` for ${x.raw(d.strength)}`;d.config.of&&te.append(x` of ${x.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],x`, `)}`),d.config.noWait?te.append(x` no wait`):d.config.skipLocked&&te.append(x` skip locked`),ye.append(te)}let G=x`${b}select${T} ${_} from ${A}${O}${E}${z}${C}${I}${me}${Ee}${ye}`;return m.length>0?this.buildSetOperations(G,m):G}buildSetOperations(e,i){let[r,...n]=i;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:i,isAll:r,rightSelect:n,limit:a,orderBy:s,offset:o}}){let c=x`(${e.getSQL()}) `,l=x`(${n.getSQL()})`,p;if(s&&s.length>0){let m=[];for(let h of s)if(w(h,P))m.push(x.identifier(h.name));else if(w(h,M)){for(let y=0;y<h.queryChunks.length;y++){let b=h.queryChunks[y];w(b,P)&&(h.queryChunks[y]=x.identifier(b.name))}m.push(x`${h}`)}else m.push(x`${h}`);p=x` order by ${x.join(m,x`, `)} `}let u=typeof a=="object"||typeof a=="number"&&a>=0?x` limit ${a}`:void 0,d=x.raw(`${i} ${r?"all ":""}`),f=o?x` offset ${o}`:void 0;return x`${c}${d}${l}${p}${u}${f}`}buildInsertQuery({table:e,values:i,onConflict:r,returning:n,withList:a,select:s,overridingSystemValue_:o}){let c=[],l=e[N.Symbol.Columns],p=Object.entries(l).filter(([b,T])=>!T.shouldDisableInsert()),u=p.map(([,b])=>x.identifier(this.casing.getColumnCasing(b)));if(s){let b=i;w(b,M)?c.push(b):c.push(b.getSQL())}else{let b=i;c.push(x.raw("values "));for(let[T,_]of b.entries()){let A=[];for(let[O,E]of p){let C=_[O];if(C===void 0||w(C,xt)&&C.value===void 0)if(E.defaultFn!==void 0){let I=E.defaultFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else if(!E.default&&E.onUpdateFn!==void 0){let I=E.onUpdateFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else A.push(x`default`);else A.push(C)}c.push(A),T<b.length-1&&c.push(x`, `)}}let d=this.buildWithCTE(a),f=x.join(c),m=n?x` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,h=r?x` on conflict ${r}`:void 0,y=o===!0?x`overriding system value `:void 0;return x`${d}insert into ${e} ${u} ${y}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:i,withNoData:r}){let n=i?x` concurrently`:void 0,a=r?x` with no data`:void 0;return x`refresh materialized view${n} ${e}${a}`}prepareTyping(e){return w(e,ks)||w(e,Es)?"json":w(e,Ts)?"decimal":w(e,As)?"time":w(e,Cs)||w(e,Ps)?"timestamp":w(e,_s)||w(e,Ss)?"date":w(e,js)?"uuid":"none"}sqlToQuery(e,i){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:i})}buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:n,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let p=[],u,d,f=[],m,h=[];if(s===!0)p=Object.entries(a.columns).map(([T,_])=>({dbKey:_.name,tsKey:T,field:ci(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([C,I])=>[C,ci(I,o)]));if(s.where){let C=typeof s.where=="function"?s.where(b,$S()):s.where;m=C&&xs(C,o)}let T=[],_=[];if(s.columns){let C=!1;for(let[I,z]of Object.entries(s.columns))z!==void 0&&I in a.columns&&(!C&&z===!0&&(C=!0),_.push(I));_.length>0&&(_=C?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let C of _){let I=a.columns[C];T.push({tsKey:C,value:I})}let A=[];s.with&&(A=Object.entries(s.with).filter(C=>!!C[1]).map(([C,I])=>({tsKey:C,queryConfig:I,relation:a.relations[C]})));let O;if(s.extras){O=typeof s.extras=="function"?s.extras(b,{sql:x}):s.extras;for(let[C,I]of Object.entries(O))T.push({tsKey:C,value:Cd(I,o)})}for(let{tsKey:C,value:I}of T)p.push({dbKey:w(I,M.Aliased)?I.fieldAlias:a.columns[C].name,tsKey:C,field:w(I,ae)?ci(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof s.orderBy=="function"?s.orderBy(b,HS()):s.orderBy??[];Array.isArray(E)||(E=[E]),f=E.map(C=>w(C,ae)?ci(C,o):xs(C,o)),u=s.limit,d=s.offset;for(let{tsKey:C,queryConfig:I,relation:z}of A){let me=QS(i,r,z),Ee=kr(z.referencedTable),ye=r[Ee],G=`${o}_${C}`,te=bs(...me.fields.map((H,Pe)=>Se(ci(me.references[Pe],G),ci(H,o)))),ie=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:e[ye],tableConfig:i[ye],queryConfig:w(z,Qi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:G,joinOn:te,nestedQueryRelation:z}),Y=x`${x.identifier(G)}.${x.identifier("data")}`.as(C);h.push({on:x`true`,table:new Le(ie.sql,{},G),alias:G,joinType:"left",lateral:!0}),p.push({dbKey:C,tsKey:C,field:Y,relationTableTsKey:ye,isJson:!0,selection:ie.selection})}}if(p.length===0)throw new ys({message:`No fields selected for table "${a.tsName}" ("${o}")`});let y;if(m=bs(l,m),c){let b=x`json_build_array(${x.join(p.map(({field:A,tsKey:O,isJson:E})=>E?x`${x.identifier(`${o}_${O}`)}.${x.identifier("data")}`:w(A,M.Aliased)?A.sql:A),x`, `)})`;w(c,Ns)&&(b=x`coalesce(json_agg(${b}${f.length>0?x` order by ${x.join(f,x`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:p}];u!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:[{path:[],field:x.raw("*")}],where:m,limit:u,offset:d,orderBy:f,setOperators:[]}),m=void 0,u=void 0,d=void 0,f=[]):y=vs(n,o),y=this.buildSelectQuery({table:w(y,We)?y:new Le(y,{},o),fields:{},fieldsFlat:T.map(({field:A})=>({path:[],field:w(A,ae)?ci(A,o):A})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:p.map(({field:b})=>({path:[],field:w(b,ae)?ci(b,o):b})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:y,selection:p}}};var Bc=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var Ye=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let i=!!this.fields,r=e,n;return this.fields?n=this.fields:w(r,Le)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(a=>[a,r[a]])):w(r,Fn)?n=r[xe].selectedFields:w(r,M)?n={}:n=qc(r),new zc({table:r,fields:n,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Zf=class extends Bc{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:i,isPartialSelect:r,session:n,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...i},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=a,this._={selectedFields:i},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(i,r)=>{let n=this.tableName,a=ki(i);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof a=="string"&&!w(i,M))){let s=w(i,Le)?i._.selectedFields:w(i,ot)?i[xe].selectedFields:i[N.Symbol.Columns];this.config.fields[a]=s}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:i,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,i){return r=>{let n=typeof r=="function"?r(o9()):r;if(!ws(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:i,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(i)?i:[i]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(i)?i:[i];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let i=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,i={}){return this.config.lockingClause={strength:e,config:i},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}as(e){return new Proxy(new Le(this.getSQL(),this.config.fields,e),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Oe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},zc=class extends Zf{static[v]="PgSelect";_prepare(e){let{session:i,config:r,dialect:n,joinsNotNullableMap:a,authToken:s}=this;if(!i)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ve.startActiveSpan("drizzle.prepareQuery",()=>{let o=Nt(r.fields),c=i.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(zc,[Je]);function Un(t,e){return(i,r,...n)=>{let a=[r,...n].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!ws(i.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(a)}}var o9=()=>({union:c9,unionAll:l9,intersect:p9,intersectAll:u9,except:d9,exceptAll:f9}),c9=Un("union",!1),l9=Un("union",!0),p9=Un("intersect",!1),u9=Un("intersect",!0),d9=Un("except",!1),f9=Un("except",!0);var $n=class{static[v]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=w(e,Gi)?e:void 0,this.dialectConfig=w(e,Gi)?void 0:e}$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(r)),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let i=this;function r(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),withList:e})}function n(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),distinct:!0})}function a(s,o){return new Ye({fields:o??void 0,session:void 0,dialect:i.getDialect(),distinct:{on:s}})}return{select:r,selectDistinct:n,selectDistinctOn:a}}select(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Gi(this.dialectConfig)),this.dialect}};var Is=class{constructor(e,i,r,n,a){this.table=e,this.session=i,this.dialect=r,this.withList=n,this.overridingSystemValue_=a}static[v]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let i=e.map(r=>{let n={},a=this.table[N.Symbol.Columns];for(let s of Object.keys(r)){let o=r[s];n[s]=w(o,M)?o:new xt(o,a[s])}return n});return new Fc(this.table,i,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let i=typeof e=="function"?e(new $n):e;if(!w(i,M)&&!ws(this.table[Pc],i._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Fc(this.table,i,this.session,this.dialect,this.withList,!0)}},Fc=class extends Je{constructor(e,i,r,n,a,s,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:i,withList:a,select:s,overridingSystemValue_:o}}static[v]="PgInsert";config;returning(e=this.config.table[N.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Nt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=x`do nothing`;else{let i="";i=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?x` where ${e.where}`:void 0;this.config.onConflict=x`(${x.raw(i)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let i=e.where?x` where ${e.where}`:void 0,r=e.targetWhere?x` where ${e.targetWhere}`:void 0,n=e.setWhere?x` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ic(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=x`(${x.raw(s)})${r} do update set ${a}${i}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Uc=class extends Je{constructor(e,i,r){super(),this.session=i,this.dialect=r,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var qs=class{constructor(e,i,r,n){this.table=e,this.session=i,this.dialect=r,this.withList=n}static[v]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Xf(this.table,Ic(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Xf=class extends Je{constructor(e,i,r,n,a){super(),this.session=r,this.dialect=n,this.config={set:i,table:e,withList:a,joins:[]},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[v]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let i=e,r=ki(i);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=i,this}getTableLikeFields(e){return w(e,We)?e[N.Symbol.Columns]:w(e,Le)?e._.selectedFields:e[xe].selectedFields}createJoin(e){return(i,r)=>{let n=ki(i);if(typeof n=="string"&&this.config.joins.some(a=>a.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let a=this.config.from&&!w(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[N.Symbol.Columns],new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:i,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[N.Symbol.Columns]),this.config.from)){let i=ki(this.config.from);if(typeof i=="string"&&this.config.from&&!w(this.config.from,M)){let r=this.getTableLikeFields(this.config.from);e[i]=r}for(let r of this.config.joins){let n=ki(r.table);if(typeof n=="string"&&!w(r.table,M)){let a=this.getTableLikeFields(r.table);e[n]=a}}}return this.config.returningFields=e,this.config.returning=Nt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){let i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var $c=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[v]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,i){return x`(select count(*) from ${e}${x.raw(" where ").if(i)}${i})`}static buildCount(e,i){return x`select count(*) as count from ${e}${x.raw(" where ").if(i)}${i};`}setToken(e){return this.token=e,this}then(e,i){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,i)}catch(e){return this.then(void 0,e)}finally(e){return this.then(i=>(e?.(),i),i=>{throw e?.(),i})}};var Hc=class{constructor(e,i,r,n,a,s,o){this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vc=class extends Je{constructor(e,i,r,n,a,s,o,c,l){super(),this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[v]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:i,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,a)=>{let s=n.map(o=>Lc(this.schema,this.tableConfig,o,i.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),i=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:i}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Qc=class extends Je{constructor(e,i,r,n){super(),this.execute=e,this.sql=i,this.query=r,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,i){return i?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Hn=class{constructor(e,i,r){if(this.dialect=e,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:i}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:i},this.query={},this._.schema)for(let[n,a]of Object.entries(this._.schema))this.query[n]=new Hc(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],a,e,i)}static[v]="PgDatabase";query;$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(new $n(r.dialect))),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,i){return new $c({source:e,filters:i,session:this.session})}with(...e){let i=this;function r(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e})}function n(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:!0})}function a(l,p){return new Ye({fields:p??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:{on:l}})}function s(l){return new qs(l,i.session,i.dialect,e)}function o(l){return new Is(l,i.session,i.dialect,e)}function c(l){return new Os(l,i.session,i.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new qs(e,this.session,this.dialect)}insert(e){return new Is(e,this.session,this.dialect)}delete(e){return new Os(e,this.session,this.dialect)}refreshMaterializedView(e){return new Uc(e,this.session,this.dialect)}authToken;execute(e){let i=typeof e=="string"?x.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(i),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Qc(()=>n.execute(void 0,this.authToken),i,r,a=>n.mapResult(a,!0))}transaction(e,i){return this.session.transaction(e,i)}};var Gc=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,i){return e}setToken(e){return this.authToken=e,this}static[v]="PgPreparedQuery";joinsNotNullableMap},Wc=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e,i){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(i).execute(void 0,i))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,i){let r=await this.execute(e,i);return Number(r[0].count)}},Kc=class extends Hn{constructor(e,i,r,n=0){super(e,i,r),this.schema=r,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new jc}getTransactionConfigSQL(e){let i=[];return e.isolationLevel&&i.push(`isolation level ${e.isolationLevel}`),e.accessMode&&i.push(e.accessMode),typeof e.deferrable=="boolean"&&i.push(e.deferrable?"deferrable":"not deferrable"),x.raw(i.join(" "))}setTransaction(e){return this.session.execute(x`set transaction ${this.getTransactionConfigSQL(e)}`)}};var ee;(function(t){t.assertEqual=n=>n;function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{let a={};for(let s of n)a[s]=s;return a},t.getValidEnumValues=n=>{let a=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(let o of a)s[o]=n[o];return t.objectValues(s)},t.objectValues=n=>t.objectKeys(n).map(function(a){return n[a]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let a=[];for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&a.push(s);return a},t.find=(n,a)=>{for(let s of n)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,a=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(ee||(ee={}));var Yf;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(Yf||(Yf={}));var q=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pi=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},S=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),kt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){let i=e||function(a){return a.message},r={_errors:[]},n=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(i(s));else{let o=r,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(i(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){let i={},r=[];for(let n of this.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}};kt.create=t=>new kt(t);var Gn=(t,e)=>{let i;switch(t.code){case S.invalid_type:t.received===q.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:i=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case S.invalid_union:i="Invalid input";break;case S.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case S.invalid_enum_value:i=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:i="Invalid function arguments";break;case S.invalid_return_type:i="Invalid function return type";break;case S.invalid_date:i="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case S.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case S.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case S.custom:i="Invalid input";break;case S.invalid_intersection_types:i="Intersection results could not be merged";break;case S.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:i="Number must be finite";break;default:i=e.defaultError,ee.assertNever(t)}return{message:i}},XS=Gn;function h9(t){XS=t}function Zc(){return XS}var Xc=t=>{let{data:e,path:i,errorMaps:r,issueData:n}=t,a=[...i,...n.path||[]],s={...n,path:a};if(n.message!==void 0)return{...n,path:a,message:n.message};let o="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)o=l(s,{data:e,defaultError:o}).message;return{...n,path:a,message:o}},g9=[];function j(t,e){let i=Zc(),r=Xc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Gn?void 0:Gn].filter(n=>!!n)});t.common.issues.push(r)}var et=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){let r=[];for(let n of i){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){let r=[];for(let n of i){let a=await n.key,s=await n.value;r.push({key:a,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,i){let r={};for(let n of i){let{key:a,value:s}=n;if(a.status==="aborted"||s.status==="aborted")return F;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}},F=Object.freeze({status:"aborted"}),Qn=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),em=t=>t.status==="aborted",tm=t=>t.status==="dirty",Cr=t=>t.status==="valid",Ls=t=>typeof Promise<"u"&&t instanceof Promise;function Jc(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function JS(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ms,Rs,qt=class{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WS=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new kt(t.common.issues);return this._error=i,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(s,o)=>{var c,l;let{message:p}=t;return s.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:o.defaultError}},description:n}}var Q=class{get description(){return this._def.description}_getType(e){return Pi(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new et,ctx:{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let i=this._parse(e);if(Ls(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){let i=this._parse(e);return Promise.resolve(i)}parse(e,i){let r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){var r;let n={common:{issues:[],async:(r=i?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},a=this._parseSync({data:e,path:n.path,parent:n});return WS(n,a)}"~validate"(e){var i,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:n});return Cr(a)?{value:a.value}:{issues:n.common.issues}}catch(a){!((r=(i=a?.message)===null||i===void 0?void 0:i.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>Cr(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,i){let r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){let r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(Ls(n)?n:Promise.resolve(n));return WS(r,a)}refine(e,i){let r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,a)=>{let s=e(n),o=()=>a.addIssue({code:S.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new Tt({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return It.create(this,this._def)}nullable(){return ui.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ni.create(this)}promise(){return Zi.create(this,this._def)}or(e){return Mr.create([this,e],this._def)}and(e){return Rr.create(this,e,this._def)}transform(e){return new Tt({...V(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let i=typeof e=="function"?e:()=>e;return new Fr({...V(this._def),innerType:this,defaultValue:i,typeName:B.ZodDefault})}brand(){return new Ds({typeName:B.ZodBranded,type:this,...V(this._def)})}catch(e){let i=typeof e=="function"?e:()=>e;return new Ur({...V(this._def),innerType:this,catchValue:i,typeName:B.ZodCatch})}describe(e){let i=this.constructor;return new i({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},v9=/^c[^\s-]{8,}$/i,x9=/^[0-9a-z]+$/,y9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w9=/^[a-z0-9_-]{21}$/i,_9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,k9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jf,T9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,A9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,YS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",O9=new RegExp(`^${YS}$`);function eE(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function I9(t){return new RegExp(`^${eE(t)}$`)}function tE(t){let e=`${YS}T${eE(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function q9(t,e){return!!((e==="v4"||!e)&&T9.test(t)||(e==="v6"||!e)&&C9.test(t))}function M9(t,e){if(!_9.test(t))return!1;try{let[i]=t.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function R9(t,e){return!!((e==="v4"||!e)&&A9.test(t)||(e==="v6"||!e)&&P9.test(t))}var Wi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.string,received:a.parsedType}),F}let r=new et,n;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Jf||(Jf=new RegExp(k9,"u")),Jf.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")b9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")w9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")v9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")x9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")y9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),j(n,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?tE(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?O9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?I9(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?S9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?q9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M9(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?R9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?N9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):ee.assertNever(a);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:S.invalid_string,...L.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var i,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...L.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...L.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...L.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...L.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...L.errToObj(i)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:B.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};function L9(t,e){let i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,a=parseInt(t.toFixed(n).replace(".","")),s=parseInt(e.toFixed(n).replace(".",""));return a%s/Math.pow(10,n)}var Pr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.number,received:a.parsedType}),F}let r,n=new et;for(let a of this._def.checks)a.kind==="int"?ee.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?L9(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_finite,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,i=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Pr.create=t=>new Pr({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...V(t)});var jr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let r,n=new et;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.bigint,received:i.parsedType}),F}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};jr.create=t=>{var e;return new jr({checks:[],typeName:B.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};var Nr=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.boolean,received:r.parsedType}),F}return ct(e.data)}};Nr.create=t=>new Nr({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var Or=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.date,received:a.parsedType}),F}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_date}),F}let r=new et,n;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ee.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(i)})}get minDate(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Or.create=t=>new Or({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...V(t)});var Wn=class extends Q{_parse(e){if(this._getType(e)!==q.symbol){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.symbol,received:r.parsedType}),F}return ct(e.data)}};Wn.create=t=>new Wn({typeName:B.ZodSymbol,...V(t)});var Ir=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.undefined,received:r.parsedType}),F}return ct(e.data)}};Ir.create=t=>new Ir({typeName:B.ZodUndefined,...V(t)});var qr=class extends Q{_parse(e){if(this._getType(e)!==q.null){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.null,received:r.parsedType}),F}return ct(e.data)}};qr.create=t=>new qr({typeName:B.ZodNull,...V(t)});var Ki=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};Ki.create=t=>new Ki({typeName:B.ZodAny,...V(t)});var ji=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};ji.create=t=>new ji({typeName:B.ZodUnknown,...V(t)});var Wt=class extends Q{_parse(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.never,received:i.parsedType}),F}};Wt.create=t=>new Wt({typeName:B.ZodNever,...V(t)});var Kn=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.void,received:r.parsedType}),F}return ct(e.data)}};Kn.create=t=>new Kn({typeName:B.ZodVoid,...V(t)});var Ni=class t extends Q{_parse(e){let{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==q.array)return j(i,{code:S.invalid_type,expected:q.array,received:i.parsedType}),F;if(n.exactLength!==null){let s=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(s||o)&&(j(i,{code:s?S.too_big:S.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(j(i,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dnpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:145
		`;await i.execute(x`CREATE SCHEMA IF NOT EXISTS ${x.identifier(a)}`),await i.execute(s);let c=(await i.all(x`select id, hash, created_at from ${x.identifier(a)}.${x.identifier(n)} order by created_at desc limit 1`))[0];await i.transaction(async l=>{for await(let p of e)if(!c||Number(c.created_at)<p.folderMillis){for(let u of p.sql)await l.execute(x.raw(u));await l.execute(x`insert into ${x.identifier(a)}.${x.identifier(n)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let i=[x`with `];for(let[r,n]of e.entries())i.push(x`${x.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&i.push(x`, `);return i.push(x` `),x.join(i)}buildDeleteQuery({table:e,where:i,returning:r,withList:n}){let a=this.buildWithCTE(n),s=r?x` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=i?x` where ${i}`:void 0;return x`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,i){let r=e[N.Symbol.Columns],n=Object.keys(r).filter(s=>i[s]!==void 0||r[s]?.onUpdateFn!==void 0),a=n.length;return x.join(n.flatMap((s,o)=>{let c=r[s],l=i[s]??x.param(c.onUpdateFn(),c),p=x`${x.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<a-1?[p,x.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:i,where:r,returning:n,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),l=e[We.Symbol.Name],p=e[We.Symbol.Schema],u=e[We.Symbol.OriginalName],d=l===u?void 0:l,f=x`${p?x`${x.identifier(p)}.`:void 0}${x.identifier(u)}${d&&x` ${x.identifier(d)}`}`,m=this.buildUpdateSet(e,i),h=s&&x.join([x.raw(" from "),this.buildFromTable(s)]),y=this.buildJoins(o),b=n?x` returning ${this.buildSelection(n,{isSingleTable:!s})}`:void 0,T=r?x` where ${r}`:void 0;return x`${c}update ${f} set ${m}${h}${y}${T}${b}`}buildSelection(e,{isSingleTable:i=!1}={}){let r=e.length,n=e.flatMap(({field:a},s)=>{let o=[];if(w(a,M.Aliased)&&a.isSelectionField)o.push(x.identifier(a.fieldAlias));else if(w(a,M.Aliased)||w(a,M)){let c=w(a,M.Aliased)?a.sql:a;i?o.push(new M(c.queryChunks.map(l=>w(l,P)?x.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),w(a,M.Aliased)&&o.push(x` as ${x.identifier(a.fieldAlias)}`)}else w(a,ae)&&(i?o.push(x.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<r-1&&o.push(x`, `),o});return x.join(n)}buildJoins(e){if(!e||e.length===0)return;let i=[];for(let[r,n]of e.entries()){r===0&&i.push(x` `);let a=n.table,s=n.lateral?x` lateral`:void 0;if(w(a,We)){let o=a[We.Symbol.Name],c=a[We.Symbol.Schema],l=a[We.Symbol.OriginalName],p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else if(w(a,ot)){let o=a[xe].name,c=a[xe].schema,l=a[xe].originalName,p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else i.push(x`${x.raw(n.joinType)} join${s} ${a} on ${n.on}`);r<e.length-1&&i.push(x` `)}return x.join(i)}buildFromTable(e){if(w(e,N)&&e[N.Symbol.OriginalName]!==e[N.Symbol.Name]){let i=x`${x.identifier(e[N.Symbol.OriginalName])}`;return e[N.Symbol.Schema]&&(i=x`${x.identifier(e[N.Symbol.Schema])}.${i}`),x`${i} ${x.identifier(e[N.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:i,fieldsFlat:r,where:n,having:a,table:s,joins:o,orderBy:c,groupBy:l,limit:p,offset:u,lockingClause:d,distinct:f,setOperators:m}){let h=r??Nt(i);for(let te of h)if(w(te.field,ae)&&vt(te.field.table)!==(w(s,Le)?s._.alias:w(s,Fn)?s[xe].name:w(s,M)?void 0:vt(s))&&!(ie=>o?.some(({alias:Y})=>Y===(ie[N.Symbol.IsAlias]?vt(ie):ie[N.Symbol.BaseName])))(te.field.table)){let ie=vt(te.field.table);throw new Error(`Your "${te.path.join("->")}" field references a column "${ie}"."${te.field.name}", but the table "${ie}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,b=this.buildWithCTE(e),T;f&&(T=f===!0?x` distinct`:x` distinct on (${x.join(f.on,x`, `)})`);let _=this.buildSelection(h,{isSingleTable:y}),A=this.buildFromTable(s),O=this.buildJoins(o),E=n?x` where ${n}`:void 0,C=a?x` having ${a}`:void 0,I;c&&c.length>0&&(I=x` order by ${x.join(c,x`, `)}`);let z;l&&l.length>0&&(z=x` group by ${x.join(l,x`, `)}`);let me=typeof p=="object"||typeof p=="number"&&p>=0?x` limit ${p}`:void 0,Ee=u?x` offset ${u}`:void 0,ye=x.empty();if(d){let te=x` for ${x.raw(d.strength)}`;d.config.of&&te.append(x` of ${x.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],x`, `)}`),d.config.noWait?te.append(x` no wait`):d.config.skipLocked&&te.append(x` skip locked`),ye.append(te)}let G=x`${b}select${T} ${_} from ${A}${O}${E}${z}${C}${I}${me}${Ee}${ye}`;return m.length>0?this.buildSetOperations(G,m):G}buildSetOperations(e,i){let[r,...n]=i;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:i,isAll:r,rightSelect:n,limit:a,orderBy:s,offset:o}}){let c=x`(${e.getSQL()}) `,l=x`(${n.getSQL()})`,p;if(s&&s.length>0){let m=[];for(let h of s)if(w(h,P))m.push(x.identifier(h.name));else if(w(h,M)){for(let y=0;y<h.queryChunks.length;y++){let b=h.queryChunks[y];w(b,P)&&(h.queryChunks[y]=x.identifier(b.name))}m.push(x`${h}`)}else m.push(x`${h}`);p=x` order by ${x.join(m,x`, `)} `}let u=typeof a=="object"||typeof a=="number"&&a>=0?x` limit ${a}`:void 0,d=x.raw(`${i} ${r?"all ":""}`),f=o?x` offset ${o}`:void 0;return x`${c}${d}${l}${p}${u}${f}`}buildInsertQuery({table:e,values:i,onConflict:r,returning:n,withList:a,select:s,overridingSystemValue_:o}){let c=[],l=e[N.Symbol.Columns],p=Object.entries(l).filter(([b,T])=>!T.shouldDisableInsert()),u=p.map(([,b])=>x.identifier(this.casing.getColumnCasing(b)));if(s){let b=i;w(b,M)?c.push(b):c.push(b.getSQL())}else{let b=i;c.push(x.raw("values "));for(let[T,_]of b.entries()){let A=[];for(let[O,E]of p){let C=_[O];if(C===void 0||w(C,xt)&&C.value===void 0)if(E.defaultFn!==void 0){let I=E.defaultFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else if(!E.default&&E.onUpdateFn!==void 0){let I=E.onUpdateFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else A.push(x`default`);else A.push(C)}c.push(A),T<b.length-1&&c.push(x`, `)}}let d=this.buildWithCTE(a),f=x.join(c),m=n?x` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,h=r?x` on conflict ${r}`:void 0,y=o===!0?x`overriding system value `:void 0;return x`${d}insert into ${e} ${u} ${y}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:i,withNoData:r}){let n=i?x` concurrently`:void 0,a=r?x` with no data`:void 0;return x`refresh materialized view${n} ${e}${a}`}prepareTyping(e){return w(e,ks)||w(e,Es)?"json":w(e,Ts)?"decimal":w(e,As)?"time":w(e,Cs)||w(e,Ps)?"timestamp":w(e,_s)||w(e,Ss)?"date":w(e,js)?"uuid":"none"}sqlToQuery(e,i){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:i})}buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:n,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let p=[],u,d,f=[],m,h=[];if(s===!0)p=Object.entries(a.columns).map(([T,_])=>({dbKey:_.name,tsKey:T,field:ci(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([C,I])=>[C,ci(I,o)]));if(s.where){let C=typeof s.where=="function"?s.where(b,$S()):s.where;m=C&&xs(C,o)}let T=[],_=[];if(s.columns){let C=!1;for(let[I,z]of Object.entries(s.columns))z!==void 0&&I in a.columns&&(!C&&z===!0&&(C=!0),_.push(I));_.length>0&&(_=C?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let C of _){let I=a.columns[C];T.push({tsKey:C,value:I})}let A=[];s.with&&(A=Object.entries(s.with).filter(C=>!!C[1]).map(([C,I])=>({tsKey:C,queryConfig:I,relation:a.relations[C]})));let O;if(s.extras){O=typeof s.extras=="function"?s.extras(b,{sql:x}):s.extras;for(let[C,I]of Object.entries(O))T.push({tsKey:C,value:Cd(I,o)})}for(let{tsKey:C,value:I}of T)p.push({dbKey:w(I,M.Aliased)?I.fieldAlias:a.columns[C].name,tsKey:C,field:w(I,ae)?ci(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof s.orderBy=="function"?s.orderBy(b,HS()):s.orderBy??[];Array.isArray(E)||(E=[E]),f=E.map(C=>w(C,ae)?ci(C,o):xs(C,o)),u=s.limit,d=s.offset;for(let{tsKey:C,queryConfig:I,relation:z}of A){let me=QS(i,r,z),Ee=kr(z.referencedTable),ye=r[Ee],G=`${o}_${C}`,te=bs(...me.fields.map((H,Pe)=>Se(ci(me.references[Pe],G),ci(H,o)))),ie=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:e[ye],tableConfig:i[ye],queryConfig:w(z,Qi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:G,joinOn:te,nestedQueryRelation:z}),Y=x`${x.identifier(G)}.${x.identifier("data")}`.as(C);h.push({on:x`true`,table:new Le(ie.sql,{},G),alias:G,joinType:"left",lateral:!0}),p.push({dbKey:C,tsKey:C,field:Y,relationTableTsKey:ye,isJson:!0,selection:ie.selection})}}if(p.length===0)throw new ys({message:`No fields selected for table "${a.tsName}" ("${o}")`});let y;if(m=bs(l,m),c){let b=x`json_build_array(${x.join(p.map(({field:A,tsKey:O,isJson:E})=>E?x`${x.identifier(`${o}_${O}`)}.${x.identifier("data")}`:w(A,M.Aliased)?A.sql:A),x`, `)})`;w(c,Ns)&&(b=x`coalesce(json_agg(${b}${f.length>0?x` order by ${x.join(f,x`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:p}];u!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:[{path:[],field:x.raw("*")}],where:m,limit:u,offset:d,orderBy:f,setOperators:[]}),m=void 0,u=void 0,d=void 0,f=[]):y=vs(n,o),y=this.buildSelectQuery({table:w(y,We)?y:new Le(y,{},o),fields:{},fieldsFlat:T.map(({field:A})=>({path:[],field:w(A,ae)?ci(A,o):A})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:p.map(({field:b})=>({path:[],field:w(b,ae)?ci(b,o):b})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:y,selection:p}}};var Bc=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var Ye=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let i=!!this.fields,r=e,n;return this.fields?n=this.fields:w(r,Le)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(a=>[a,r[a]])):w(r,Fn)?n=r[xe].selectedFields:w(r,M)?n={}:n=qc(r),new zc({table:r,fields:n,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Zf=class extends Bc{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:i,isPartialSelect:r,session:n,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...i},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=a,this._={selectedFields:i},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(i,r)=>{let n=this.tableName,a=ki(i);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof a=="string"&&!w(i,M))){let s=w(i,Le)?i._.selectedFields:w(i,ot)?i[xe].selectedFields:i[N.Symbol.Columns];this.config.fields[a]=s}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:i,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,i){return r=>{let n=typeof r=="function"?r(o9()):r;if(!ws(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:i,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(i)?i:[i]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(i)?i:[i];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let i=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,i={}){return this.config.lockingClause={strength:e,config:i},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}as(e){return new Proxy(new Le(this.getSQL(),this.config.fields,e),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Oe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},zc=class extends Zf{static[v]="PgSelect";_prepare(e){let{session:i,config:r,dialect:n,joinsNotNullableMap:a,authToken:s}=this;if(!i)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ve.startActiveSpan("drizzle.prepareQuery",()=>{let o=Nt(r.fields),c=i.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(zc,[Je]);function Un(t,e){return(i,r,...n)=>{let a=[r,...n].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!ws(i.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(a)}}var o9=()=>({union:c9,unionAll:l9,intersect:p9,intersectAll:u9,except:d9,exceptAll:f9}),c9=Un("union",!1),l9=Un("union",!0),p9=Un("intersect",!1),u9=Un("intersect",!0),d9=Un("except",!1),f9=Un("except",!0);var $n=class{static[v]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=w(e,Gi)?e:void 0,this.dialectConfig=w(e,Gi)?void 0:e}$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(r)),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let i=this;function r(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),withList:e})}function n(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),distinct:!0})}function a(s,o){return new Ye({fields:o??void 0,session:void 0,dialect:i.getDialect(),distinct:{on:s}})}return{select:r,selectDistinct:n,selectDistinctOn:a}}select(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Gi(this.dialectConfig)),this.dialect}};var Is=class{constructor(e,i,r,n,a){this.table=e,this.session=i,this.dialect=r,this.withList=n,this.overridingSystemValue_=a}static[v]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let i=e.map(r=>{let n={},a=this.table[N.Symbol.Columns];for(let s of Object.keys(r)){let o=r[s];n[s]=w(o,M)?o:new xt(o,a[s])}return n});return new Fc(this.table,i,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let i=typeof e=="function"?e(new $n):e;if(!w(i,M)&&!ws(this.table[Pc],i._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Fc(this.table,i,this.session,this.dialect,this.withList,!0)}},Fc=class extends Je{constructor(e,i,r,n,a,s,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:i,withList:a,select:s,overridingSystemValue_:o}}static[v]="PgInsert";config;returning(e=this.config.table[N.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Nt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=x`do nothing`;else{let i="";i=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?x` where ${e.where}`:void 0;this.config.onConflict=x`(${x.raw(i)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let i=e.where?x` where ${e.where}`:void 0,r=e.targetWhere?x` where ${e.targetWhere}`:void 0,n=e.setWhere?x` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ic(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=x`(${x.raw(s)})${r} do update set ${a}${i}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Uc=class extends Je{constructor(e,i,r){super(),this.session=i,this.dialect=r,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var qs=class{constructor(e,i,r,n){this.table=e,this.session=i,this.dialect=r,this.withList=n}static[v]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Xf(this.table,Ic(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Xf=class extends Je{constructor(e,i,r,n,a){super(),this.session=r,this.dialect=n,this.config={set:i,table:e,withList:a,joins:[]},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[v]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let i=e,r=ki(i);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=i,this}getTableLikeFields(e){return w(e,We)?e[N.Symbol.Columns]:w(e,Le)?e._.selectedFields:e[xe].selectedFields}createJoin(e){return(i,r)=>{let n=ki(i);if(typeof n=="string"&&this.config.joins.some(a=>a.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let a=this.config.from&&!w(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[N.Symbol.Columns],new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:i,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[N.Symbol.Columns]),this.config.from)){let i=ki(this.config.from);if(typeof i=="string"&&this.config.from&&!w(this.config.from,M)){let r=this.getTableLikeFields(this.config.from);e[i]=r}for(let r of this.config.joins){let n=ki(r.table);if(typeof n=="string"&&!w(r.table,M)){let a=this.getTableLikeFields(r.table);e[n]=a}}}return this.config.returningFields=e,this.config.returning=Nt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){let i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var $c=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[v]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,i){return x`(select count(*) from ${e}${x.raw(" where ").if(i)}${i})`}static buildCount(e,i){return x`select count(*) as count from ${e}${x.raw(" where ").if(i)}${i};`}setToken(e){return this.token=e,this}then(e,i){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,i)}catch(e){return this.then(void 0,e)}finally(e){return this.then(i=>(e?.(),i),i=>{throw e?.(),i})}};var Hc=class{constructor(e,i,r,n,a,s,o){this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vc=class extends Je{constructor(e,i,r,n,a,s,o,c,l){super(),this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[v]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:i,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,a)=>{let s=n.map(o=>Lc(this.schema,this.tableConfig,o,i.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),i=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:i}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Qc=class extends Je{constructor(e,i,r,n){super(),this.execute=e,this.sql=i,this.query=r,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,i){return i?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Hn=class{constructor(e,i,r){if(this.dialect=e,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:i}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:i},this.query={},this._.schema)for(let[n,a]of Object.entries(this._.schema))this.query[n]=new Hc(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],a,e,i)}static[v]="PgDatabase";query;$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(new $n(r.dialect))),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,i){return new $c({source:e,filters:i,session:this.session})}with(...e){let i=this;function r(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e})}function n(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:!0})}function a(l,p){return new Ye({fields:p??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:{on:l}})}function s(l){return new qs(l,i.session,i.dialect,e)}function o(l){return new Is(l,i.session,i.dialect,e)}function c(l){return new Os(l,i.session,i.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new qs(e,this.session,this.dialect)}insert(e){return new Is(e,this.session,this.dialect)}delete(e){return new Os(e,this.session,this.dialect)}refreshMaterializedView(e){return new Uc(e,this.session,this.dialect)}authToken;execute(e){let i=typeof e=="string"?x.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(i),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Qc(()=>n.execute(void 0,this.authToken),i,r,a=>n.mapResult(a,!0))}transaction(e,i){return this.session.transaction(e,i)}};var Gc=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,i){return e}setToken(e){return this.authToken=e,this}static[v]="PgPreparedQuery";joinsNotNullableMap},Wc=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e,i){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(i).execute(void 0,i))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,i){let r=await this.execute(e,i);return Number(r[0].count)}},Kc=class extends Hn{constructor(e,i,r,n=0){super(e,i,r),this.schema=r,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new jc}getTransactionConfigSQL(e){let i=[];return e.isolationLevel&&i.push(`isolation level ${e.isolationLevel}`),e.accessMode&&i.push(e.accessMode),typeof e.deferrable=="boolean"&&i.push(e.deferrable?"deferrable":"not deferrable"),x.raw(i.join(" "))}setTransaction(e){return this.session.execute(x`set transaction ${this.getTransactionConfigSQL(e)}`)}};var ee;(function(t){t.assertEqual=n=>n;function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{let a={};for(let s of n)a[s]=s;return a},t.getValidEnumValues=n=>{let a=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(let o of a)s[o]=n[o];return t.objectValues(s)},t.objectValues=n=>t.objectKeys(n).map(function(a){return n[a]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let a=[];for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&a.push(s);return a},t.find=(n,a)=>{for(let s of n)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,a=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(ee||(ee={}));var Yf;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(Yf||(Yf={}));var q=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pi=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},S=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),kt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){let i=e||function(a){return a.message},r={_errors:[]},n=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(i(s));else{let o=r,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(i(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){let i={},r=[];for(let n of this.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}};kt.create=t=>new kt(t);var Gn=(t,e)=>{let i;switch(t.code){case S.invalid_type:t.received===q.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:i=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case S.invalid_union:i="Invalid input";break;case S.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case S.invalid_enum_value:i=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:i="Invalid function arguments";break;case S.invalid_return_type:i="Invalid function return type";break;case S.invalid_date:i="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case S.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case S.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case S.custom:i="Invalid input";break;case S.invalid_intersection_types:i="Intersection results could not be merged";break;case S.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:i="Number must be finite";break;default:i=e.defaultError,ee.assertNever(t)}return{message:i}},XS=Gn;function h9(t){XS=t}function Zc(){return XS}var Xc=t=>{let{data:e,path:i,errorMaps:r,issueData:n}=t,a=[...i,...n.path||[]],s={...n,path:a};if(n.message!==void 0)return{...n,path:a,message:n.message};let o="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)o=l(s,{data:e,defaultError:o}).message;return{...n,path:a,message:o}},g9=[];function j(t,e){let i=Zc(),r=Xc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Gn?void 0:Gn].filter(n=>!!n)});t.common.issues.push(r)}var et=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){let r=[];for(let n of i){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){let r=[];for(let n of i){let a=await n.key,s=await n.value;r.push({key:a,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,i){let r={};for(let n of i){let{key:a,value:s}=n;if(a.status==="aborted"||s.status==="aborted")return F;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}},F=Object.freeze({status:"aborted"}),Qn=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),em=t=>t.status==="aborted",tm=t=>t.status==="dirty",Cr=t=>t.status==="valid",Ls=t=>typeof Promise<"u"&&t instanceof Promise;function Jc(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function JS(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ms,Rs,qt=class{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WS=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new kt(t.common.issues);return this._error=i,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(s,o)=>{var c,l;let{message:p}=t;return s.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:o.defaultError}},description:n}}var Q=class{get description(){return this._def.description}_getType(e){return Pi(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new et,ctx:{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let i=this._parse(e);if(Ls(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){let i=this._parse(e);return Promise.resolve(i)}parse(e,i){let r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){var r;let n={common:{issues:[],async:(r=i?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},a=this._parseSync({data:e,path:n.path,parent:n});return WS(n,a)}"~validate"(e){var i,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:n});return Cr(a)?{value:a.value}:{issues:n.common.issues}}catch(a){!((r=(i=a?.message)===null||i===void 0?void 0:i.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>Cr(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,i){let r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){let r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(Ls(n)?n:Promise.resolve(n));return WS(r,a)}refine(e,i){let r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,a)=>{let s=e(n),o=()=>a.addIssue({code:S.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new Tt({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return It.create(this,this._def)}nullable(){return ui.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ni.create(this)}promise(){return Zi.create(this,this._def)}or(e){return Mr.create([this,e],this._def)}and(e){return Rr.create(this,e,this._def)}transform(e){return new Tt({...V(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let i=typeof e=="function"?e:()=>e;return new Fr({...V(this._def),innerType:this,defaultValue:i,typeName:B.ZodDefault})}brand(){return new Ds({typeName:B.ZodBranded,type:this,...V(this._def)})}catch(e){let i=typeof e=="function"?e:()=>e;return new Ur({...V(this._def),innerType:this,catchValue:i,typeName:B.ZodCatch})}describe(e){let i=this.constructor;return new i({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},v9=/^c[^\s-]{8,}$/i,x9=/^[0-9a-z]+$/,y9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w9=/^[a-z0-9_-]{21}$/i,_9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,k9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jf,T9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,A9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,YS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",O9=new RegExp(`^${YS}$`);function eE(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function I9(t){return new RegExp(`^${eE(t)}$`)}function tE(t){let e=`${YS}T${eE(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function q9(t,e){return!!((e==="v4"||!e)&&T9.test(t)||(e==="v6"||!e)&&C9.test(t))}function M9(t,e){if(!_9.test(t))return!1;try{let[i]=t.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function R9(t,e){return!!((e==="v4"||!e)&&A9.test(t)||(e==="v6"||!e)&&P9.test(t))}var Wi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.string,received:a.parsedType}),F}let r=new et,n;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Jf||(Jf=new RegExp(k9,"u")),Jf.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")b9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")w9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")v9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")x9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")y9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),j(n,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?tE(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?O9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?I9(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?S9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?q9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M9(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?R9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?N9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):ee.assertNever(a);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:S.invalid_string,...L.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var i,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...L.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...L.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...L.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...L.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...L.errToObj(i)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:B.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};function L9(t,e){let i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,a=parseInt(t.toFixed(n).replace(".","")),s=parseInt(e.toFixed(n).replace(".",""));return a%s/Math.pow(10,n)}var Pr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.number,received:a.parsedType}),F}let r,n=new et;for(let a of this._def.checks)a.kind==="int"?ee.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?L9(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_finite,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,i=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Pr.create=t=>new Pr({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...V(t)});var jr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let r,n=new et;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.bigint,received:i.parsedType}),F}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};jr.create=t=>{var e;return new jr({checks:[],typeName:B.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};var Nr=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.boolean,received:r.parsedType}),F}return ct(e.data)}};Nr.create=t=>new Nr({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var Or=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.date,received:a.parsedType}),F}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_date}),F}let r=new et,n;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ee.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(i)})}get minDate(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Or.create=t=>new Or({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...V(t)});var Wn=class extends Q{_parse(e){if(this._getType(e)!==q.symbol){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.symbol,received:r.parsedType}),F}return ct(e.data)}};Wn.create=t=>new Wn({typeName:B.ZodSymbol,...V(t)});var Ir=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.undefined,received:r.parsedType}),F}return ct(e.data)}};Ir.create=t=>new Ir({typeName:B.ZodUndefined,...V(t)});var qr=class extends Q{_parse(e){if(this._getType(e)!==q.null){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.null,received:r.parsedType}),F}return ct(e.data)}};qr.create=t=>new qr({typeName:B.ZodNull,...V(t)});var Ki=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};Ki.create=t=>new Ki({typeName:B.ZodAny,...V(t)});var ji=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};ji.create=t=>new ji({typeName:B.ZodUnknown,...V(t)});var Wt=class extends Q{_parse(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.never,received:i.parsedType}),F}};Wt.create=t=>new Wt({typeName:B.ZodNever,...V(t)});var Kn=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.void,received:r.parsedType}),F}return ct(e.data)}};Kn.create=t=>new Kn({typeName:B.ZodVoid,...V(t)});var Ni=class t extends Q{_parse(e){let{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==q.array)return j(i,{code:S.invalid_type,expected:q.array,received:i.parsedType}),F;if(n.exactLength!==null){let s=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(s||o)&&(j(i,{code:s?S.too_big:S.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(j(i,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dnpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:145
		`;await i.execute(x`CREATE SCHEMA IF NOT EXISTS ${x.identifier(a)}`),await i.execute(s);let c=(await i.all(x`select id, hash, created_at from ${x.identifier(a)}.${x.identifier(n)} order by created_at desc limit 1`))[0];await i.transaction(async l=>{for await(let p of e)if(!c||Number(c.created_at)<p.folderMillis){for(let u of p.sql)await l.execute(x.raw(u));await l.execute(x`insert into ${x.identifier(a)}.${x.identifier(n)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let i=[x`with `];for(let[r,n]of e.entries())i.push(x`${x.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&i.push(x`, `);return i.push(x` `),x.join(i)}buildDeleteQuery({table:e,where:i,returning:r,withList:n}){let a=this.buildWithCTE(n),s=r?x` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=i?x` where ${i}`:void 0;return x`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,i){let r=e[N.Symbol.Columns],n=Object.keys(r).filter(s=>i[s]!==void 0||r[s]?.onUpdateFn!==void 0),a=n.length;return x.join(n.flatMap((s,o)=>{let c=r[s],l=i[s]??x.param(c.onUpdateFn(),c),p=x`${x.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<a-1?[p,x.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:i,where:r,returning:n,withList:a,from:s,joins:o}){let c=this.buildWithCTE(a),l=e[We.Symbol.Name],p=e[We.Symbol.Schema],u=e[We.Symbol.OriginalName],d=l===u?void 0:l,f=x`${p?x`${x.identifier(p)}.`:void 0}${x.identifier(u)}${d&&x` ${x.identifier(d)}`}`,m=this.buildUpdateSet(e,i),h=s&&x.join([x.raw(" from "),this.buildFromTable(s)]),y=this.buildJoins(o),b=n?x` returning ${this.buildSelection(n,{isSingleTable:!s})}`:void 0,T=r?x` where ${r}`:void 0;return x`${c}update ${f} set ${m}${h}${y}${T}${b}`}buildSelection(e,{isSingleTable:i=!1}={}){let r=e.length,n=e.flatMap(({field:a},s)=>{let o=[];if(w(a,M.Aliased)&&a.isSelectionField)o.push(x.identifier(a.fieldAlias));else if(w(a,M.Aliased)||w(a,M)){let c=w(a,M.Aliased)?a.sql:a;i?o.push(new M(c.queryChunks.map(l=>w(l,P)?x.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),w(a,M.Aliased)&&o.push(x` as ${x.identifier(a.fieldAlias)}`)}else w(a,ae)&&(i?o.push(x.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<r-1&&o.push(x`, `),o});return x.join(n)}buildJoins(e){if(!e||e.length===0)return;let i=[];for(let[r,n]of e.entries()){r===0&&i.push(x` `);let a=n.table,s=n.lateral?x` lateral`:void 0;if(w(a,We)){let o=a[We.Symbol.Name],c=a[We.Symbol.Schema],l=a[We.Symbol.OriginalName],p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else if(w(a,ot)){let o=a[xe].name,c=a[xe].schema,l=a[xe].originalName,p=o===l?void 0:n.alias;i.push(x`${x.raw(n.joinType)} join${s} ${c?x`${x.identifier(c)}.`:void 0}${x.identifier(l)}${p&&x` ${x.identifier(p)}`} on ${n.on}`)}else i.push(x`${x.raw(n.joinType)} join${s} ${a} on ${n.on}`);r<e.length-1&&i.push(x` `)}return x.join(i)}buildFromTable(e){if(w(e,N)&&e[N.Symbol.OriginalName]!==e[N.Symbol.Name]){let i=x`${x.identifier(e[N.Symbol.OriginalName])}`;return e[N.Symbol.Schema]&&(i=x`${x.identifier(e[N.Symbol.Schema])}.${i}`),x`${i} ${x.identifier(e[N.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:i,fieldsFlat:r,where:n,having:a,table:s,joins:o,orderBy:c,groupBy:l,limit:p,offset:u,lockingClause:d,distinct:f,setOperators:m}){let h=r??Nt(i);for(let te of h)if(w(te.field,ae)&&vt(te.field.table)!==(w(s,Le)?s._.alias:w(s,Fn)?s[xe].name:w(s,M)?void 0:vt(s))&&!(ie=>o?.some(({alias:Y})=>Y===(ie[N.Symbol.IsAlias]?vt(ie):ie[N.Symbol.BaseName])))(te.field.table)){let ie=vt(te.field.table);throw new Error(`Your "${te.path.join("->")}" field references a column "${ie}"."${te.field.name}", but the table "${ie}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,b=this.buildWithCTE(e),T;f&&(T=f===!0?x` distinct`:x` distinct on (${x.join(f.on,x`, `)})`);let _=this.buildSelection(h,{isSingleTable:y}),A=this.buildFromTable(s),O=this.buildJoins(o),E=n?x` where ${n}`:void 0,C=a?x` having ${a}`:void 0,I;c&&c.length>0&&(I=x` order by ${x.join(c,x`, `)}`);let z;l&&l.length>0&&(z=x` group by ${x.join(l,x`, `)}`);let me=typeof p=="object"||typeof p=="number"&&p>=0?x` limit ${p}`:void 0,Ee=u?x` offset ${u}`:void 0,ye=x.empty();if(d){let te=x` for ${x.raw(d.strength)}`;d.config.of&&te.append(x` of ${x.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],x`, `)}`),d.config.noWait?te.append(x` no wait`):d.config.skipLocked&&te.append(x` skip locked`),ye.append(te)}let G=x`${b}select${T} ${_} from ${A}${O}${E}${z}${C}${I}${me}${Ee}${ye}`;return m.length>0?this.buildSetOperations(G,m):G}buildSetOperations(e,i){let[r,...n]=i;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:i,isAll:r,rightSelect:n,limit:a,orderBy:s,offset:o}}){let c=x`(${e.getSQL()}) `,l=x`(${n.getSQL()})`,p;if(s&&s.length>0){let m=[];for(let h of s)if(w(h,P))m.push(x.identifier(h.name));else if(w(h,M)){for(let y=0;y<h.queryChunks.length;y++){let b=h.queryChunks[y];w(b,P)&&(h.queryChunks[y]=x.identifier(b.name))}m.push(x`${h}`)}else m.push(x`${h}`);p=x` order by ${x.join(m,x`, `)} `}let u=typeof a=="object"||typeof a=="number"&&a>=0?x` limit ${a}`:void 0,d=x.raw(`${i} ${r?"all ":""}`),f=o?x` offset ${o}`:void 0;return x`${c}${d}${l}${p}${u}${f}`}buildInsertQuery({table:e,values:i,onConflict:r,returning:n,withList:a,select:s,overridingSystemValue_:o}){let c=[],l=e[N.Symbol.Columns],p=Object.entries(l).filter(([b,T])=>!T.shouldDisableInsert()),u=p.map(([,b])=>x.identifier(this.casing.getColumnCasing(b)));if(s){let b=i;w(b,M)?c.push(b):c.push(b.getSQL())}else{let b=i;c.push(x.raw("values "));for(let[T,_]of b.entries()){let A=[];for(let[O,E]of p){let C=_[O];if(C===void 0||w(C,xt)&&C.value===void 0)if(E.defaultFn!==void 0){let I=E.defaultFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else if(!E.default&&E.onUpdateFn!==void 0){let I=E.onUpdateFn(),z=w(I,M)?I:x.param(I,E);A.push(z)}else A.push(x`default`);else A.push(C)}c.push(A),T<b.length-1&&c.push(x`, `)}}let d=this.buildWithCTE(a),f=x.join(c),m=n?x` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,h=r?x` on conflict ${r}`:void 0,y=o===!0?x`overriding system value `:void 0;return x`${d}insert into ${e} ${u} ${y}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:i,withNoData:r}){let n=i?x` concurrently`:void 0,a=r?x` with no data`:void 0;return x`refresh materialized view${n} ${e}${a}`}prepareTyping(e){return w(e,ks)||w(e,Es)?"json":w(e,Ts)?"decimal":w(e,As)?"time":w(e,Cs)||w(e,Ps)?"timestamp":w(e,_s)||w(e,Ss)?"date":w(e,js)?"uuid":"none"}sqlToQuery(e,i){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:i})}buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:n,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let p=[],u,d,f=[],m,h=[];if(s===!0)p=Object.entries(a.columns).map(([T,_])=>({dbKey:_.name,tsKey:T,field:ci(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(a.columns).map(([C,I])=>[C,ci(I,o)]));if(s.where){let C=typeof s.where=="function"?s.where(b,$S()):s.where;m=C&&xs(C,o)}let T=[],_=[];if(s.columns){let C=!1;for(let[I,z]of Object.entries(s.columns))z!==void 0&&I in a.columns&&(!C&&z===!0&&(C=!0),_.push(I));_.length>0&&(_=C?_.filter(I=>s.columns?.[I]===!0):Object.keys(a.columns).filter(I=>!_.includes(I)))}else _=Object.keys(a.columns);for(let C of _){let I=a.columns[C];T.push({tsKey:C,value:I})}let A=[];s.with&&(A=Object.entries(s.with).filter(C=>!!C[1]).map(([C,I])=>({tsKey:C,queryConfig:I,relation:a.relations[C]})));let O;if(s.extras){O=typeof s.extras=="function"?s.extras(b,{sql:x}):s.extras;for(let[C,I]of Object.entries(O))T.push({tsKey:C,value:Cd(I,o)})}for(let{tsKey:C,value:I}of T)p.push({dbKey:w(I,M.Aliased)?I.fieldAlias:a.columns[C].name,tsKey:C,field:w(I,ae)?ci(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof s.orderBy=="function"?s.orderBy(b,HS()):s.orderBy??[];Array.isArray(E)||(E=[E]),f=E.map(C=>w(C,ae)?ci(C,o):xs(C,o)),u=s.limit,d=s.offset;for(let{tsKey:C,queryConfig:I,relation:z}of A){let me=QS(i,r,z),Ee=kr(z.referencedTable),ye=r[Ee],G=`${o}_${C}`,te=bs(...me.fields.map((H,Pe)=>Se(ci(me.references[Pe],G),ci(H,o)))),ie=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:i,tableNamesMap:r,table:e[ye],tableConfig:i[ye],queryConfig:w(z,Qi)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:G,joinOn:te,nestedQueryRelation:z}),Y=x`${x.identifier(G)}.${x.identifier("data")}`.as(C);h.push({on:x`true`,table:new Le(ie.sql,{},G),alias:G,joinType:"left",lateral:!0}),p.push({dbKey:C,tsKey:C,field:Y,relationTableTsKey:ye,isJson:!0,selection:ie.selection})}}if(p.length===0)throw new ys({message:`No fields selected for table "${a.tsName}" ("${o}")`});let y;if(m=bs(l,m),c){let b=x`json_build_array(${x.join(p.map(({field:A,tsKey:O,isJson:E})=>E?x`${x.identifier(`${o}_${O}`)}.${x.identifier("data")}`:w(A,M.Aliased)?A.sql:A),x`, `)})`;w(c,Ns)&&(b=x`coalesce(json_agg(${b}${f.length>0?x` order by ${x.join(f,x`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:p}];u!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:[{path:[],field:x.raw("*")}],where:m,limit:u,offset:d,orderBy:f,setOperators:[]}),m=void 0,u=void 0,d=void 0,f=[]):y=vs(n,o),y=this.buildSelectQuery({table:w(y,We)?y:new Le(y,{},o),fields:{},fieldsFlat:T.map(({field:A})=>({path:[],field:w(A,ae)?ci(A,o):A})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:vs(n,o),fields:{},fieldsFlat:p.map(({field:b})=>({path:[],field:w(b,ae)?ci(b,o):b})),joins:h,where:m,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:a.tsName,sql:y,selection:p}}};var Bc=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var Ye=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let i=!!this.fields,r=e,n;return this.fields?n=this.fields:w(r,Le)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(a=>[a,r[a]])):w(r,Fn)?n=r[xe].selectedFields:w(r,M)?n={}:n=qc(r),new zc({table:r,fields:n,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Zf=class extends Bc{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:i,isPartialSelect:r,session:n,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...i},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=a,this._={selectedFields:i},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(i,r)=>{let n=this.tableName,a=ki(i);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof a=="string"&&!w(i,M))){let s=w(i,Le)?i._.selectedFields:w(i,ot)?i[xe].selectedFields:i[N.Symbol.Columns];this.config.fields[a]=s}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:i,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,i){return r=>{let n=typeof r=="function"?r(o9()):r;if(!ws(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:i,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(i)?i:[i]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let i=e[0](new Proxy(this.config.fields,new Oe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(i)?i:[i];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let i=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,i={}){return this.config.lockingClause={strength:e,config:i},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}as(e){return new Proxy(new Le(this.getSQL(),this.config.fields,e),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Oe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},zc=class extends Zf{static[v]="PgSelect";_prepare(e){let{session:i,config:r,dialect:n,joinsNotNullableMap:a,authToken:s}=this;if(!i)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ve.startActiveSpan("drizzle.prepareQuery",()=>{let o=Nt(r.fields),c=i.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=a,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(zc,[Je]);function Un(t,e){return(i,r,...n)=>{let a=[r,...n].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!ws(i.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(a)}}var o9=()=>({union:c9,unionAll:l9,intersect:p9,intersectAll:u9,except:d9,exceptAll:f9}),c9=Un("union",!1),l9=Un("union",!0),p9=Un("intersect",!1),u9=Un("intersect",!0),d9=Un("except",!1),f9=Un("except",!0);var $n=class{static[v]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=w(e,Gi)?e:void 0,this.dialectConfig=w(e,Gi)?void 0:e}$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(r)),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let i=this;function r(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),withList:e})}function n(s){return new Ye({fields:s??void 0,session:void 0,dialect:i.getDialect(),distinct:!0})}function a(s,o){return new Ye({fields:o??void 0,session:void 0,dialect:i.getDialect(),distinct:{on:s}})}return{select:r,selectDistinct:n,selectDistinctOn:a}}select(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ye({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Gi(this.dialectConfig)),this.dialect}};var Is=class{constructor(e,i,r,n,a){this.table=e,this.session=i,this.dialect=r,this.withList=n,this.overridingSystemValue_=a}static[v]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let i=e.map(r=>{let n={},a=this.table[N.Symbol.Columns];for(let s of Object.keys(r)){let o=r[s];n[s]=w(o,M)?o:new xt(o,a[s])}return n});return new Fc(this.table,i,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let i=typeof e=="function"?e(new $n):e;if(!w(i,M)&&!ws(this.table[Pc],i._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Fc(this.table,i,this.session,this.dialect,this.withList,!0)}},Fc=class extends Je{constructor(e,i,r,n,a,s,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:i,withList:a,select:s,overridingSystemValue_:o}}static[v]="PgInsert";config;returning(e=this.config.table[N.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Nt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=x`do nothing`;else{let i="";i=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?x` where ${e.where}`:void 0;this.config.onConflict=x`(${x.raw(i)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let i=e.where?x` where ${e.where}`:void 0,r=e.targetWhere?x` where ${e.targetWhere}`:void 0,n=e.setWhere?x` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ic(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=x`(${x.raw(s)})${r} do update set ${a}${i}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Uc=class extends Je{constructor(e,i,r){super(),this.session=i,this.dialect=r,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var qs=class{constructor(e,i,r,n){this.table=e,this.session=i,this.dialect=r,this.withList=n}static[v]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Xf(this.table,Ic(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Xf=class extends Je{constructor(e,i,r,n,a){super(),this.session=r,this.dialect=n,this.config={set:i,table:e,withList:a,joins:[]},this.tableName=ki(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[v]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let i=e,r=ki(i);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=i,this}getTableLikeFields(e){return w(e,We)?e[N.Symbol.Columns]:w(e,Le)?e._.selectedFields:e[xe].selectedFields}createJoin(e){return(i,r)=>{let n=ki(i);if(typeof n=="string"&&this.config.joins.some(a=>a.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let a=this.config.from&&!w(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[N.Symbol.Columns],new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new Oe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:i,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[N.Symbol.Columns]),this.config.from)){let i=ki(this.config.from);if(typeof i=="string"&&this.config.from&&!w(this.config.from,M)){let r=this.getTableLikeFields(this.config.from);e[i]=r}for(let r of this.config.joins){let n=ki(r.table);if(typeof n=="string"&&!w(r.table,M)){let a=this.getTableLikeFields(r.table);e[n]=a}}}return this.config.returningFields=e,this.config.returning=Nt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...i}=this.dialect.sqlToQuery(this.getSQL());return i}_prepare(e){let i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Oe({alias:vt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var $c=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[v]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,i){return x`(select count(*) from ${e}${x.raw(" where ").if(i)}${i})`}static buildCount(e,i){return x`select count(*) as count from ${e}${x.raw(" where ").if(i)}${i};`}setToken(e){return this.token=e,this}then(e,i){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,i)}catch(e){return this.then(void 0,e)}finally(e){return this.then(i=>(e?.(),i),i=>{throw e?.(),i})}};var Hc=class{constructor(e,i,r,n,a,s,o){this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vc=class extends Je{constructor(e,i,r,n,a,s,o,c,l){super(),this.fullSchema=e,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=a,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[v]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:i,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,a)=>{let s=n.map(o=>Lc(this.schema,this.tableConfig,o,i.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),i=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:i}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Qc=class extends Je{constructor(e,i,r,n){super(),this.execute=e,this.sql=i,this.query=r,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,i){return i?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Hn=class{constructor(e,i,r){if(this.dialect=e,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:i}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:i},this.query={},this._.schema)for(let[n,a]of Object.entries(this._.schema))this.query[n]=new Hc(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],a,e,i)}static[v]="PgDatabase";query;$with=(e,i)=>{let r=this;return{as:a=>(typeof a=="function"&&(a=a(new $n(r.dialect))),new Proxy(new Bn(a.getSQL(),i??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new Oe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,i){return new $c({source:e,filters:i,session:this.session})}with(...e){let i=this;function r(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e})}function n(l){return new Ye({fields:l??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:!0})}function a(l,p){return new Ye({fields:p??void 0,session:i.session,dialect:i.dialect,withList:e,distinct:{on:l}})}function s(l){return new qs(l,i.session,i.dialect,e)}function o(l){return new Is(l,i.session,i.dialect,e)}function c(l){return new Os(l,i.session,i.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:a,update:s,insert:o,delete:c}}select(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ye({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,i){return new Ye({fields:i??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new qs(e,this.session,this.dialect)}insert(e){return new Is(e,this.session,this.dialect)}delete(e){return new Os(e,this.session,this.dialect)}refreshMaterializedView(e){return new Uc(e,this.session,this.dialect)}authToken;execute(e){let i=typeof e=="string"?x.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(i),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Qc(()=>n.execute(void 0,this.authToken),i,r,a=>n.mapResult(a,!0))}transaction(e,i){return this.session.transaction(e,i)}};var Gc=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,i){return e}setToken(e){return this.authToken=e,this}static[v]="PgPreparedQuery";joinsNotNullableMap},Wc=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e,i){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(i).execute(void 0,i))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,i){let r=await this.execute(e,i);return Number(r[0].count)}},Kc=class extends Hn{constructor(e,i,r,n=0){super(e,i,r),this.schema=r,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new jc}getTransactionConfigSQL(e){let i=[];return e.isolationLevel&&i.push(`isolation level ${e.isolationLevel}`),e.accessMode&&i.push(e.accessMode),typeof e.deferrable=="boolean"&&i.push(e.deferrable?"deferrable":"not deferrable"),x.raw(i.join(" "))}setTransaction(e){return this.session.execute(x`set transaction ${this.getTransactionConfigSQL(e)}`)}};var ee;(function(t){t.assertEqual=n=>n;function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{let a={};for(let s of n)a[s]=s;return a},t.getValidEnumValues=n=>{let a=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(let o of a)s[o]=n[o];return t.objectValues(s)},t.objectValues=n=>t.objectKeys(n).map(function(a){return n[a]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let a=[];for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&a.push(s);return a},t.find=(n,a)=>{for(let s of n)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,a=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(ee||(ee={}));var Yf;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(Yf||(Yf={}));var q=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pi=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},S=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),kt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){let i=e||function(a){return a.message},r={_errors:[]},n=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(i(s));else{let o=r,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(i(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){let i={},r=[];for(let n of this.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}};kt.create=t=>new kt(t);var Gn=(t,e)=>{let i;switch(t.code){case S.invalid_type:t.received===q.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:i=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case S.invalid_union:i="Invalid input";break;case S.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case S.invalid_enum_value:i=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:i="Invalid function arguments";break;case S.invalid_return_type:i="Invalid function return type";break;case S.invalid_date:i="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case S.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case S.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case S.custom:i="Invalid input";break;case S.invalid_intersection_types:i="Intersection results could not be merged";break;case S.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:i="Number must be finite";break;default:i=e.defaultError,ee.assertNever(t)}return{message:i}},XS=Gn;function h9(t){XS=t}function Zc(){return XS}var Xc=t=>{let{data:e,path:i,errorMaps:r,issueData:n}=t,a=[...i,...n.path||[]],s={...n,path:a};if(n.message!==void 0)return{...n,path:a,message:n.message};let o="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)o=l(s,{data:e,defaultError:o}).message;return{...n,path:a,message:o}},g9=[];function j(t,e){let i=Zc(),r=Xc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Gn?void 0:Gn].filter(n=>!!n)});t.common.issues.push(r)}var et=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){let r=[];for(let n of i){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){let r=[];for(let n of i){let a=await n.key,s=await n.value;r.push({key:a,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,i){let r={};for(let n of i){let{key:a,value:s}=n;if(a.status==="aborted"||s.status==="aborted")return F;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}},F=Object.freeze({status:"aborted"}),Qn=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),em=t=>t.status==="aborted",tm=t=>t.status==="dirty",Cr=t=>t.status==="valid",Ls=t=>typeof Promise<"u"&&t instanceof Promise;function Jc(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function JS(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ms,Rs,qt=class{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},WS=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new kt(t.common.issues);return this._error=i,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(s,o)=>{var c,l;let{message:p}=t;return s.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:o.defaultError}},description:n}}var Q=class{get description(){return this._def.description}_getType(e){return Pi(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new et,ctx:{common:e.parent.common,data:e.data,parsedType:Pi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let i=this._parse(e);if(Ls(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){let i=this._parse(e);return Promise.resolve(i)}parse(e,i){let r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){var r;let n={common:{issues:[],async:(r=i?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},a=this._parseSync({data:e,path:n.path,parent:n});return WS(n,a)}"~validate"(e){var i,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:n});return Cr(a)?{value:a.value}:{issues:n.common.issues}}catch(a){!((r=(i=a?.message)===null||i===void 0?void 0:i.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>Cr(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,i){let r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){let r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pi(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(Ls(n)?n:Promise.resolve(n));return WS(r,a)}refine(e,i){let r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,a)=>{let s=e(n),o=()=>a.addIssue({code:S.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new Tt({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return It.create(this,this._def)}nullable(){return ui.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ni.create(this)}promise(){return Zi.create(this,this._def)}or(e){return Mr.create([this,e],this._def)}and(e){return Rr.create(this,e,this._def)}transform(e){return new Tt({...V(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let i=typeof e=="function"?e:()=>e;return new Fr({...V(this._def),innerType:this,defaultValue:i,typeName:B.ZodDefault})}brand(){return new Ds({typeName:B.ZodBranded,type:this,...V(this._def)})}catch(e){let i=typeof e=="function"?e:()=>e;return new Ur({...V(this._def),innerType:this,catchValue:i,typeName:B.ZodCatch})}describe(e){let i=this.constructor;return new i({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return $r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},v9=/^c[^\s-]{8,}$/i,x9=/^[0-9a-z]+$/,y9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w9=/^[a-z0-9_-]{21}$/i,_9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S9=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,k9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jf,T9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,A9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,YS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",O9=new RegExp(`^${YS}$`);function eE(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function I9(t){return new RegExp(`^${eE(t)}$`)}function tE(t){let e=`${YS}T${eE(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function q9(t,e){return!!((e==="v4"||!e)&&T9.test(t)||(e==="v6"||!e)&&C9.test(t))}function M9(t,e){if(!_9.test(t))return!1;try{let[i]=t.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function R9(t,e){return!!((e==="v4"||!e)&&A9.test(t)||(e==="v6"||!e)&&P9.test(t))}var Wi=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.string,received:a.parsedType}),F}let r=new et,n;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?j(n,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&j(n,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Jf||(Jf=new RegExp(k9,"u")),Jf.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")b9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")w9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")v9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")x9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")y9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),j(n,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?tE(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?O9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?I9(a).test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?S9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?q9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M9(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?R9(e.data,a.version)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?N9.test(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):ee.assertNever(a);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:S.invalid_string,...L.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var i,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...L.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...L.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...L.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...L.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...L.errToObj(i)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:B.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};function L9(t,e){let i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,a=parseInt(t.toFixed(n).replace(".","")),s=parseInt(e.toFixed(n).replace(".",""));return a%s/Math.pow(10,n)}var Pr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.number,received:a.parsedType}),F}let r,n=new et;for(let a of this._def.checks)a.kind==="int"?ee.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?L9(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_finite,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,i=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Pr.create=t=>new Pr({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...V(t)});var jr=class t extends Q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let r,n=new et;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),j(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ee.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.bigint,received:i.parsedType}),F}gte(e,i){return this.setLimit("min",e,!0,L.toString(i))}gt(e,i){return this.setLimit("min",e,!1,L.toString(i))}lte(e,i){return this.setLimit("max",e,!0,L.toString(i))}lt(e,i){return this.setLimit("max",e,!1,L.toString(i))}setLimit(e,i,r,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:L.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(i)})}get minValue(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};jr.create=t=>{var e;return new jr({checks:[],typeName:B.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...V(t)})};var Nr=class extends Q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.boolean,received:r.parsedType}),F}return ct(e.data)}};Nr.create=t=>new Nr({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var Or=class t extends Q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_type,expected:q.date,received:a.parsedType}),F}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return j(a,{code:S.invalid_date}),F}let r=new et,n;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),j(n,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ee.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(i)})}get minDate(){let e=null;for(let i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Or.create=t=>new Or({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...V(t)});var Wn=class extends Q{_parse(e){if(this._getType(e)!==q.symbol){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.symbol,received:r.parsedType}),F}return ct(e.data)}};Wn.create=t=>new Wn({typeName:B.ZodSymbol,...V(t)});var Ir=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.undefined,received:r.parsedType}),F}return ct(e.data)}};Ir.create=t=>new Ir({typeName:B.ZodUndefined,...V(t)});var qr=class extends Q{_parse(e){if(this._getType(e)!==q.null){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.null,received:r.parsedType}),F}return ct(e.data)}};qr.create=t=>new qr({typeName:B.ZodNull,...V(t)});var Ki=class extends Q{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};Ki.create=t=>new Ki({typeName:B.ZodAny,...V(t)});var ji=class extends Q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};ji.create=t=>new ji({typeName:B.ZodUnknown,...V(t)});var Wt=class extends Q{_parse(e){let i=this._getOrReturnCtx(e);return j(i,{code:S.invalid_type,expected:q.never,received:i.parsedType}),F}};Wt.create=t=>new Wt({typeName:B.ZodNever,...V(t)});var Kn=class extends Q{_parse(e){if(this._getType(e)!==q.undefined){let r=this._getOrReturnCtx(e);return j(r,{code:S.invalid_type,expected:q.void,received:r.parsedType}),F}return ct(e.data)}};Kn.create=t=>new Kn({typeName:B.ZodVoid,...V(t)});var Ni=class t extends Q{_parse(e){let{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==q.array)return j(i,{code:S.invalid_type,expected:q.array,received:i.parsedType}),F;if(n.exactLength!==null){let s=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(s||o)&&(j(i,{code:s?S.too_big:S.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(j(i,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dnpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:145